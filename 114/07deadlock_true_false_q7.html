<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½œæ¥­ç³»çµ±å…¥é–€ï¼šæ­»çµ (Deadlock) è§£æ</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --warning-color: #f1c40f;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* æª”æ¡ˆåç¨±æ¨™ç¤º */
        .file-header {
            font-size: 0.8em;
            color: #777;
            text-align: center;
            margin-bottom: 20px;
            font-family: monospace;
        }

        /* é€šç”¨å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        h1 { text-align: center; border-bottom: 2px solid var(--primary-color); padding-bottom: 15px; }
        h2 { font-size: 1.4em; border-left: 5px solid var(--primary-color); padding-left: 10px; }

        /* æ¯”å–»å€å¡Š */
        .analogy-box {
            background-color: #e8f4fd;
            border-left: 5px solid #2980b9;
            padding: 15px;
            margin: 15px 0;
        }

        .definition-box {
            background-color: #fff8e1;
            border: 2px solid #ffe082;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
        }

        /* äº’å‹•ç­”é¡Œå€ */
        .quiz-section { text-align: center; }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: left;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }

        .options-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .option-btn {
            display: inline-block;
            padding: 15px 30px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
            user-select: none;
        }

        .option-btn:hover { border-color: var(--primary-color); background: #f0f8ff; }
        .option-btn.selected { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        
        input[type="radio"] { display: none; }

        .btn-group { margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;}
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: opacity 0.2s;
        }
        
        button:hover { opacity: 0.9; }
        .btn-submit { background-color: var(--success-color); color: white; }
        .btn-hint { background-color: var(--warning-color); color: #333; }
        .btn-reset { background-color: #95a5a6; color: white; }
        .btn-anim { background-color: var(--primary-color); color: white; font-weight: bold; margin-top: 10px; width: 100%;}

        /* æç¤ºèˆ‡è§£æ */
        .hint-box {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff3cd;
            color: #856404;
            border-radius: 5px;
            display: none;
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            text-align: left;
            display: none;
        }
        .result-correct { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .result-wrong { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }

        .key-point-list li { margin-bottom: 8px; }

        /* äº’å‹•å‹•ç•«æ¨¡æ“¬ */
        .simulation-area {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: #2c3e50;
            padding: 30px;
            border-radius: 8px;
            margin-top: 20px;
            color: white;
            position: relative;
            min-height: 250px;
        }

        .process-node {
            width: 100px;
            height: 100px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 2;
            transition: all 0.5s;
        }

        .resource-node {
            width: 80px;
            height: 80px;
            background: #e67e22;
            border-radius: 8px; /* æ–¹å¡Šä»£è¡¨è³‡æº */
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            z-index: 1;
            transition: all 0.5s;
        }

        /* è³‡æºä½ç½® */
        #r1 { top: 20px; left: 50%; transform: translateX(-50%); }
        #r2 { bottom: 20px; left: 50%; transform: translateX(-50%); }

        .arrow {
            position: absolute;
            height: 4px;
            background-color: transparent;
            transform-origin: left center;
            transition: all 0.5s;
        }
        
        /* å‹•ç•«ç‹€æ…‹æ–‡å­— */
        .status-text {
            font-size: 0.8em;
            margin-top: 5px;
            color: #ecf0f1;
        }
        
        .deadlock-alert {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 15px 30px;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 10px;
            display: none;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* å»¶ä¼¸çŸ¥è­˜å€å¡Š */
        .conditions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .condition-card {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
        }
        .condition-card h4 { margin: 0 0 5px 0; color: #333; }
        .condition-card small { color: #666; font-style: italic; }

        /* Accordion */
        details {
            background-color: #f1f1f1;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        summary { cursor: pointer; font-weight: bold; padding: 5px; }
        details p { padding: 10px; background: white; margin: 5px 0 0 0; border-radius: 3px; }

        /* å¸¸è¦‹èª¤å€ */
        .mistake-box {
            border: 1px dashed #e74c3c;
            padding: 15px;
            border-radius: 8px;
            background: #fff5f5;
        }

        /* åº•éƒ¨æ¸¬é©— */
        .mini-quiz { background: #eef2f3; padding: 20px; border-radius: 8px; }
        .mini-quiz-option {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border: 1px solid #ccc;
            cursor: pointer;
            border-radius: 5px;
        }
        .mini-quiz-option:hover { background: #e0e0e0; }
        .correct-answer { background: #d4edda !important; border-color: #28a745 !important; }
        .wrong-answer { background: #f8d7da !important; border-color: #dc3545 !important; }

    </style>
</head>
<body>

    <div class="file-header">æª”åå»ºè­°ï¼šdeadlock_true_false_q7.html</div>

    <div class="container">
        <h1>ä½œæ¥­ç³»çµ±ï¼šæ­»çµ (Deadlock) äº’å‹•æ•™å­¸</h1>

        <!-- 1. æ•™å­¸å°å…¥ -->
        <div class="card">
            <h2>1. ä»€éº¼æ˜¯æ­»çµï¼Ÿ</h2>
            <div class="analogy-box">
                <strong>ç”Ÿæ´»æ¯”å–» - ã€Œæ‹¿ç­·å­åƒé£¯ã€ï¼š</strong><br>
                æƒ³åƒåœ“æ¡Œä¸Šæœ‰å…©å€‹è¡Œç¨‹ï¼ˆäººï¼‰ï¼Œä½†æ¡Œä¸Šåªæœ‰å…©æ”¯ç­·å­ï¼ˆè³‡æºï¼‰ã€‚<br>
                <ul>
                    <li>å¦‚æœ A æ‹¿äº†å·¦æ‰‹é‚Šçš„ä¸€æ”¯ç­·å­ï¼ˆæŒæœ‰è³‡æºï¼‰ã€‚</li>
                    <li>åŒæ™‚ B æ‹¿äº†å³æ‰‹é‚Šçš„ä¸€æ”¯ç­·å­ï¼ˆæŒæœ‰è³‡æºï¼‰ã€‚</li>
                    <li>å…©äººéƒ½é‚„æƒ³æ‹¿å°æ–¹çš„ç­·å­æ‰èƒ½åƒé£¯ï¼ˆè«‹æ±‚è³‡æºï¼‰ã€‚</li>
                    <li>çµæœï¼šèª°éƒ½ä¸é¡˜æ„å…ˆæ”¾ä¸‹æ‰‹ä¸Šçš„ç­·å­ï¼Œå…©å€‹äººéƒ½æ°¸é åƒä¸åˆ°é£¯ï¼Œå¡åœ¨åŸåœ°ã€‚</li>
                </ul>
            </div>
            <div class="definition-box">
                æ­»çµï¼ˆDeadlockï¼‰æ˜¯æŒ‡å¤šå€‹è¡Œç¨‹å½¼æ­¤ç­‰å¾…å°æ–¹é‡‹æ”¾è³‡æºï¼Œå½¢æˆå¾ªç’°ç­‰å¾…ï¼Œå°è‡´å…¨éƒ¨éƒ½ç„¡æ³•ç¹¼çºŒåŸ·è¡Œã€‚
            </div>
        </div>

        <!-- 2. äº’å‹•ä½œç­”è¨­è¨ˆ -->
        <div class="card quiz-section">
            <h2>2. è§€å¿µæª¢æ¸¬</h2>
            <div class="question-text">
                <strong>é¡Œç›®ï¼š</strong><br>
                ç•¶å…©å€‹è¡Œç¨‹äº’ç›¸ç­‰å¾…å°æ–¹é‡‹æ”¾è³‡æºï¼Œè€Œéƒ½ç„¡æ³•ç¹¼çºŒæ™‚ï¼Œé€™ç¨®ç¾è±¡ç¨±ç‚ºã€Œæ­»çµï¼ˆDeadlockï¼‰ã€ã€‚
            </div>

            <div class="options-group">
                <label class="option-btn" onclick="selectOption('O')">
                    <input type="radio" name="mainQuiz" value="O"> â˜ O (æ­£ç¢º)
                </label>
                <label class="option-btn" onclick="selectOption('X')">
                    <input type="radio" name="mainQuiz" value="X"> â˜ X (éŒ¯èª¤)
                </label>
            </div>

            <div class="btn-group">
                <button class="btn-submit" onclick="checkAnswer()">é€å‡ºç­”æ¡ˆ</button>
                <button class="btn-hint" onclick="showHint()">çœ‹æç¤º (<span id="hint-count">0</span>/3)</button>
                <button class="btn-reset" onclick="resetQuiz()">é‡ä½œä¸€æ¬¡</button>
            </div>

            <div id="hint-display" class="hint-box"></div>

            <div id="result-display" class="result-box">
                <!-- è§£æå…§å®¹å°‡ç”± JS æ’å…¥ -->
            </div>
        </div>

        <!-- 3. äº’å‹•å‹•ç•«ç¤ºæ„ -->
        <div class="card">
            <h2>3. äº’å‹•å¯¦é©—å®¤ï¼šæ­»çµæ˜¯å¦‚ä½•ç™¼ç”Ÿçš„ï¼Ÿ</h2>
            <p>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè§€å¯Ÿè³‡æºåˆ†é…éç¨‹ã€‚</p>
            
            <div class="simulation-area">
                <div class="deadlock-alert" id="deadlock-msg">Deadlock ç™¼ç”Ÿï¼</div>

                <!-- Process 1 -->
                <div class="process-node" id="p1">
                    <strong>P1</strong>
                    <div class="status-text" id="p1-status">é–’ç½®</div>
                </div>

                <!-- Resource 1 -->
                <div class="resource-node" id="r1">R1</div>

                <!-- Resource 2 -->
                <div class="resource-node" id="r2">R2</div>

                <!-- Process 2 -->
                <div class="process-node" id="p2">
                    <strong>P2</strong>
                    <div class="status-text" id="p2-status">é–’ç½®</div>
                </div>
            </div>

            <button class="btn-anim" onclick="nextStep()">ä¸‹ä¸€æ­¥ (ç›®å‰çš„æ­¥é©Ÿï¼š<span id="step-num">0</span>/4)</button>
            <button class="btn-reset" onclick="resetSim()" style="margin-top: 10px; width: 100%;">é‡ç½®æ¨¡æ“¬</button>
        </div>

        <!-- 4. å»¶ä¼¸çŸ¥è­˜ï¼šæ­»çµå››è¦ä»¶ -->
        <div class="card">
            <h2>4. æ­»çµç™¼ç”Ÿçš„å››å€‹å¿…è¦æ¢ä»¶ (Coffman Conditions)</h2>
            <p>åªè¦é€™å››å€‹æ¢ä»¶<b>åŒæ™‚å­˜åœ¨</b>ï¼Œæ­»çµå°±æœƒç™¼ç”Ÿã€‚åä¹‹ï¼Œåªè¦<b>ç ´å£å…¶ä¸­ä¸€å€‹</b>ï¼Œå°±å¯ä»¥é¿å…æ­»çµã€‚</p>
            
            <div class="conditions-grid">
                <div class="condition-card">
                    <h4>1. äº’æ–¥</h4>
                    <small>Mutual Exclusion</small>
                    <p>è³‡æºä¸€æ¬¡åªèƒ½è¢«ä¸€å€‹è¡Œç¨‹ä½¿ç”¨ï¼Œä¸èƒ½å…±ç”¨ã€‚</p>
                </div>
                <div class="condition-card">
                    <h4>2. ä½”æœ‰ä¸”ç­‰å¾…</h4>
                    <small>Hold and Wait</small>
                    <p>è¡Œç¨‹æ‹¿äº†ä¸€å€‹è³‡æºï¼Œé‚„åœ¨ç­‰åˆ¥çš„è³‡æºï¼Œä¸”ä¸æ”¾æ‰‹ã€‚</p>
                </div>
                <div class="condition-card">
                    <h4>3. ä¸å¯æ¶å¥ª</h4>
                    <small>No Preemption</small>
                    <p>è³‡æºä¸èƒ½è¢«å¼·åˆ¶æ¶èµ°ï¼Œåªèƒ½ç”±æŒæœ‰è€…è‡ªé¡˜é‡‹æ”¾ã€‚</p>
                </div>
                <div class="condition-card">
                    <h4>4. å¾ªç’°ç­‰å¾…</h4>
                    <small>Circular Wait</small>
                    <p>P1 ç­‰ P2ï¼ŒP2 ç­‰ P3 ... Pn ç­‰ P1ï¼Œå½¢æˆä¸€å€‹åœˆã€‚</p>
                </div>
            </div>
        </div>

        <!-- 5. è¨˜æ†¶æŠ€å·§èˆ‡å¸¸è¦‹éŒ¯èª¤ -->
        <div class="card">
            <h2>5. è€ƒè©¦ç§˜ç±</h2>
            
            <!-- Accordion -->
            <details open>
                <summary>ğŸ’¡ è€ƒå‰æ­»çµ 10 ç§’å£è¨£ (é»æ“Šæ”¶åˆ)</summary>
                <p>
                    <strong>ã€Œäº’ä½”ä¸å¾ªã€</strong><br><br>
                    1. <strong>äº’</strong>ï¼šäº’æ–¥ (Mutual Exclusion)<br>
                    2. <strong>ä½”</strong>ï¼šä½”æœ‰ä¸”ç­‰å¾… (Hold & Wait)<br>
                    3. <strong>ä¸</strong>ï¼šä¸å¯æ¶å¥ª (No Preemption)<br>
                    4. <strong>å¾ª</strong>ï¼šå¾ªç’°ç­‰å¾… (Circular Wait)<br>
                    <br>
                    <span style="color: #e74c3c;">â˜… è€ƒè©¦é™·é˜±ï¼šé¡Œç›®çœ‹åˆ°ã€Œäº’ç›¸ç­‰å¾…ã€ã€ã€Œéƒ½ç„¡æ³•ç¹¼çºŒã€å°±æ˜¯ Deadlockï¼</span>
                </p>
            </details>

            <div class="mistake-box" style="margin-top: 20px;">
                <h3>âš ï¸ å¸¸è¦‹èª¤å€ (Don't make these mistakes!)</h3>
                <ul class="key-point-list">
                    <li>
                        <strong>èª¤å€ 1ï¼šæŠŠæ­»çµç•¶æˆç•¶æ©Ÿ (Crash/Infinite Loop)</strong><br>
                        ä¿®æ­£ï¼šç•¶æ©Ÿé€šå¸¸æ˜¯ç¨‹å¼éŒ¯èª¤æˆ–ç¡¬é«”æ•…éšœï¼›æ­»çµæ˜¯é‚è¼¯ä¸Šçš„è³‡æºäº’å¡ï¼Œç³»çµ±é‚„æ´»è‘—ä½†å‹•ä¸äº†ã€‚
                    </li>
                    <li>
                        <strong>èª¤å€ 2ï¼šæŠŠæ­»çµç•¶æˆé£¢é¤“ (Starvation)</strong><br>
                        ä¿®æ­£ï¼šæ­»çµæ˜¯ã€Œå¤§å®¶éƒ½å¡ä½ã€ï¼›é£¢é¤“æ˜¯ã€Œåªæœ‰æˆ‘ä¸€ç›´æ‹¿ä¸åˆ°ï¼Œåˆ¥äººé‚„åœ¨é †åˆ©åŸ·è¡Œã€ã€‚
                    </li>
                    <li>
                        <strong>èª¤å€ 3ï¼šä»¥ç‚ºåªè¦æœ‰ç­‰å¾…å°±ä¸€å®šæ˜¯æ­»çµ</strong><br>
                        ä¿®æ­£ï¼šå¿…é ˆè¦å½¢æˆã€Œåœ“åœˆï¼ˆå¾ªç’°ï¼‰ã€æ‰æ˜¯æ­»çµã€‚å¦‚æœåªæ˜¯æ’éšŠï¼Œé‚£åªæ˜¯å–®ç´”çš„ç­‰å¾…ã€‚
                    </li>
                </ul>
            </div>
        </div>

        <!-- 6. æœ€å¾Œå°æ¸¬é©— -->
        <div class="card">
            <h2>6. éš¨å ‚å°æ¸¬é©—</h2>
            <div class="mini-quiz">
                <p><strong>é¡Œç›®ï¼šä¸‹åˆ—ä½•è€…ä¸€å®šæ˜¯æ­»çµçš„å¿…è¦æ¢ä»¶ï¼Ÿ</strong></p>
                <div id="mini-options">
                    <div class="mini-quiz-option" onclick="checkMiniQuiz(this, 'A')">(A) å¾ªç’°ç­‰å¾…ï¼ˆCircular Waitï¼‰</div>
                    <div class="mini-quiz-option" onclick="checkMiniQuiz(this, 'B')">(B) è¡Œç¨‹å¾ˆå¤šï¼ˆMany processesï¼‰</div>
                    <div class="mini-quiz-option" onclick="checkMiniQuiz(this, 'C')">(C) CPU ä½¿ç”¨ç‡å¾ˆé«˜ï¼ˆHigh CPU usageï¼‰</div>
                    <div class="mini-quiz-option" onclick="checkMiniQuiz(this, 'D')">(D) è¨˜æ†¶é«”ä¸è¶³ï¼ˆLow memoryï¼‰</div>
                </div>
                <div id="mini-feedback" style="margin-top: 15px; font-weight: bold;"></div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. äº’å‹•ç­”é¡Œå€é‚è¼¯ ---
        let currentHint = 0;
        const hints = [
            "é—œéµå­—ï¼šäº’ç›¸ç­‰å¾…ã€è³‡æºã€ç„¡æ³•ç¹¼çºŒã€‚",
            "å¦‚æœå…©å€‹è¡Œç¨‹éƒ½æ‹¿è‘—ä¸€éƒ¨åˆ†è³‡æºï¼Œåˆéƒ½ä¸æ”¾æ‰‹ï¼Œæœƒæ€æ¨£ï¼Ÿ",
            "é€™å°±æ˜¯ deadlockã€‚"
        ];

        function selectOption(val) {
            // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡æ¨£å¼
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            // åŠ ä¸Šé¸ä¸­æ¨£å¼
            event.currentTarget.classList.add('selected');
            // è¨­å®š Radio å€¼
            document.querySelector(`input[name="mainQuiz"][value="${val}"]`).checked = true;
        }

        function showHint() {
            const hintBox = document.getElementById('hint-display');
            if (currentHint < hints.length) {
                hintBox.style.display = 'block';
                hintBox.innerHTML += `<p>æç¤º ${currentHint + 1}ï¼š${hints[currentHint]}</p>`;
                currentHint++;
                document.getElementById('hint-count').innerText = currentHint;
            }
        }

        function checkAnswer() {
            const selected = document.querySelector('input[name="mainQuiz"]:checked');
            const resultBox = document.getElementById('result-display');

            if (!selected) {
                alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
                return;
            }

            resultBox.style.display = 'block';
            resultBox.innerHTML = ""; // æ¸…ç©º

            if (selected.value === 'O') {
                resultBox.className = "result-box result-correct";
                resultBox.innerHTML = `
                    <h3>ğŸ‰ ç­”å°äº†ï¼çµæœï¼šæ­£ç¢º (O)</h3>
                    <p><strong>é‡é»è§£æï¼š</strong></p>
                    <ul class="key-point-list">
                        <li>é€™æ®µæ•˜è¿°å®Œå…¨ç¬¦åˆæ­»çµçš„ä¸‰å€‹é—œéµç‰¹å¾µï¼š</li>
                        <li>1. <strong>äº’ç›¸ç­‰å¾…</strong>ï¼ˆMutually waitingï¼‰</li>
                        <li>2. <strong>ç­‰å¾…è³‡æºé‡‹æ”¾</strong>ï¼ˆWait for resource releaseï¼‰</li>
                        <li>3. <strong>éƒ½ç„¡æ³•ç¹¼çºŒ</strong>ï¼ˆNo progress/Hangï¼‰</li>
                    </ul>
                    <hr style="border: 0; border-top: 1px solid #c3e6cb; margin: 10px 0;">
                    <p><strong>ğŸ’¡ æ˜“æ··æ·†æ¦‚å¿µé‡æ¸…ï¼š</strong></p>
                    <p>æ­»çµ vs é£¢é¤“ (Starvation)ï¼š<br>
                    æ­»çµæ˜¯ã€Œå¤§å®¶éƒ½å¡æ­»ï¼Œæ²’äººåœ¨å‹•ã€ï¼›é£¢é¤“æ˜¯ã€Œåªæœ‰æŸäººé‹æ°£ä¸å¥½ä¸€ç›´æ¶è¼¸ï¼Œä½†ç³»çµ±å…¶ä»–äººé‚„åœ¨å‹•ã€ã€‚</p>
                `;
            } else {
                resultBox.className = "result-box result-wrong";
                resultBox.innerHTML = `
                    <h3>âŒ ç­”éŒ¯äº†ï¼Œè«‹å†æƒ³ä¸€æƒ³ã€‚</h3>
                    <p>æç¤ºï¼šé¡Œç›®æè¿°çš„æ˜¯å…©å€‹è¡Œç¨‹ã€Œäº’ç›¸å¡ä½ã€çš„ç‹€æ³ã€‚</p>
                    <p>é€™ä¸æ˜¯å–®ç´”çš„ç­‰å¾…ï¼Œè€Œæ˜¯æ²’æœ‰äººèƒ½å¤ é€€è®“ï¼Œå°è‡´å¤§å®¶éƒ½å‹•ä¸äº†ã€‚</p>
                `;
            }
        }

        function resetQuiz() {
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            const radios = document.querySelectorAll('input[name="mainQuiz"]');
            radios.forEach(r => r.checked = false);
            
            document.getElementById('result-display').style.display = 'none';
            document.getElementById('hint-display').style.display = 'none';
            document.getElementById('hint-display').innerHTML = '';
            currentHint = 0;
            document.getElementById('hint-count').innerText = 0;
        }

        // --- 2. äº’å‹•å‹•ç•«é‚è¼¯ ---
        let simStep = 0;
        
        function nextStep() {
            const p1 = document.getElementById('p1');
            const p2 = document.getElementById('p2');
            const r1 = document.getElementById('r1');
            const r2 = document.getElementById('r2');
            const msg = document.getElementById('deadlock-msg');
            const stepDisplay = document.getElementById('step-num');
            const p1Status = document.getElementById('p1-status');
            const p2Status = document.getElementById('p2-status');

            if (simStep >= 4) return; // å‹•ç•«çµæŸ

            simStep++;
            stepDisplay.innerText = simStep;

            switch(simStep) {
                case 1:
                    // P1 å–å¾— R1
                    // åœ¨è¦–è¦ºä¸Šæˆ‘å€‘å¯ä»¥ç”¨ border é¡è‰²æˆ–æ–‡å­—è¡¨ç¤ºæŒæœ‰
                    r1.style.border = "4px solid #3498db"; // R1 è®Šè—
                    r1.innerText = "R1 (P1)";
                    p1Status.innerText = "æŒæœ‰ R1";
                    break;
                case 2:
                    // P2 å–å¾— R2
                    r2.style.border = "4px solid #3498db"; // R2 è®Šè—
                    r2.innerText = "R2 (P2)";
                    p2Status.innerText = "æŒæœ‰ R2";
                    break;
                case 3:
                    // P1 è«‹æ±‚ R2
                    // ç•«ä¸€æ¢ç´…ç·šæˆ–æ”¹è®Š P1 ç‹€æ…‹
                    p1.style.border = "4px dashed #e74c3c";
                    p1Status.innerHTML = "æŒæœ‰ R1<br><span style='color:#ff7675'>ç­‰å¾… R2...</span>";
                    break;
                case 4:
                    // P2 è«‹æ±‚ R1
                    p2.style.border = "4px dashed #e74c3c";
                    p2Status.innerHTML = "æŒæœ‰ R2<br><span style='color:#ff7675'>ç­‰å¾… R1...</span>";
                    
                    // è§¸ç™¼ Deadlock
                    setTimeout(() => {
                        msg.style.display = "block";
                        // ç¨å¾®æ”¹è®ŠèƒŒæ™¯è‰²ç¤ºæ„å‡çµ
                        document.querySelector('.simulation-area').style.background = "#222";
                    }, 500);
                    break;
            }
        }

        function resetSim() {
            simStep = 0;
            document.getElementById('step-num').innerText = 0;
            document.getElementById('deadlock-msg').style.display = "none";
            document.querySelector('.simulation-area').style.background = "#2c3e50";

            // Reset P1
            const p1 = document.getElementById('p1');
            p1.style.border = "none";
            document.getElementById('p1-status').innerText = "é–’ç½®";

            // Reset P2
            const p2 = document.getElementById('p2');
            p2.style.border = "none";
            document.getElementById('p2-status').innerText = "é–’ç½®";

            // Reset R1
            const r1 = document.getElementById('r1');
            r1.style.border = "none";
            r1.innerText = "R1";

            // Reset R2
            const r2 = document.getElementById('r2');
            r2.style.border = "none";
            r2.innerText = "R2";
        }

        // --- 3. åº•éƒ¨æ¸¬é©—é‚è¼¯ ---
        let miniQuizAnswered = false;

        function checkMiniQuiz(element, answer) {
            if (miniQuizAnswered) return; // é˜²æ­¢é‡è¤‡ä½œç­”
            
            const feedback = document.getElementById('mini-feedback');
            const options = document.querySelectorAll('.mini-quiz-option');

            miniQuizAnswered = true;

            if (answer === 'A') {
                element.classList.add('correct-answer');
                feedback.style.color = "#155724";
                feedback.innerHTML = "â­• æ­£ç¢ºï¼ã€Œå¾ªç’°ç­‰å¾…ã€æ˜¯æ­»çµç™¼ç”Ÿçš„å››å€‹å¿…è¦æ¢ä»¶ä¹‹ä¸€ã€‚åªæœ‰å½¢æˆå°é–‰çš„ç­‰å¾…åœ“åœˆï¼Œæ‰æœƒçœŸæ­£é–æ­»ã€‚";
            } else {
                element.classList.add('wrong-answer');
                // æ¨™è¨˜æ­£ç¢ºç­”æ¡ˆ
                options[0].classList.add('correct-answer');
                feedback.style.color = "#721c24";
                feedback.innerHTML = "âŒ éŒ¯èª¤ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ (A)ã€‚(B)(C)(D) åªæ˜¯ç³»çµ±ç¹å¿™æˆ–è³‡æºä¸è¶³çš„ç¾è±¡ï¼Œä¸ä¸€å®šæœƒé€ æˆæ­»çµï¼ˆDeadlockï¼‰ã€‚";
            }
        }
    </script>
</body>
</html>