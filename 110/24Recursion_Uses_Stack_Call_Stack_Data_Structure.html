<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è…¦æ¦‚è«–ï¼šéè¿´èˆ‡å †ç–Šäº’å‹•æ•™å­¸ (Q24)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary-color: #333;
            --accent-color: #2c3e50;
            --highlight-bg: #fff9c4; /* è¢å…‰ç­†é»ƒ */
            --stack-color: #e0f7fa;
            --frame-color: #4dd0e1;
            --frame-border: #0097a7;
            --pop-color: #ffcc80;
            --correct-color: #4caf50;
            --wrong-color: #f44336;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
            line-height: 1.6;
            color: var(--primary-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* --- æ¨™é¡Œèˆ‡é¡Œç›®å€ --- */
        h1 {
            border-bottom: 3px solid var(--accent-color);
            padding-bottom: 10px;
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 1.3rem;
            color: var(--accent-color);
            margin-top: 30px;
            border-left: 5px solid var(--accent-color);
            padding-left: 10px;
            background-color: #f9f9f9;
        }

        .question-box {
            background-color: #fafafa;
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .options {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .options li {
            margin: 8px 0;
            padding: 8px;
            border-radius: 4px;
        }

        .highlight {
            background-color: var(--highlight-bg);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
        }

        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        .btn {
            display: inline-block;
            padding: 8px 16px;
            margin: 5px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s, background-color 0.2s;
        }

        .btn:hover {
            background-color: #34495e;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
        }

        .btn-outline:hover {
            background-color: var(--accent-color);
            color: white;
        }

        /* --- äº’å‹•æ¨¡æ“¬å€ (Call Stack Animation) --- */
        .simulation-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            background: #fff;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .controls {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #ccc;
        }

        .visual-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            align-items: flex-end;
            min-height: 350px;
        }

        /* å †ç–Šå®¹å™¨æ¨£å¼ */
        .stack-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
        }

        .stack-container {
            width: 100%;
            height: 300px;
            border-left: 4px solid #333;
            border-right: 4px solid #333;
            border-bottom: 4px solid #333;
            background-color: rgba(0,0,0,0.02);
            border-radius: 0 0 10px 10px;
            display: flex;
            flex-direction: column-reverse; /* è®“å…ƒç´ å¾åº•éƒ¨é–‹å§‹å †ç–Š */
            justify-content: flex-start;
            padding: 5px;
            position: relative;
            overflow: hidden;
        }

        /* å †ç–Šä¸­çš„æ¡†æ¶ (Frame) */
        .stack-frame {
            width: 90%;
            height: 45px;
            margin: 2px auto;
            background-color: var(--frame-color);
            border: 2px solid var(--frame-border);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            color: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease-out;
            position: relative;
        }

        .stack-frame.popping {
            background-color: var(--pop-color);
            border-color: #ff9800;
            animation: fadeOut 0.5s forwards;
        }

        /* Queue å°ç…§çµ„å°åœ– */
        .queue-wrapper {
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.6;
            border-left: 1px dashed #ccc;
            padding-left: 10px;
        }
        
        .queue-tube {
            width: 100%;
            height: 60px;
            border-top: 3px dashed #999;
            border-bottom: 3px dashed #999;
            display: flex;
            align-items: center;
            padding: 5px;
            position: relative;
        }

        .queue-item {
            width: 40px;
            height: 40px;
            background: #ccc;
            margin-right: 5px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
        }

        /* èªªæ˜æ–‡å­—å€ */
        .info-panel {
            width: 100%;
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            min-height: 60px;
            text-align: center;
            font-weight: bold;
            color: #0277bd;
        }

        /* --- å‹•ç•«é—œéµå½±æ ¼ --- */
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.8); opacity: 0; }
        }

        /* --- ç­”é¡Œäº’å‹•å€ --- */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            text-align: left;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            background-color: #f0f0f0;
        }

        .quiz-option.correct {
            border-color: var(--correct-color);
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .quiz-option.wrong {
            border-color: var(--wrong-color);
            background-color: #ffebee;
            color: #c62828;
        }

        .quiz-feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        /* --- é€šç”¨æ‘ºç–Šå…§å®¹ --- */
        .spoiler-content {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background-color: #fff3e0;
            border-radius: 5px;
        }

        .show {
            display: block;
        }

        /* --- è¬›ç¾©æ’ç‰ˆ --- */
        .step-box {
            margin-bottom: 25px;
        }
        
        .step-title {
            font-weight: bold;
            color: #fff;
            background-color: var(--accent-color);
            padding: 5px 15px;
            display: inline-block;
            border-radius: 20px;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .mnemonic-card {
            background: #fff8e1;
            border-left: 5px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
        }

        /* RWD */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            .visual-container { flex-direction: column; align-items: center; }
            .stack-wrapper, .queue-wrapper { width: 100%; margin-bottom: 20px; }
            .queue-wrapper { border-left: none; border-top: 1px dashed #ccc; padding-top: 10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- A. æ¨™é¡Œå€ -->
    <h1>é›»è…¦æ¦‚è«–ï¼šéè¿´èˆ‡å †ç–Š (Q24)</h1>

    <!-- B. é¡Œç›®å€ -->
    <div class="question-box">
        24. åŸ·è¡Œéè¿´å‡½æ•¸æ™‚ï¼Œä½¿ç”¨åˆ°çš„è³‡æ–™çµæ§‹ç‚º<br>
        <ul class="options">
            <li>(A) stack</li>
            <li>(B) tree</li>
            <li>(C) queue</li>
            <li>(D) array</li>
        </ul>
        <button class="btn btn-outline" onclick="toggleAnswer()">é¡¯ç¤ºç­”æ¡ˆ</button>
        <div id="answer-reveal" class="spoiler-content" style="background-color: #e8f5e9; color: #2e7d32; font-weight: bold;">
            ç­”æ¡ˆï¼šA
        </div>
    </div>

    <!-- C. ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­— -->
    <h2>ç¬¬ä¸€æ­¥ï¼šæ‰¾é—œéµå­—</h2>
    <div class="step-box">
        <p>è«‹çœ‹é¡Œç›®ä¸­çš„é€™å…©å€‹é‡é»ï¼š</p>
        <p>ã€Œ<span class="highlight">åŸ·è¡Œéè¿´å‡½æ•¸</span>ã€æ™‚ï¼Œã€Œ<span class="highlight">ä½¿ç”¨åˆ°çš„è³‡æ–™çµæ§‹</span>ã€</p>
        <p><strong>è§£é‡‹ï¼š</strong>é¡Œç›®ä¸æ˜¯å•ä½ ã€Œéè¿´å¯ä»¥ç”¨ä¾†å¯«ä»€éº¼ã€ï¼Œè€Œæ˜¯å•ä½ ã€Œé›»è…¦åœ¨èƒŒå¾ŒåŸ·è¡Œæ™‚ï¼Œæ˜¯ç”¨ä»€éº¼æ–¹å¼ä¾†æš«å­˜æ¯ä¸€å±¤çš„ç‹€æ…‹ã€ã€‚</p>
    </div>

    <!-- D. ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯ -->
    <h2>ç¬¬äºŒæ­¥ï¼šç™½è©±ç¿»è­¯</h2>
    <div class="step-box">
        <p>éè¿´å°±æ˜¯ã€Œå‡½æ•¸è‡ªå·±å‘¼å«è‡ªå·±ã€ã€‚</p>
        <p>æƒ³åƒä½ åœ¨ç©ã€Œä¿„ç¾…æ–¯å¥—å¨ƒã€æˆ–è€…ã€Œå‰æ´‹è”¥ã€ï¼Œå‰åˆ°æœ€è£¡é¢ä¹‹å¾Œï¼Œè¦ä¸€å±¤ä¸€å±¤è£å›å»ã€‚</p>
        <p><strong>ç¿»è­¯ï¼š</strong>ã€Œé›»è…¦åŸ·è¡Œéè¿´æ™‚ï¼Œé ä»€éº¼æ±è¥¿æŠŠæ¯ä¸€å±¤çš„æš«å­˜è³‡æ–™ï¼ˆåƒæ•¸ã€è®Šæ•¸ï¼‰å…ˆæ”¶å¥½ï¼Œæœ€å¾Œæ‰èƒ½ç…§é †åºä¸€å±¤ä¸€å±¤æ‹¿å›ä¾†ï¼Ÿã€</p>
    </div>

    <!-- E. ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯ -->
    <h2>ç¬¬ä¸‰æ­¥ï¼šè§£é¡Œæ€è·¯</h2>
    <div class="step-box">
        <ul>
            <li><strong>è§€å¿µï¼š</strong>éè¿´æœƒç”¢ç”Ÿã€Œä¸€å±¤åˆä¸€å±¤ã€çš„å‘¼å«ã€‚</li>
            <li><strong>éç¨‹ï¼š</strong>
                <ol>
                    <li>å‘¼å«ç¬¬ 1 å±¤ â†’ é›»è…¦æš«åœï¼Œå»åŸ·è¡Œç¬¬ 2 å±¤ï¼ˆè³‡æ–™è¦å­˜èµ·ä¾†ï¼‰ã€‚</li>
                    <li>å‘¼å«ç¬¬ 2 å±¤ â†’ é›»è…¦æš«åœï¼Œå»åŸ·è¡Œç¬¬ 3 å±¤ï¼ˆè³‡æ–™å†ç–Šä¸Šå»ï¼‰ã€‚</li>
                    <li>... ç›´åˆ°çµ‚æ­¢æ¢ä»¶ï¼ˆBase Caseï¼‰ã€‚</li>
                    <li><strong>å›å‚³æ™‚ï¼š</strong>å¿…é ˆå…ˆè™•ç†ã€Œæœ€å¾Œã€å‘¼å«çš„é‚£ä¸€å±¤ï¼Œæ‰èƒ½å›åˆ°ä¸Šä¸€å±¤ã€‚</li>
                </ol>
            </li>
            <li><strong>çµè«–ï¼š</strong>é€™æ˜¯ä¸€ç¨®ã€Œ<strong>å¾Œé€²å…ˆå‡º (Last In, First Out, LIFO)</strong>ã€çš„è¡Œç‚ºã€‚</li>
            <li><strong>æ¯”å–»ï¼š</strong>å°±åƒæ´—ç›¤å­ç–Šç›¤å­ï¼Œæœ€å¾Œæ”¾ä¸Šå»çš„ç›¤å­ï¼Œä¸€å®šè¦æœ€å…ˆæ‹¿ä¸‹ä¾†æ´—ã€‚</li>
        </ul>
    </div>

    <!-- F. äº’å‹•æ¨¡æ“¬ï¼šCall Stack å †ç–Šå‹•ç•« -->
    <h2>äº’å‹•æ¨¡æ“¬ï¼šå‘¼å«å †ç–Š (Call Stack)</h2>
    <div class="simulation-area">
        <div class="controls">
            <label>ç¯„ä¾‹ï¼š
                <select id="sim-type">
                    <option value="factorial">éšä¹˜ Factorial(n)</option>
                    <option value="sum">åŠ ç¸½ Sum(n)</option>
                </select>
            </label>
            <label>è¼¸å…¥ n (1-5)ï¼š<input type="number" id="sim-n" value="3" min="1" max="5" style="width: 50px;"></label>
            <button class="btn" onclick="simReset()">é‡ç½® (Reset)</button>
            <button class="btn" onclick="simStep()">å–®æ­¥åŸ·è¡Œ (Step)</button>
            <button class="btn" id="btn-auto" onclick="simAuto()">è‡ªå‹•æ’­æ”¾</button>
        </div>

        <div class="info-panel" id="sim-info">
            é»æ“Šã€Œå–®æ­¥åŸ·è¡Œã€é–‹å§‹æ¨¡æ“¬éè¿´éç¨‹...
        </div>

        <div class="visual-container">
            <!-- Stack -->
            <div class="stack-wrapper">
                <h3>Call Stack (å †ç–Š)</h3>
                <div style="font-size: 0.8rem; color: #666; margin-bottom: 5px;">å¾Œé€²å…ˆå‡º (LIFO)</div>
                <!-- ä¸Šæ–¹é–‹å£ç¤ºæ„ -->
                <div style="width: 100%; text-align: center; color: #999;">â¬‡ é€² / â¬† å‡º</div>
                <div class="stack-container" id="stack-viz">
                    <!-- å‹•æ…‹ç”Ÿæˆ Frame -->
                </div>
                <div style="margin-top:5px; font-weight:bold;">åº•éƒ¨</div>
            </div>

            <!-- Queue å°ç…§ -->
            <div class="queue-wrapper">
                <h3>(å°ç…§çµ„) Queue</h3>
                <div style="font-size: 0.8rem; color: #666; margin-bottom: 5px;">å…ˆé€²å…ˆå‡º (FIFO)</div>
                <div style="margin-top: 20px;">
                    <div class="queue-tube">
                        <div class="queue-item">A</div>
                        <div class="queue-item">B</div>
                        <div class="queue-item">C</div>
                        <div style="margin-left: 10px;">â¡</div>
                    </div>
                </div>
                <p style="font-size: 0.8rem; color: #c62828; padding: 10px;">
                    å¦‚æœæ˜¯ Queueï¼Œæœ€å…ˆå‘¼å«çš„æœƒæœ€å…ˆé›¢é–‹ï¼Œ<br>é€™æ¨£å‡½æ•¸é‚„æ²’åŸ·è¡Œå®Œå°±è¢«ä¸Ÿæ‰äº†ï¼Œ<br>æ‰€ä»¥éè¿´ä¸èƒ½ç”¨ Queueï¼
                </p>
            </div>
        </div>
    </div>

    <!-- G. é¸é …åˆ†æ -->
    <h2>ç¬¬å››æ­¥ï¼šé¸é …åˆ†æ</h2>
    <div class="step-box">
        <ul class="options">
            <li><strong>(A) stack (å †ç–Š)</strong>ï¼š<span style="color:green">âœ” æ­£ç¢º</span>ã€‚Call Stack (å‘¼å«å †ç–Š) å°ˆé–€ç”¨ä¾†ç®¡ç†å‡½æ•¸å‘¼å«ï¼Œç¬¦åˆ LIFO ç‰¹æ€§ã€‚</li>
            <li><strong>(B) tree (æ¨¹)</strong>ï¼š<span style="color:red">âœ– éŒ¯èª¤</span>ã€‚é›–ç„¶éè¿´å¸¸ç”¨ä¾†ã€Œè™•ç†ã€æ¨¹ç‹€çµæ§‹ï¼ˆå¦‚äºŒå…ƒæ¨¹èµ°è¨ªï¼‰ï¼Œä½†åŸ·è¡Œæ™‚ç®¡ç†è¨˜æ†¶é«”çš„çµæ§‹æ˜¯ stackã€‚Tree æ˜¯è³‡æ–™å‹æ…‹ï¼Œä¸æ˜¯åŸ·è¡Œæ©Ÿåˆ¶ã€‚</li>
            <li><strong>(C) queue (ä½‡åˆ—)</strong>ï¼š<span style="color:red">âœ– éŒ¯èª¤</span>ã€‚Queue æ˜¯å…ˆé€²å…ˆå‡º (FIFO)ï¼Œå¦‚æœç”¨é€™å€‹ï¼Œæœ€ä¸Šå±¤çš„å‡½æ•¸é‚„æ²’ç®—å®Œå°±æœƒè¢«ä¸Ÿæ‰ã€‚</li>
            <li><strong>(D) array (é™£åˆ—)</strong>ï¼š<span style="color:red">âœ– éŒ¯èª¤</span>ã€‚Array æ˜¯åŸºç¤å„²å­˜æ–¹å¼ï¼Œå¯ä»¥ç”¨ä¾†ã€Œå¯¦ä½œã€stackï¼Œä½†é¡Œç›®å•çš„æ˜¯æŠ½è±¡çš„è³‡æ–™çµæ§‹æ¦‚å¿µã€‚</li>
        </ul>
    </div>

    <!-- H, I, J. è§€å¿µè£œå……èˆ‡è¨˜æ†¶ -->
    <h2>è§€å¿µè£œå……èˆ‡è¨˜æ†¶å£è¨£</h2>
    <div class="step-box">
        <div class="mnemonic-card">
            <strong>ğŸ”¥ è¨˜æ†¶å£è¨£ï¼š</strong><br>
            ã€Œéè¿´è¦å›é ­ï¼Œå›é ­é å †ç–Šã€‚ã€<br>
            ã€Œæœ€å¾Œå«çš„æœ€å…ˆå› (LIFO) â†’ Stackã€
        </div>
        
        <h3>å¸¸è¦‹é™·é˜± (é¿å‘æŒ‡å—)</h3>
        <ul>
            <li>çœ‹åˆ°é¡Œç›®æœ‰ã€Œéè¿´ã€å°±æƒ³é¸ Treeï¼Ÿ éŒ¯ï¼é‚£æ˜¯æ‡‰ç”¨å ´æ™¯ï¼Œä¸æ˜¯åŸ·è¡Œæ©Ÿåˆ¶ã€‚</li>
            <li>é¡Œç›®å•ã€ŒåŸ·è¡ŒæœŸé–“ (Run-time)ã€ï¼Œä¸€å®šè¦æƒ³åˆ° <strong>Call Stack</strong>ã€‚</li>
            <li><strong>å»¶ä¼¸æ€è€ƒï¼š</strong>å¦‚æœæ”¹æˆã€Œè¿´åœˆ (Iteration)ã€ï¼Œé€šå¸¸å°±ä¸éœ€è¦é€™éº¼æ·±çš„ Call Stackï¼Œæ•ˆç‡æ¯”è¼ƒé«˜ã€‚</li>
        </ul>
    </div>

    <!-- K. ä½œç­”å€ -->
    <h2>è€ƒå‰è‡ªæˆ‘æ¸¬è©¦</h2>
    <div class="question-box" style="background: #fff;">
        <p>Q: ç‚ºä»€éº¼éè¿´ä¸èƒ½ä½¿ç”¨ Queue ä¾†ç®¡ç†å‘¼å«ï¼Ÿ</p>
        <div id="quiz-options">
            <button class="quiz-option" onclick="checkQuiz(this, false)">å› ç‚º Queue å®¹é‡å¤ªå°</button>
            <button class="quiz-option" onclick="checkQuiz(this, true)">å› ç‚º Queue æ˜¯å…ˆé€²å…ˆå‡ºï¼Œç„¡æ³•æ­£ç¢ºå›åˆ°ä¸Šä¸€å±¤</button>
            <button class="quiz-option" onclick="checkQuiz(this, false)">å› ç‚º Queue åªèƒ½å­˜æ•´æ•¸</button>
            <button class="quiz-option" onclick="checkQuiz(this, false)">å› ç‚º Queue æ˜¯æ¨¹ç‹€çµæ§‹</button>
        </div>
        <div id="quiz-feedback" class="quiz-feedback"></div>
    </div>

    <!-- M. è‡ªæˆ‘æª¢æ¸¬ -->
    <h2>è‡ªæˆ‘æª¢æ¸¬ (æ€è€ƒé¡Œ)</h2>
    <div class="step-box">
        <ul>
            <li>1. å¦‚æœéè¿´æ²’æœ‰å¯«å¥½ã€Œçµ‚æ­¢æ¢ä»¶ (Base Case)ã€ï¼ŒStack æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ(æç¤ºï¼šStack Overflow)</li>
            <li>2. æ·±åº¦å„ªå…ˆæœå°‹ (DFS) ç‚ºä½•å¸¸ç”¨ Stackï¼Ÿå»£åº¦å„ªå…ˆæœå°‹ (BFS) ç‚ºä½•å¸¸ç”¨ Queueï¼Ÿ</li>
        </ul>
    </div>

</div>

<script>
    // --- äº’å‹•åŠŸèƒ½é‚è¼¯ ---

    // 1. é¡¯ç¤º/éš±è—ç­”æ¡ˆ
    function toggleAnswer() {
        const answer = document.getElementById('answer-reveal');
        if (answer.style.display === 'none' || answer.style.display === '') {
            answer.style.display = 'block';
        } else {
            answer.style.display = 'none';
        }
    }

    // 2. æ¸¬é©—é¡Œé‚è¼¯
    function checkQuiz(btn, isCorrect) {
        const feedback = document.getElementById('quiz-feedback');
        const allBtns = document.querySelectorAll('.quiz-option');
        
        // é‡ç½®æ¨£å¼
        allBtns.forEach(b => {
            b.classList.remove('correct', 'wrong');
            b.disabled = true; // é–å®š
        });

        feedback.style.display = 'block';
        
        if (isCorrect) {
            btn.classList.add('correct');
            feedback.innerHTML = "<strong>ç­”å°äº†ï¼ğŸ‰</strong> Queue æ˜¯ FIFO (å…ˆé€²å…ˆå‡º)ï¼Œå¦‚æœç”¨ä¾†ç®¡ç†å‡½æ•¸å‘¼å«ï¼Œæœƒå°è‡´æœ€å…ˆé€²å…¥çš„å‡½æ•¸æœ€å…ˆè¢«ç§»é™¤ï¼Œä½†å¯¦éš›ä¸Šæˆ‘å€‘éœ€è¦å®ƒä¿ç•™åˆ°æœ€å¾Œæ‰çµæŸã€‚";
            feedback.style.backgroundColor = "#e8f5e9";
            feedback.style.color = "#2e7d32";
        } else {
            btn.classList.add('wrong');
            feedback.innerHTML = "<strong>ç­”éŒ¯äº† ğŸ˜…</strong> å†æƒ³ä¸€ä¸‹ Stack å’Œ Queue çš„é€²å‡ºé †åºå·®ç•°ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯é—œæ–¼ã€Œå…ˆé€²å…ˆå‡ºã€çš„å•é¡Œã€‚";
            feedback.style.backgroundColor = "#ffebee";
            feedback.style.color = "#c62828";
            // å…è¨±é‡è©¦
            setTimeout(() => {
                allBtns.forEach(b => b.disabled = false);
            }, 1500);
        }
    }

    // 3. å †ç–Šæ¨¡æ“¬é‚è¼¯ (Call Stack Simulation)
    let simulationState = {
        stepIndex: 0,
        steps: [],
        intervalId: null,
        isPlaying: false
    };

    function generateSteps(type, n) {
        let steps = [];
        // éè¿´é‚è¼¯ç”Ÿæˆå™¨
        if (type === 'factorial') {
            // Factorial Logic
            // Step structure: { action: 'push'|'pop', func: string, arg: number, result: number|null, msg: string }
            
            // Push phase
            for (let i = n; i >= 1; i--) {
                steps.push({
                    action: 'push',
                    func: 'fact',
                    arg: i,
                    msg: `å‘¼å« fact(${i})ï¼Œæš«åœ fact(${i+1} || 'Main')`
                });
            }
            
            // Pop phase
            let result = 1;
            for (let i = 1; i <= n; i++) {
                let prevResult = result;
                result = result * i;
                steps.push({
                    action: 'pop',
                    func: 'fact',
                    arg: i,
                    result: result,
                    msg: `fact(${i}) å®Œæˆã€‚å›å‚³ ${i} * ${i==1 ? 1 : 'prev'} = ${result}`
                });
            }
        } else {
            // Sum Logic
            for (let i = n; i >= 1; i--) {
                steps.push({
                    action: 'push',
                    func: 'sum',
                    arg: i,
                    msg: `å‘¼å« sum(${i})`
                });
            }
            let result = 0;
            for (let i = 1; i <= n; i++) {
                result += i;
                steps.push({
                    action: 'pop',
                    func: 'sum',
                    arg: i,
                    result: result,
                    msg: `sum(${i}) å®Œæˆã€‚å›å‚³ ${i} + prev = ${result}`
                });
            }
        }
        return steps;
    }

    function renderStack() {
        const container = document.getElementById('stack-viz');
        container.innerHTML = ''; // æ¸…ç©º
        
        // æ ¹æ“šç•¶å‰æ­¥é©Ÿé‡å»ºå †ç–Šè¦–è¦º
        // æˆ‘å€‘éœ€è¦ç®—å‡ºç•¶å‰ stepIndex æ™‚ï¼Œstack è£¡é¢æœ‰ä»€éº¼
        let currentStack = [];
        
        for (let i = 0; i < simulationState.stepIndex; i++) {
            let step = simulationState.steps[i];
            if (step.action === 'push') {
                currentStack.push(step);
            } else if (step.action === 'pop') {
                currentStack.pop();
            }
        }

        // ç¹ªè£½ Stack (ç”±ä¸‹è€Œä¸Š)
        currentStack.forEach(item => {
            const div = document.createElement('div');
            div.className = 'stack-frame';
            div.innerText = `${item.func}(${item.arg})`;
            container.appendChild(div);
        });

        // è™•ç†å‰›å‰›ç™¼ç”Ÿçš„å‹•ä½œå‹•ç•«é¡¯ç¤º
        const info = document.getElementById('sim-info');
        if (simulationState.stepIndex > 0) {
            let lastStep = simulationState.steps[simulationState.stepIndex - 1];
            info.innerText = `[Step ${simulationState.stepIndex}] ${lastStep.msg}`;
            
            // å¦‚æœå‰›å¥½æ˜¯ POPï¼Œé¡¯ç¤ºå›å‚³å‹•ç•«æ•ˆæœ (é€™æ¯”è¼ƒè¤‡é›œï¼Œç°¡å–®ç”¨æ–‡å­—è¡¨ç¤ºå³å¯)
            if(lastStep.action === 'pop') {
                 // è¦–è¦ºä¸Šå¯ä»¥ç”¨ä¸€å€‹æš«æ™‚çš„ div é£›å‡ºå»ï¼Œé€™è£¡ç°¡åŒ–è™•ç†
            }
        } else {
            info.innerText = "æº–å‚™é–‹å§‹... è«‹æŒ‰ã€Œå–®æ­¥åŸ·è¡Œã€";
        }
    }

    function simReset() {
        clearInterval(simulationState.intervalId);
        simulationState.isPlaying = false;
        document.getElementById('btn-auto').innerText = "è‡ªå‹•æ’­æ”¾";
        
        const type = document.getElementById('sim-type').value;
        const n = parseInt(document.getElementById('sim-n').value);
        
        simulationState.steps = generateSteps(type, n);
        simulationState.stepIndex = 0;
        renderStack();
    }

    function simStep() {
        if (simulationState.stepIndex >= simulationState.steps.length) {
            document.getElementById('sim-info').innerText = "æ¨¡æ“¬çµæŸï¼Stack å·²æ¸…ç©ºã€‚";
            clearInterval(simulationState.intervalId);
            simulationState.isPlaying = false;
            document.getElementById('btn-auto').innerText = "è‡ªå‹•æ’­æ”¾";
            return;
        }
        simulationState.stepIndex++;
        renderStack();
    }

    function simAuto() {
        if (simulationState.isPlaying) {
            clearInterval(simulationState.intervalId);
            simulationState.isPlaying = false;
            document.getElementById('btn-auto').innerText = "è‡ªå‹•æ’­æ”¾";
        } else {
            simulationState.isPlaying = true;
            document.getElementById('btn-auto').innerText = "æš«åœ";
            simulationState.intervalId = setInterval(simStep, 1000); // æ¯ç§’ä¸€æ­¥
        }
    }

    // åˆå§‹åŒ–
    window.onload = function() {
        simReset();
    };
</script>

</body>
</html>