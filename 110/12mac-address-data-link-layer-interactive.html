<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ 12 é¡Œï¼šOSI èˆ‡ MAC ä½å€ - äº’å‹•å¼æ•™å­¸è¬›ç¾©</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db; /* è£œç¿’ç­è— */
            --highlight-color: #f1c40f; /* é‡é»é»ƒ */
            --correct-color: #27ae60; /* æ­£ç¢ºç¶  */
            --wrong-color: #e74c3c; /* éŒ¯èª¤ç´… */
            --bg-color: #f4f6f7;
            --card-bg: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- æ¨™é¡Œå€ --- */
        header {
            text-align: center;
            background: var(--primary-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 { margin: 0; font-size: 1.8rem; }
        header p { margin: 10px 0 0; opacity: 0.9; }

        /* --- é€šç”¨å¡ç‰‡æ¨£å¼ --- */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent-color);
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
        }

        .highlight {
            background-color: var(--highlight-color);
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }

        .keyword {
            color: var(--wrong-color);
            font-weight: bold;
        }

        /* --- é¡Œç›®å€æ¨£å¼ --- */
        .question-box {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
        }

        .option-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            text-align: left;
            transition: all 0.2s;
            position: relative;
        }

        .option-btn:hover {
            border-color: var(--accent-color);
            background: #f0f8ff;
        }

        .option-btn.correct {
            background-color: #d5f5e3;
            border-color: var(--correct-color);
            color: var(--correct-color);
        }

        .option-btn.wrong {
            background-color: #fadbd8;
            border-color: var(--wrong-color);
            color: var(--wrong-color);
        }

        .result-area {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none; /* é è¨­éš±è— */
        }

        .result-area.show { display: block; }
        .result-area.correct-box { background: #d5f5e3; border: 1px solid var(--correct-color); }
        .result-area.wrong-box { background: #fadbd8; border: 1px solid var(--wrong-color); }

        /* --- æ ¸å¿ƒè§€å¿µå€ --- */
        .concept-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .concept-table th, .concept-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }

        .concept-table th {
            background-color: var(--primary-color);
            color: white;
        }

        .concept-table tr.active-row {
            background-color: #fff9c4; /* å¼·èª¿éˆçµå±¤ */
            font-weight: bold;
            border: 2px solid var(--wrong-color);
        }

        /* --- æ‹–æ›³é…å°éŠæˆ² --- */
        .game-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .draggables {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .draggable-item {
            background: var(--accent-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: grab;
            text-align: center;
            font-weight: bold;
        }

        .drop-zones {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .drop-zone {
            width: 250px;
            height: 50px;
            border: 2px dashed #aaa;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            transition: background 0.3s;
            position: relative;
        }

        .drop-zone::before {
            content: attr(data-label);
            position: absolute;
            left: -110px;
            font-weight: bold;
            color: #555;
            width: 100px;
            text-align: right;
        }

        .drop-zone.hovered {
            background: #e8f6f3;
            border-color: var(--correct-color);
        }

        .drop-zone.correct {
            border: 2px solid var(--correct-color);
            background: #d5f5e3;
        }

        /* --- å°åŒ…æµç¨‹äº’å‹• --- */
        .flow-diagram {
            border: 1px solid #ddd;
            padding: 20px;
            background: white;
            position: relative;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .packet {
            width: 120px;
            background: #e74c3c;
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            transition: all 0.5s ease;
        }

        .header-added {
            background: #3498db;
            color: white;
            padding: 5px;
            margin: 2px;
            border-radius: 3px;
            display: inline-block;
            font-size: 0.9rem;
            animation: fadeIn 0.5s;
        }
        
        .mac-header {
            background: #f1c40f; /* MACç”¨é»ƒè‰²ç‰¹åˆ¥æ¨™ç¤º */
            color: black;
            font-weight: bold;
            border: 2px solid red;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- é™·é˜±å¡ --- */
        .trap-grid {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .trap-card {
            flex: 1;
            min-width: 200px;
            background: #fff3e0;
            border: 1px solid #ffcc80;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.5s;
            position: relative;
        }
        
        .trap-card::after {
            content: "é»æ“Šæ¶ˆé™¤é™·é˜±";
            display: block;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #e67e22;
            text-align: center;
        }

        /* --- è‡ªæˆ‘æª¢æ¸¬ --- */
        .quiz-item {
            margin-bottom: 15px;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 10px;
        }
        .hint-text {
            display: none;
            color: var(--accent-color);
            margin-top: 5px;
            font-weight: bold;
            background: #f0f8ff;
            padding: 5px;
        }

        /* --- æŒ‰éˆ• --- */
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .btn:hover { opacity: 0.9; }
        .btn-reset { background: #7f8c8d; display: block; margin: 30px auto; }
        .btn-flow { background: var(--correct-color); width: 100%; font-size: 1.1rem; padding: 12px; margin-top: 10px; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>é›»è…¦æ¦‚è«– - ç¶²è·¯é€šè¨Šç¯‡</h1>
        <p>å–®å…ƒä¸»é¡Œï¼šMAC ä½å€èˆ‡ OSI æ¨¡å‹å®šä½</p>
    </header>

    <!-- 1. é¡Œç›®å€ -->
    <section class="card" id="question-section">
        <h2>ğŸ“ ç¬¬ 12 é¡Œï¼šéš¨å ‚æ¸¬é©—</h2>
        <div class="question-box">
            ç¶²è·¯é€šè¨Šå”å®šä¸­ï¼Œæª¢è¦–ä¸¦å¡«å…… MAC ä½å€çš„æ˜¯å±¬æ–¼å“ªä¸€å±¤çš„åŠŸèƒ½ï¼Ÿ
        </div>
        <div class="options-grid">
            <button class="option-btn" onclick="checkAnswer('A', this)">(A) å¯¦é«”å±¤</button>
            <button class="option-btn" onclick="checkAnswer('B', this)">(B) éˆçµå±¤</button>
            <button class="option-btn" onclick="checkAnswer('C', this)">(C) ç¶²è·¯å±¤</button>
            <button class="option-btn" onclick="checkAnswer('D', this)">(D) å‚³è¼¸å±¤</button>
        </div>

        <div id="answer-feedback" class="result-area">
            <!-- JS å‹•æ…‹å¡«å…¥çµæœ -->
        </div>
    </section>

    <!-- 2. æ ¸å¿ƒè§€å¿µå€ -->
    <section class="card">
        <h2>ğŸ’¡ è€å¸«çš„é‡é»ç­†è¨˜</h2>
        <p>é€™é¡Œæ˜¯è€ƒè©¦å¿…è€ƒé¡Œï¼è«‹ä¸€å®šè¦åˆ†æ¸…æ¥šã€Œä½å€ã€èˆ‡ã€Œå±¤ç´šã€çš„å°æ‡‰é—œä¿‚ã€‚</p>
        
        <p><strong>åè©è§£é‡‹ï¼ˆç¬¬ä¸€æ¬¡å­¸çœ‹é€™è£¡ï¼‰ï¼š</strong></p>
        <ul>
            <li><strong>MAC ä½å€</strong>ï¼šç¶²è·¯å¡çš„èº«åˆ†è­‰è™Ÿç¢¼ï¼Œç”¨æ–¼å€åŸŸç¶²è·¯è¾¨è­˜è¨­å‚™ã€‚</li>
            <li><strong>éˆçµå±¤ (Data Link Layer)</strong>ï¼šOSI ç¬¬äºŒå±¤ï¼Œè² è²¬è™•ç† Frame (è³‡æ–™æ¡†)ã€éŒ¯èª¤æª¢æŸ¥èˆ‡ MAC ä½å€ã€‚</li>
        </ul>

        <div style="text-align: center; margin: 20px 0; font-size: 1.2rem; background: #fffbe6; padding: 15px; border-radius: 8px;">
            ğŸ”‘ <strong>ä¸€å¥è©±å£è¨£ï¼š</strong><br>
            <span class="keyword" style="font-size: 1.5rem;">ã€ŒMAC åœ¨éˆçµå±¤ï¼›IP åœ¨ç¶²è·¯å±¤ã€</span>
        </div>

        <h3>ğŸ“Š OSI å„å±¤èˆ‡ä½å€å°ç…§è¡¨</h3>
        <table class="concept-table">
            <thead>
                <tr>
                    <th>OSI å±¤ç´š</th>
                    <th>ä½¿ç”¨ä½å€ / é—œéµå­—</th>
                    <th>ä¸»è¦è·è²¬</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>å‚³è¼¸å±¤ (Transport)</td>
                    <td>Port (é€£æ¥åŸ )</td>
                    <td>å¯é å‚³è¼¸ã€TCP/UDP</td>
                </tr>
                <tr>
                    <td>ç¶²è·¯å±¤ (Network)</td>
                    <td>IP ä½å€</td>
                    <td>è·¯ç”±é¸æ“‡ã€è·¯å¾‘è¦åŠƒ</td>
                </tr>
                <tr class="active-row">
                    <td>éˆçµå±¤ (Data Link)</td>
                    <td>MAC ä½å€ âœ…</td>
                    <td>æª¢æŸ¥èˆ‡å¡«å…… MACã€è³‡æ–™æ¡†</td>
                </tr>
                <tr>
                    <td>å¯¦é«”å±¤ (Physical)</td>
                    <td>ç„¡ (åªæœ‰è¨Šè™Ÿ)</td>
                    <td>é›»å£“ã€é›»ç·šã€å…‰çº–</td>
                </tr>
            </tbody>
        </table>

        <h3>ğŸ§ é¸é …è§£æ</h3>
        <ul>
            <li>(A) å¯¦é«”å±¤ âŒï¼šåªè² è²¬å‚³é€ 0 èˆ‡ 1 çš„é›»å­è¨Šè™Ÿï¼Œçœ‹ä¸æ‡‚ä½å€ã€‚</li>
            <li>(B) éˆçµå±¤ âœ…ï¼š<strong>è² è²¬å°‡è³‡æ–™å°è£æˆ Frameï¼Œä¸¦å¡«ä¸Šä¾†æºèˆ‡ç›®çš„åœ°çš„ MAC ä½å€ã€‚</strong></li>
            <li>(C) ç¶²è·¯å±¤ âŒï¼šè² è²¬ IP ä½å€ï¼Œé‚£æ˜¯ç”¨ä¾†æ‰¾è·¨åœ‹/è·¨ç¶²æ®µè·¯å¾‘çš„ã€‚</li>
            <li>(D) å‚³è¼¸å±¤ âŒï¼šè² è²¬ Portï¼Œé‚£æ˜¯ç”¨ä¾†å€åˆ†é›»è…¦è£¡ä¸åŒè»Ÿé«” (å¦‚ Chrome vs Line) çš„ã€‚</li>
        </ul>
    </section>

    <!-- 3. äº’å‹•éŠæˆ²å€ï¼šé…å° -->
    <section class="card">
        <h2>ğŸ® äº’å‹•ç·´ç¿’ï¼šæŠŠä½å€æ‹–åˆ°æ­£ç¢ºçš„å®¶</h2>
        <p>è«‹å°‡ä¸Šæ–¹çš„ä½å€å¡ç‰‡ï¼Œæ‹–æ›³ï¼ˆæˆ–é»é¸å¾Œå†é»ç›®æ¨™ï¼‰åˆ°å°æ‡‰çš„ OSI å±¤ç´šæ¡†æ¡†ä¸­ã€‚</p>
        
        <div class="game-container">
            <div class="draggables">
                <div class="draggable-item" draggable="true" id="drag-mac" ondragstart="drag(event)" onclick="selectItem('drag-mac')">MAC ä½å€ (ç¶²å¡è™Ÿç¢¼)</div>
                <div class="draggable-item" draggable="true" id="drag-ip" ondragstart="drag(event)" onclick="selectItem('drag-ip')">IP ä½å€ (é–€ç‰Œè™Ÿç¢¼)</div>
                <div class="draggable-item" draggable="true" id="drag-port" ondragstart="drag(event)" onclick="selectItem('drag-port')">Port (è»Ÿé«”çª—å£)</div>
            </div>

            <div class="drop-zones">
                <div class="drop-zone" id="drop-transport" data-label="å‚³è¼¸å±¤" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="clickDrop('drop-transport')"></div>
                <div class="drop-zone" id="drop-network" data-label="ç¶²è·¯å±¤" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="clickDrop('drop-network')"></div>
                <div class="drop-zone" id="drop-link" data-label="éˆçµå±¤" ondrop="drop(event)" ondragover="allowDrop(event)" onclick="clickDrop('drop-link')"></div>
            </div>
        </div>
        <p id="game-msg" style="text-align: center; color: var(--correct-color); font-weight: bold; height: 20px;"></p>
    </section>

    <!-- 4. å°åŒ…æµç¨‹äº’å‹• -->
    <section class="card">
        <h2>ğŸ“¦ è³‡æ–™å°è£æµç¨‹æ¼”ç¤º</h2>
        <p>è§€å¯Ÿè³‡æ–™å¾ä¸Šå¾€ä¸‹å‚³éæ™‚ï¼Œæ˜¯ã€Œèª°ã€è² è²¬è²¼ä¸Š MAC æ¨™ç±¤çš„ï¼Ÿ</p>
        
        <div class="flow-diagram" id="packet-container">
            <div id="data-payload" class="packet">è³‡æ–™ (Data)</div>
            <div id="packet-visual" style="margin-top: 10px;"></div>
        </div>
        
        <button class="btn btn-flow" onclick="playEncapsulation()">é–‹å§‹å°è£ (å¾€ä¸‹å±¤å‚³é€)</button>
        <p id="flow-status" style="text-align: center; font-weight: bold;">æº–å‚™å‚³é€...</p>
    </section>

    <!-- 5. é™·é˜±å¡å€ -->
    <section class="card">
        <h2>âš ï¸ è€ƒè©¦å¸¸è¦‹é™·é˜± (é»æ“Šæ¶ˆé™¤)</h2>
        <div class="trap-grid">
            <div class="trap-card" onclick="removeTrap(this)">
                <h3>é™·é˜± 1ï¼šçœ‹åˆ°ã€Œä½å€ã€å°±é¸ç¶²è·¯å±¤ï¼Ÿ</h3>
                <p>éŒ¯ï¼è¦çœ‹æ˜¯å“ªç¨®ä½å€ã€‚<br>MAC æ˜¯éˆçµå±¤ï¼ŒIP æ‰æ˜¯ç¶²è·¯å±¤ã€‚</p>
            </div>
            <div class="trap-card" onclick="removeTrap(this)">
                <h3>é™·é˜± 2ï¼šMAC ä½å€ç”¨ä¾†ä¸Šç¶²ï¼Ÿ</h3>
                <p>éŒ¯ï¼MAC åªåœ¨å€åŸŸç¶²è·¯ (LAN) å…§æœ‰æ•ˆï¼Œè·¨å‡ºå»è¦é  IPã€‚</p>
            </div>
            <div class="trap-card" onclick="removeTrap(this)">
                <h3>é™·é˜± 3ï¼šå¯¦é«”å±¤ä¹Ÿæœ‰ä½å€ï¼Ÿ</h3>
                <p>éŒ¯ï¼å¯¦é«”å±¤åªæœ‰é›»ç·šè·Ÿè¨Šè™Ÿï¼Œå®Œå…¨æ²’æœ‰ä½å€çš„æ¦‚å¿µã€‚</p>
            </div>
        </div>
    </section>

    <!-- 6. è‡ªæˆ‘æª¢æ¸¬ -->
    <section class="card">
        <h2>ğŸ§  è‡ªæˆ‘æª¢æ¸¬ (ä¸çµ¦ç­”æ¡ˆï¼Œåªçµ¦æç¤º)</h2>
        
        <div class="quiz-item">
            <p><strong>Q1ï¼šARP å”å®š (æŸ¥ IP å°æ‡‰çš„ MAC) ä¸»è¦åœ¨å“ªä¸€å±¤é‹ä½œï¼Ÿ</strong></p>
            <button class="btn" onclick="toggleHint('hint1')">é¡¯ç¤ºæç¤º</button>
            <div id="hint1" class="hint-text">æç¤ºï¼šæ—¢ç„¶å®ƒæ˜¯åœ¨è™•ç† MAC ä½å€ï¼Œé‚£å°±è·Ÿæˆ‘å€‘é€™ä¸€é¡Œçš„ç­”æ¡ˆä¸€æ¨£å–”ï¼</div>
        </div>

        <div class="quiz-item">
            <p><strong>Q2ï¼šè³‡æ–™å°åŒ…ä»€éº¼æ™‚å€™æœƒåŠ ä¸Š MAC ä½å€ï¼Ÿ</strong></p>
            <button class="btn" onclick="toggleHint('hint2')">é¡¯ç¤ºæç¤º</button>
            <div id="hint2" class="hint-text">æç¤ºï¼šç•¶è³‡æ–™å¾ç¶²è·¯å±¤(L3)å¾€ä¸‹ä¸€å±¤å‚³éï¼Œæº–å‚™è®Šæˆã€ŒFrameã€çš„æ™‚å€™ã€‚</div>
        </div>

        <div class="quiz-item">
            <p><strong>Q3ï¼šè€ƒè©¦ä¸­å¦‚ä½•å¿«é€Ÿåˆ†è¾¨ MAC èˆ‡ IPï¼Ÿ</strong></p>
            <button class="btn" onclick="toggleHint('hint3')">é¡¯ç¤ºæç¤º</button>
            <div id="hint3" class="hint-text">æç¤ºï¼šMAC åƒèº«åˆ†è­‰å­—è™Ÿ(ç‡’åœ¨ç¡¬é«”ä¸Šã€éˆçµå±¤)ï¼›IP åƒé–€ç‰Œè™Ÿç¢¼(å¯è®Šå‹•ã€ç¶²è·¯å±¤)ã€‚</div>
        </div>
    </section>

    <button class="btn btn-reset" onclick="resetPage()">ğŸ”„ å…¨éƒ¨é‡ç½® / å†ç·´ç¿’ä¸€æ¬¡</button>

    <footer style="text-align: center; font-size: 0.8rem; color: #777; margin-top: 30px;">
        é›»è…¦æ¦‚è«–äº’å‹•æ•™å­¸ç¶²é  | Designed for Learning
    </footer>
</div>

<script>
    // --- 1. å–®é¸é¡Œé‚è¼¯ ---
    function checkAnswer(selectedOption, btnElement) {
        const feedback = document.getElementById('answer-feedback');
        const allBtns = document.querySelectorAll('.option-btn');
        
        // é‡ç½®æŒ‰éˆ•æ¨£å¼
        allBtns.forEach(btn => {
            btn.classList.remove('correct', 'wrong');
            btn.disabled = true; // é–å®šä½œç­”
        });

        if (selectedOption === 'B') {
            btnElement.classList.add('correct');
            feedback.className = "result-area correct-box show";
            feedback.innerHTML = `
                <h3>ğŸ‰ ç­”å°äº†ï¼å¤ªæ£’äº†ï¼</h3>
                <p><strong>è§£æï¼š</strong>æ²’éŒ¯ï¼<strong>éˆçµå±¤ (Data Link Layer)</strong> çš„ä¸»è¦å·¥ä½œå°±æ˜¯è™•ç†è³‡æ–™æ¡† (Frame)ï¼Œä¸¦ä¸”æª¢æŸ¥ã€å¡«å……ä¾†æºèˆ‡ç›®çš„åœ°çš„ <strong>MAC ä½å€</strong>ã€‚</p>
                <p>è¨˜ä½å£è¨£ï¼š<strong>MAC åœ¨éˆçµå±¤ï¼ŒIP åœ¨ç¶²è·¯å±¤ã€‚</strong></p>
            `;
        } else {
            btnElement.classList.add('wrong');
            // æ‰¾å‡ºæ­£ç¢ºç­”æ¡ˆä¸¦æ¨™ç¤º
            allBtns[1].classList.add('correct'); // B is index 1
            feedback.className = "result-area wrong-box show";
            
            let reason = "";
            if(selectedOption === 'A') reason = "å¯¦é«”å±¤åªè² è²¬å‚³é€é›»å­è¨Šè™Ÿï¼Œä¸ç®¡ä½å€å–”ï¼";
            if(selectedOption === 'C') reason = "ç¶²è·¯å±¤è² è²¬çš„æ˜¯ IP ä½å€ï¼Œä¸æ˜¯ MAC ä½å€ã€‚";
            if(selectedOption === 'D') reason = "å‚³è¼¸å±¤è² è²¬çš„æ˜¯ Port (é€£æ¥åŸ ) èˆ‡å¯é å‚³è¼¸ã€‚";

            feedback.innerHTML = `
                <h3>ğŸ˜¢ ç­”éŒ¯å›‰ï¼</h3>
                <p><strong>éŒ¯èª¤åŸå› ï¼š</strong>${reason}</p>
                <p><strong>æ­£ç¢ºç­”æ¡ˆæ˜¯ (B) éˆçµå±¤</strong>ã€‚</p>
                <p>å› ç‚ºåªæœ‰éˆçµå±¤æœƒè™•ç†ç¡¬é«”ä½å€ (MAC)ã€‚</p>
            `;
        }
    }

    // --- 2. æ‹–æ›³é…å°é‚è¼¯ (æ”¯æ´é»æ“Šèˆ‡æ‹–æ›³) ---
    let selectedId = null;

    function allowDrop(ev) {
        ev.preventDefault();
        ev.target.classList.add('hovered');
    }

    function drag(ev) {
        ev.dataTransfer.setData("text", ev.target.id);
        selectedId = ev.target.id; // ç‚ºäº†é»æ“Šæ¨¡å¼å‚™ä»½
    }

    // é»æ“Šæ¨¡å¼ï¼šé¸æ“‡é …ç›®
    function selectItem(id) {
        // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡æ¨£å¼
        document.querySelectorAll('.draggable-item').forEach(el => el.style.border = "none");
        
        selectedId = id;
        document.getElementById(id).style.border = "3px solid #f1c40f";
        document.getElementById("game-msg").innerText = "å·²é¸æ“‡ï¼Œè«‹é»æ“Šä¸‹æ–¹çš„æ­£ç¢ºå±¤ç´šæ¡†æ¡†";
    }

    // é»æ“Šæ¨¡å¼ï¼šæ”¾ç½®
    function clickDrop(targetId) {
        if (!selectedId) return;
        processMatch(selectedId, targetId);
        // æ¸…é™¤é¸æ“‡ç‹€æ…‹
        document.querySelectorAll('.draggable-item').forEach(el => el.style.border = "none");
        selectedId = null;
    }

    // æ‹–æ›³æ¨¡å¼ï¼šæ”¾ç½®
    function drop(ev) {
        ev.preventDefault();
        ev.target.classList.remove('hovered');
        var data = ev.dataTransfer.getData("text");
        processMatch(data, ev.target.id);
    }

    function processMatch(itemId, zoneId) {
        // å®šç¾©æ­£ç¢ºé…å°é—œä¿‚
        const answers = {
            'drag-mac': 'drop-link',
            'drag-ip': 'drop-network',
            'drag-port': 'drop-transport'
        };

        const msg = document.getElementById("game-msg");

        if (answers[itemId] === zoneId) {
            const item = document.getElementById(itemId);
            const zone = document.getElementById(zoneId);
            
            // è¦–è¦ºç§»å‹•
            zone.innerHTML = ""; // æ¸…ç©ºæ–‡å­—
            item.style.margin = "0";
            item.style.cursor = "default";
            item.draggable = false;
            item.onclick = null; // ç§»é™¤é»æ“Šäº‹ä»¶
            zone.appendChild(item);
            zone.classList.add('correct');
            
            msg.innerText = "âœ¨ é…å°æ­£ç¢ºï¼";
            msg.style.color = "#27ae60";
        } else {
            msg.innerText = "âŒ é…å°éŒ¯èª¤ï¼Œå†æƒ³ä¸€ä¸‹å®šç¾©ï¼";
            msg.style.color = "#e74c3c";
            setTimeout(() => { msg.innerText = ""; }, 1500);
        }
    }

    // --- 3. å°åŒ…æµç¨‹å‹•ç•« ---
    function playEncapsulation() {
        const visual = document.getElementById('packet-visual');
        const status = document.getElementById('flow-status');
        const btn = document.querySelector('.btn-flow');
        
        btn.disabled = true;
        visual.innerHTML = ""; 
        status.innerText = "æ‡‰ç”¨å±¤è³‡æ–™ç”¢ç”Ÿä¸­...";

        // æ­¥é©Ÿ 1: åŸå§‹è³‡æ–™
        setTimeout(() => {
            visual.innerHTML = `<div class="packet" style="width:100px;">Data</div>`;
            status.innerText = "å‚³è¼¸å±¤ï¼šåŠ ä¸Š Port...";
        }, 500);

        // æ­¥é©Ÿ 2: å‚³è¼¸å±¤
        setTimeout(() => {
            visual.innerHTML = `
                <div style="border:2px dashed #3498db; padding:5px; display:inline-block;">
                    <span class="header-added">Port</span>
                    <span class="packet" style="width:100px; display:inline-block;">Data</span>
                </div>`;
            status.innerText = "ç¶²è·¯å±¤ï¼šåŠ ä¸Š IP ä½å€...";
        }, 1500);

        // æ­¥é©Ÿ 3: ç¶²è·¯å±¤
        setTimeout(() => {
            visual.innerHTML = `
                <div style="border:2px dashed #2980b9; padding:5px; display:inline-block;">
                    <span class="header-added">IP</span>
                    <span class="header-added">Port</span>
                    <span class="packet" style="width:100px; display:inline-block;">Data</span>
                </div>`;
            status.innerHTML = "ğŸ”´ é—œéµæ™‚åˆ»ï¼éˆçµå±¤ï¼šåŠ ä¸Š MAC ä½å€...";
        }, 2500);

        // æ­¥é©Ÿ 4: éˆçµå±¤ (é‡é»)
        setTimeout(() => {
            visual.innerHTML = `
                <div style="border:2px solid red; background:#fff9c4; padding:5px; display:inline-block; transform: scale(1.1);">
                    <span class="header-added mac-header">MAC Header</span>
                    <span class="header-added">IP</span>
                    <span class="header-added">Port</span>
                    <span class="packet" style="width:100px; display:inline-block;">Data</span>
                    <span class="header-added mac-header">FCS(æª¢æŸ¥ç¢¼)</span>
                </div>`;
            status.innerHTML = "âœ¨ å®Œæˆï¼åœ¨éˆçµå±¤å¡«ä¸Šäº† MAC ä½å€ï¼Œè®Šæˆ Frameï¼";
            status.style.color = "#d35400";
            btn.disabled = false;
            btn.innerText = "å†çœ‹ä¸€æ¬¡æµç¨‹";
        }, 4000);
    }

    // --- 4. é™·é˜±å¡é‚è¼¯ ---
    function removeTrap(card) {
        card.style.opacity = "0";
        setTimeout(() => {
            card.style.display = "none";
        }, 500);
    }

    // --- 5. è‡ªæˆ‘æª¢æ¸¬æç¤º ---
    function toggleHint(id) {
        const hint = document.getElementById(id);
        if (hint.style.display === "block") {
            hint.style.display = "none";
        } else {
            hint.style.display = "block";
        }
    }

    // --- 6. å…¨å±€é‡ç½® ---
    function resetPage() {
        location.reload();
    }
</script>

</body>
</html>