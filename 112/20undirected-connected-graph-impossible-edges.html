<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¡å‘é€£é€šåœ–èˆ‡é‚Šæ•¸é™åˆ¶ - äº’å‹•æ•™å­¸</title>
    <style>
        /* --- åŸºç¤è¨­å®š (Reset & Variables) --- */
        :root {
            --primary-color: #2563eb; /* è—è‰² */
            --secondary-color: #10b981; /* ç¶ è‰² */
            --error-color: #ef4444; /* ç´…è‰² */
            --warning-color: #f59e0b; /* æ©˜è‰² */
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --border-radius: 8px;
            --spacing-unit: 1rem;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        /* --- ç‰ˆé¢çµæ§‹ --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        h2 {
            border-left: 5px solid var(--primary-color);
            padding-left: 10px;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            color: #334155;
        }

        /* --- é¡Œç›®å€ --- */
        .question-box {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            padding: 1.5rem;
            border-radius: var(--border-radius);
        }

        .options-list {
            list-style: none;
            margin-top: 1rem;
        }

        .options-list li {
            padding: 0.5rem 0;
            font-weight: bold;
        }

        /* --- æ ¸å¿ƒè§€å¿µå€ --- */
        .concept-list li {
            margin-bottom: 0.5rem;
        }

        .highlight {
            color: var(--error-color);
            font-weight: bold;
            background-color: #fee2e2;
            padding: 0 4px;
            border-radius: 4px;
        }

        /* --- äº’å‹•æ¨¡æ“¬å€ (æ ¸å¿ƒ) --- */
        .simulation-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 768px) {
            .simulation-container {
                grid-template-columns: 3fr 2fr; /* å·¦ç•«å¸ƒï¼Œå³æ§åˆ¶ */
            }
        }

        /* ç•«å¸ƒ */
        .canvas-wrapper {
            background-color: #f1f5f9;
            border: 2px solid #cbd5e1;
            border-radius: var(--border-radius);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        canvas {
            max-width: 100%;
            height: auto;
            background: #fff;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .control-group {
            background: #f8fafc;
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid #e2e8f0;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s, transform 0.1s;
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-demo {
            background-color: #e2e8f0;
            color: #334155;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-demo:hover {
            background-color: #cbd5e1;
        }

        /* Log é¢æ¿ */
        .log-panel {
            background: #1e293b;
            color: #a3e635; /* Terminal green */
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 150px;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .status-connected { background-color: var(--secondary-color); }
        .status-disconnected { background-color: var(--error-color); }

        /* --- é¸é …ç ´è§£ (Accordion é¢¨æ ¼) --- */
        .accordion-item {
            border: 1px solid #e2e8f0;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            overflow: hidden;
        }

        .accordion-header {
            background: #f8fafc;
            padding: 1rem;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .accordion-header:hover {
            background-color: #f1f5f9;
        }

        .accordion-content {
            padding: 1rem;
            background: white;
            display: none; /* JS åˆ‡æ› */
            border-top: 1px solid #e2e8f0;
        }
        
        .accordion-content.active {
            display: block;
        }

        /* --- å°æ¸¬é©— --- */
        .quiz-option {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            text-align: left;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background-color: #eff6ff;
        }

        .quiz-option.correct {
            border-color: var(--secondary-color);
            background-color: #ecfdf5;
        }

        .quiz-option.wrong {
            border-color: var(--error-color);
            background-color: #fef2f2;
        }

        .feedback-area {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }
        
        .goto-simulation-btn {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* è¦–è¦ºå‹•ç•«æç¤º */
        @keyframes pulse-yellow {
            0% { background-color: transparent; }
            50% { background-color: #fef08a; }
            100% { background-color: transparent; }
        }
        
        .highlight-pulse {
            animation: pulse-yellow 2s ease-in-out infinite;
        }

    </style>
</head>
<body>

    <header>
        <div class="container">
            <h1>ç„¡å‘é€£é€šåœ–ï¼šé‚Šæ•¸çš„ä¸å¯èƒ½ä»»å‹™</h1>
            <p>Undirected Connected Graph: Impossible Edge Counts</p>
            <div style="margin-top: 10px; font-size: 0.9rem; background: rgba(255,255,255,0.2); display: inline-block; padding: 5px 15px; border-radius: 20px;">
                æ ¸å¿ƒè§€å¿µï¼šè¦é€£é€šï¼Œæœ€å°‘è¦ N-1 æ¢é‚Š
            </div>
        </div>
    </header>

    <div class="container">

        <!-- 1. é¡Œç›®å€ -->
        <section id="problem-section">
            <h2>æœ¬é¡Œ</h2>
            <div class="question-box">
                <p>ä¸€å€‹æ²’æ–¹å‘æ€§çš„é€£æ¥ç¶²è·¯åœ–ï¼ˆUndirected Connected Graphï¼‰ï¼Œè‹¥ç¯€é»æ•¸ç‚º <strong>N</strong>ï¼ˆNï¼2ï¼‰ï¼Œå‰‡å…¶é‚Šçš„å€‹æ•¸<strong>ä¸å¯èƒ½</strong>ç‚ºä½•ï¼Ÿ</p>
                <ul class="options-list">
                    <li>(A) N-2</li>
                    <li>(B) N-1</li>
                    <li>(C) N</li>
                    <li>(D) N+1</li>
                </ul>
            </div>
        </section>

        <!-- 2. æ ¸å¿ƒè§€å¿µå€ -->
        <section>
            <h2>æ ¸å¿ƒè§€å¿µ (Core Concepts)</h2>
            <p style="margin-bottom: 1rem;">
                åœ¨åœ–è«–ï¼ˆGraph Theoryï¼‰ä¸­ï¼Œè¦è®“ N å€‹ç¯€é»ï¼ˆNodesï¼‰å…¨éƒ¨ä¸²é€£åœ¨ä¸€èµ·ï¼ˆConnectedï¼‰ï¼Œå°±åƒè¦ç”¨é›»ç·šæŠŠ N å€‹æˆ¿å­é€šé€šé€šé›»ä¸€æ¨£ã€‚
            </p>
            <ul class="concept-list" style="padding-left: 1.5rem;">
                <li><strong>é€£é€š (Connected)ï¼š</strong> åœ–ä¸­ä»»æ„å…©å€‹ç¯€é»ä¹‹é–“ï¼Œè‡³å°‘æœ‰ä¸€æ¢è·¯å¾‘å¯ä»¥èµ°åˆ°ã€‚</li>
                <li><strong>æœ€å°‘é‚Šæ•¸ (Minimum Edges)ï¼š</strong> è¦é€£é€š N å€‹é»ï¼Œæœ€å°‘éœ€è¦ <span class="highlight">N-1</span> æ¢é‚Šã€‚é€™æ™‚å½¢æˆä¸€å€‹ã€Œæ¨¹ (Tree)ã€ã€‚</li>
                <li><strong>æ–·é–‹ (Disconnected)ï¼š</strong> å¦‚æœé‚Šæ•¸å°‘æ–¼ N-1 (ä¾‹å¦‚ <span class="highlight">N-2</span>)ï¼Œç¯€é»æ•¸é‡ä¸å¤ ï¼Œåœ–å½¢ä¸€å®šæœƒæ–·è£‚æˆå…©å€‹æˆ–å¤šå€‹å€å¡Šï¼Œç¨±ç‚ºé€£é€šåˆ†é‡ (Connected Components)ã€‚</li>
            </ul>
        </section>

        <!-- 3. äº’å‹•æ¨¡æ“¬å€ -->
        <section id="simulation-section">
            <h2>äº’å‹•æ¨¡æ“¬å¯¦é©—å®¤ (Interactive Lab)</h2>
            <p style="margin-bottom: 1rem; color: var(--text-sub);">
                èª¿æ•´ N èˆ‡ Eï¼Œè§€å¯Ÿä»€éº¼æ™‚å€™åœ–æœƒæ–·é–‹ï¼Ÿ<br>
                <small id="hint-text">æç¤ºï¼šæ³¨æ„çœ‹ç•¶ E < N-1 æ™‚æœƒç™¼ç”Ÿä»€éº¼ã€‚</small>
            </p>

            <div class="simulation-container">
                <!-- å·¦å´ï¼šç•«å¸ƒ -->
                <div class="canvas-wrapper">
                    <canvas id="graphCanvas" width="400" height="350"></canvas>
                </div>

                <!-- å³å´ï¼šæ§åˆ¶ -->
                <div class="controls">
                    <!-- åƒæ•¸æ§åˆ¶ -->
                    <div class="control-group">
                        <label for="sliderN">ç¯€é»æ•¸ (Nodes, N): <span id="valN">5</span></label>
                        <input type="range" id="sliderN" min="3" max="10" value="5">
                    </div>

                    <div class="control-group">
                        <label for="sliderE">é‚Šæ•¸ (Edges, E): <span id="valE">3</span></label>
                        <input type="range" id="sliderE" min="0" max="10" value="3">
                        <div style="font-size: 0.85rem; margin-top: 5px; color: #64748b;">
                            é€£é€šé–€æª» (N-1): <span id="thresholdDisplay" style="font-weight:bold;">4</span>
                        </div>
                    </div>

                    <!-- å¿«é€Ÿç¤ºç¯„æŒ‰éˆ• -->
                    <div class="control-group">
                        <label>ä¸€éµç¤ºç¯„ (Quick Demo)</label>
                        <div class="btn-group">
                            <button class="btn-demo" onclick="setPreset('impossible')">E = N-2<br>(å¿…ä¸é€£é€š)</button>
                            <button class="btn-demo" onclick="setPreset('tree')">E = N-1<br>(æ¨¹/é€£é€š)</button>
                            <button class="btn-demo" onclick="setPreset('cycle')">E = N<br>(é€£é€š+è¿´åœˆ)</button>
                        </div>
                    </div>

                    <!-- Log å€ -->
                    <div class="log-panel" id="logPanel">
                        <!-- JS å‹•æ…‹å¯«å…¥ -->
                        åˆå§‹åŒ–å®Œæˆ... è«‹èª¿æ•´æ»‘æ¡¿æˆ–é»æ“Šç¤ºç¯„æŒ‰éˆ•ã€‚
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. é¸é …é€ä¸€ç ´è§£ -->
        <section>
            <h2>é¸é …é€ä¸€ç ´è§£</h2>
            <p>é»æ“Šå±•é–‹æŸ¥çœ‹è©³ç´°è§£æï¼š</p>
            
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    (A) N-2 <span style="font-size: 0.8em; color: var(--error-color);">[ä¸å¯èƒ½é€£é€š]</span>
                </div>
                <div class="accordion-content">
                    <p><strong>é€™æ˜¯æ­£ç¢ºç­”æ¡ˆï¼ˆé¡Œç›®å•ä¸å¯èƒ½çš„ï¼‰ã€‚</strong></p>
                    <p>æ•¸å­¸ä¸Šå·²è­‰æ˜ï¼Œæ“æœ‰ N å€‹ç¯€é»çš„åœ–ï¼Œè‹¥è¦é€£é€šï¼Œé‚Šæ•¸ E å¿…é ˆæ»¿è¶³ $E \ge N-1$ã€‚</p>
                    <p>ç•¶ $E = N-2$ æ™‚ï¼Œé‚Šçš„æ•¸é‡æ ¹æœ¬ä¸å¤ æŠŠæ‰€æœ‰é»ä¸²èµ·ä¾†ï¼Œåœ–å½¢ä¸€å®šæœƒåˆ†è£‚æˆè‡³å°‘å…©å€‹ã€Œé€£é€šåˆ†é‡ã€ã€‚</p>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    (B) N-1 <span style="font-size: 0.8em; color: var(--secondary-color);">[å¯èƒ½]</span>
                </div>
                <div class="accordion-content">
                    <p><strong>é€™æ˜¯å¯èƒ½çš„ï¼ˆå½¢æˆæ¨¹ Treeï¼‰ã€‚</strong></p>
                    <p>ç•¶é‚Šæ•¸å‰›å¥½æ˜¯ N-1 ä¸”åœ–é€£é€šæ™‚ï¼Œé€™å€‹åœ–è¢«ç¨±ç‚ºã€Œæ¨¹ã€ã€‚å®ƒçš„ç‰¹è‰²æ˜¯æ²’æœ‰è¿´åœˆï¼ˆNo Cycleï¼‰ï¼Œä¸”ä»»æ„æ–·é–‹ä¸€æ¢é‚Šï¼Œåœ–å°±æœƒè®Šå¾—ä¸é€£é€šã€‚</p>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    (C) N <span style="font-size: 0.8em; color: var(--secondary-color);">[å¯èƒ½]</span>
                </div>
                <div class="accordion-content">
                    <p><strong>é€™æ˜¯å¯èƒ½çš„ã€‚</strong></p>
                    <p>å¦‚æœä½ åœ¨æ¨¹ï¼ˆN-1 æ¢é‚Šï¼‰çš„åŸºç¤ä¸Šï¼Œéš¨ä¾¿æ‰¾å…©å€‹å·²ç¶“é€£é€šçš„é»å†åŠ ä¸€æ¢é‚Šï¼Œé‚Šæ•¸å°±æœƒè®Šæˆ Nã€‚é€™æœƒç”¢ç”Ÿä¸€å€‹ã€Œè¿´åœˆ (Cycle)ã€ï¼Œä½†åœ–ä¾ç„¶ä¿æŒé€£é€šã€‚</p>
                </div>
            </div>

            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    (D) N+1 <span style="font-size: 0.8em; color: var(--secondary-color);">[å¯èƒ½]</span>
                </div>
                <div class="accordion-content">
                    <p><strong>é€™æ˜¯å¯èƒ½çš„ã€‚</strong></p>
                    <p>åªè¦é‚Šæ•¸å¤§æ–¼ç­‰æ–¼ N-1ï¼Œåœ–å°±æœ‰ã€Œæ©Ÿæœƒã€é€£é€šï¼ˆç•¶ç„¶å¦‚æœé‚Šéƒ½äº‚é€£åœ¨åŒä¸€å€ï¼Œä¹Ÿå¯èƒ½ä¸é€£é€šï¼Œä½†é¡Œç›®å•çš„æ˜¯æ•¸å€¼å­˜åœ¨çš„å¯èƒ½æ€§ï¼‰ã€‚N+1 æ¢é‚Šé€šå¸¸ä»£è¡¨åœ–ä¸­æœ‰æ›´å¤šçš„è¿´è·¯ï¼Œé€£é€šæ€§æ›´å¼·ã€‚</p>
                </div>
            </div>
        </section>

        <!-- 5. å°æ¸¬é©— -->
        <section id="quiz-section">
            <h2>éš¨å ‚æ¸¬é©— (Quiz)</h2>
            <p>ä¸€å€‹æ²’æ–¹å‘æ€§çš„é€£æ¥ç¶²è·¯åœ–ï¼Œç¯€é»ç‚º N (N>2)ï¼Œå‰‡å…¶é‚Šçš„å€‹æ•¸<strong>ä¸å¯èƒ½</strong>ç‚ºä½•ï¼Ÿ</p>
            
            <div style="margin-top: 1rem;">
                <button class="quiz-option" onclick="checkAnswer('A', this)">(A) N - 2</button>
                <button class="quiz-option" onclick="checkAnswer('B', this)">(B) N - 1</button>
                <button class="quiz-option" onclick="checkAnswer('C', this)">(C) N</button>
                <button class="quiz-option" onclick="checkAnswer('D', this)">(D) N + 1</button>
            </div>

            <div id="quiz-feedback" class="feedback-area"></div>
        </section>

        <!-- 6. å»¶ä¼¸çŸ¥è­˜ -->
        <section>
            <h2>å»¶ä¼¸çŸ¥è­˜ (Extended Knowledge)</h2>
            <ul style="padding-left: 1.5rem;">
                <li><strong>å®Œå…¨åœ– (Complete Graph)ï¼š</strong> è‹¥ä»»å…©é»éƒ½æœ‰é‚Šç›¸é€£ï¼Œé‚Šæ•¸æœƒé”åˆ°æœ€å¤§å€¼ $N(N-1)/2$ã€‚</li>
                <li><strong>æ¨¹ (Tree) çš„æ€§è³ªï¼š</strong> N å€‹é»ã€N-1 æ¢é‚Šã€é€£é€šã€ç„¡è¿´åœˆã€‚é€™å››å€‹æ€§è³ªåªè¦æ»¿è¶³å…¶ä¸­å…©å€‹ï¼Œé€šå¸¸å°±èƒ½æ¨å°å‡ºå¦å¤–å…©å€‹ï¼ˆè¦–å®šç¾©è€Œå®šï¼‰ã€‚</li>
                <li><strong>ç¾å¯¦æ‡‰ç”¨ï¼š</strong> é‹ªè¨­ç¶²è·¯çºœç·šæˆ–è¨­è¨ˆé›»è·¯æ¿æ™‚ï¼Œç‚ºäº†ç¯€çœæˆæœ¬ï¼Œæˆ‘å€‘å¸¸å°‹æ‰¾ã€Œæœ€å°ç”Ÿæˆæ¨¹ (Minimum Spanning Tree)ã€ï¼Œä¹Ÿå°±æ˜¯ç”¨æœ€å°‘çš„é‚Šï¼ˆæˆæœ¬ï¼‰è®“æ‰€æœ‰é»é€£é€šã€‚</li>
            </ul>
        </section>

    </div>

    <!-- JavaScript é‚è¼¯ -->
    <script>
    (function() {
        // --- è®Šæ•¸èˆ‡åˆå§‹åŒ– ---
        const canvas = document.getElementById('graphCanvas');
        const ctx = canvas.getContext('2d');
        const sliderN = document.getElementById('sliderN');
        const sliderE = document.getElementById('sliderE');
        const valN = document.getElementById('valN');
        const valE = document.getElementById('valE');
        const thresholdDisplay = document.getElementById('thresholdDisplay');
        const logPanel = document.getElementById('logPanel');

        let N = 5;
        let E = 3;
        let nodes = [];
        let edges = [];
        let components = []; // å„²å­˜é€£é€šåˆ†é‡è³‡è¨Š

        // åˆå§‹åŒ–
        updateMaxEdges();
        generateGraph('random');

        // --- äº‹ä»¶ç›£è½ ---
        sliderN.addEventListener('input', (e) => {
            N = parseInt(e.target.value);
            valN.textContent = N;
            thresholdDisplay.textContent = N - 1;
            updateMaxEdges();
            // ä¿æŒ E åœ¨åˆç†ç¯„åœ
            if (E > N * (N - 1) / 2) {
                E = Math.floor(N * (N - 1) / 2);
                sliderE.value = E;
                valE.textContent = E;
            }
            generateGraph('random');
        });

        sliderE.addEventListener('input', (e) => {
            E = parseInt(e.target.value);
            valE.textContent = E;
            generateGraph('random');
        });

        // æ›´æ–° E æ»‘æ¡¿çš„æœ€å¤§å€¼
        function updateMaxEdges() {
            const maxE = (N * (N - 1)) / 2;
            sliderE.max = maxE;
        }

        // --- æ ¸å¿ƒé‚è¼¯ï¼šç”Ÿæˆåœ–èˆ‡è¨ˆç®— ---
        
        // ç”Ÿæˆåœ–å½¢è³‡æ–™çµæ§‹
        // mode: 'random' (éš¨æ©Ÿé‚Š), 'tree' (å¼·åˆ¶ç”Ÿæˆæ¨¹), 'cycle' (æ¨¹+1é‚Š), 'impossible' (N-2é‚Š)
        function generateGraph(mode) {
            // 1. ç”Ÿæˆç¯€é»åº§æ¨™ (åœ“å½¢æ’åˆ—)
            nodes = [];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 120;
            
            for (let i = 0; i < N; i++) {
                const angle = (i * 2 * Math.PI) / N - Math.PI / 2; // å¾ä¸Šæ–¹é–‹å§‹
                nodes.push({
                    id: i,
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle)
                });
            }

            // 2. ç”Ÿæˆé‚Š
            edges = [];
            
            if (mode === 'tree') {
                // å¼·åˆ¶ç”Ÿæˆæ¨¹ï¼šN-1 é‚Šï¼Œä¿è­‰é€£é€š
                // ç°¡å–®ä½œæ³•ï¼š0é€£1, 1é€£2... æˆ–éš¨æ©Ÿæ‰“äº‚å¾Œä¸²æ¥
                // ç‚ºäº†è¦–è¦ºå¥½çœ‹ï¼Œæˆ‘å€‘éš¨æ©Ÿä¸²æ¥
                let visited = [0];
                let unvisited = [];
                for(let i=1; i<N; i++) unvisited.push(i);

                while(unvisited.length > 0) {
                    // å¾å·²è¨ªå•ä¸­é¸ä¸€å€‹
                    let u = visited[Math.floor(Math.random() * visited.length)];
                    // å¾æœªè¨ªå•ä¸­é¸ä¸€å€‹
                    let vIndex = Math.floor(Math.random() * unvisited.length);
                    let v = unvisited[vIndex];
                    
                    edges.push({source: u, target: v});
                    visited.push(v);
                    unvisited.splice(vIndex, 1);
                }
                
                // åŒæ­¥æ»‘æ¡¿
                E = N - 1;
                sliderE.value = E;
                valE.textContent = E;

            } else if (mode === 'impossible') {
                // å¼·åˆ¶ N-2 é‚Š (éš¨æ©Ÿé¸å–)
                E = N - 2;
                sliderE.value = E;
                valE.textContent = E;
                generateRandomEdges(E);

            } else if (mode === 'cycle') {
                // æ¨¹ + 1 é‚Š (é€£é€šä¸”æœ‰åœˆ)
                // å…ˆé€ æ¨¹
                let visited = [0];
                let unvisited = [];
                for(let i=1; i<N; i++) unvisited.push(i);

                while(unvisited.length > 0) {
                    let u = visited[Math.floor(Math.random() * visited.length)];
                    let vIndex = Math.floor(Math.random() * unvisited.length);
                    let v = unvisited[vIndex];
                    edges.push({source: u, target: v});
                    visited.push(v);
                    unvisited.splice(vIndex, 1);
                }

                // åŠ  1 æ¢ä¸é‡è¤‡çš„é‚Š
                E = N;
                let added = false;
                let attempts = 0;
                while(!added && attempts < 100) {
                    let u = Math.floor(Math.random() * N);
                    let v = Math.floor(Math.random() * N);
                    if (u !== v && !edgeExists(u, v)) {
                        edges.push({source: u, target: v});
                        added = true;
                    }
                    attempts++;
                }
                
                sliderE.value = E;
                valE.textContent = E;

            } else {
                // ä¸€èˆ¬éš¨æ©Ÿæ¨¡å¼ (slider è§¸ç™¼)
                generateRandomEdges(E);
            }

            // 3. æª¢æŸ¥é€£é€šæ€§ (BFS)
            checkConnectivity();

            // 4. ç¹ªåœ–
            draw();

            // 5. æ›´æ–° Log
            updateLog(mode);
        }

        // è¼”åŠ©ï¼šç”ŸæˆæŒ‡å®šæ•¸é‡çš„éš¨æ©Ÿé‚Š (ä¸é‡è¤‡ã€ç„¡è‡ªç’°)
        function generateRandomEdges(count) {
            edges = [];
            let allPossibleEdges = [];
            for (let i = 0; i < N; i++) {
                for (let j = i + 1; j < N; j++) {
                    allPossibleEdges.push({source: i, target: j});
                }
            }

            // æ´—ç‰Œ
            for (let i = allPossibleEdges.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allPossibleEdges[i], allPossibleEdges[j]] = [allPossibleEdges[j], allPossibleEdges[i]];
            }

            // å–å‰ count å€‹
            edges = allPossibleEdges.slice(0, count);
        }

        // è¼”åŠ©ï¼šæª¢æŸ¥é‚Šæ˜¯å¦å­˜åœ¨
        function edgeExists(u, v) {
            return edges.some(e => (e.source === u && e.target === v) || (e.source === v && e.target === u));
        }

        // æŒ‰éˆ•é è¨­åŠŸèƒ½
        function setPreset(mode) {
            generateGraph(mode);
            // è¦–è¦ºæç¤º
            const hint = document.getElementById('hint-text');
            hint.classList.add('highlight-pulse');
            setTimeout(() => hint.classList.remove('highlight-pulse'), 2000);
        }

        // --- BFS é€£é€šæ€§æª¢æŸ¥æ¼”ç®—æ³• ---
        function checkConnectivity() {
            // å»ºé„°æ¥è¡¨
            let adj = Array.from({length: N}, () => []);
            edges.forEach(e => {
                adj[e.source].push(e.target);
                adj[e.target].push(e.source);
            });

            let visited = new Array(N).fill(false);
            let componentCount = 0;
            components = new Array(N).fill(0); // ç´€éŒ„æ¯å€‹ node å±¬æ–¼å“ªå€‹ component ID

            for (let i = 0; i < N; i++) {
                if (!visited[i]) {
                    componentCount++;
                    // BFS Start
                    let queue = [i];
                    visited[i] = true;
                    components[i] = componentCount;

                    while (queue.length > 0) {
                        let u = queue.shift();
                        for (let v of adj[u]) {
                            if (!visited[v]) {
                                visited[v] = true;
                                components[v] = componentCount;
                                queue.push(v);
                            }
                        }
                    }
                }
            }
            return componentCount;
        }

        // --- ç¹ªåœ–é‚è¼¯ ---
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // å®šç¾©é€£é€šåˆ†é‡é¡è‰² (æœ€å¤šæ”¯æ´ 10 å€‹åˆ†é‡ä¸åŒè‰²)
            const componentColors = [
                '#94a3b8', // 0 (unused)
                '#2563eb', // Blue
                '#dc2626', // Red
                '#16a34a', // Green
                '#d97706', // Amber
                '#9333ea', // Purple
                '#0891b2', // Cyan
                '#be185d', // Pink
                '#4f46e5', // Indigo
                '#ca8a04'  // Yellow-dark
            ];

            const componentCount = checkConnectivity();
            const isConnected = componentCount === 1;

            // ç•«é‚Š
            ctx.lineWidth = 2;
            edges.forEach(e => {
                const u = nodes[e.source];
                const v = nodes[e.target];
                
                // å¦‚æœå…©é»å±¬æ–¼åŒä¸€åˆ†é‡(ä¸€å®šå±¬æ–¼)ï¼Œçµ¦äºˆåˆ†é‡é¡è‰²
                // å¦‚æœåœ–ä¸é€£é€šï¼Œé‚Šç”¨ç°è‰²æˆ–åˆ†é‡è‰²ï¼›è‹¥é€£é€šï¼Œç”¨æ¨™æº–è‰²
                ctx.strokeStyle = '#94a3b8'; // é è¨­ç°
                if (components[e.source] === components[e.target]) {
                    // ä½¿ç”¨åˆ†é‡é¡è‰²ï¼Œå¦‚æœä¸é€£é€šå¯ä»¥æ›´æ˜é¡¯çœ‹å‡ºåˆ†ç¾¤
                    if (!isConnected) {
                        ctx.strokeStyle = componentColors[components[e.source] % componentColors.length];
                        ctx.globalAlpha = 0.5; // ä¸é€£é€šæ™‚é‚Šæ·¡ä¸€é»
                    } else {
                        ctx.strokeStyle = '#334155'; // é€£é€šæ™‚æ·±è‰²
                        ctx.globalAlpha = 1.0;
                    }
                }
                
                ctx.beginPath();
                ctx.moveTo(u.x, u.y);
                ctx.lineTo(v.x, v.y);
                ctx.stroke();
                ctx.globalAlpha = 1.0;
            });

            // ç•«ç¯€é»
            nodes.forEach((node, idx) => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 18, 0, 2 * Math.PI);
                
                // å¡«è‰²ï¼šä¾æ“šé€£é€šåˆ†é‡ ID
                let colorIndex = components[idx] % componentColors.length;
                ctx.fillStyle = componentColors[colorIndex];
                
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 3;
                ctx.stroke();

                // æ–‡å­—
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(idx, node.x, node.y);
            });

            // å·¦ä¸Šè§’ç‹€æ…‹æ–‡å­—
            ctx.fillStyle = '#1e293b';
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'left';
            
            let statusText = isConnected ? "ç‹€æ…‹: é€£é€š (Connected)" : "ç‹€æ…‹: ä¸é€£é€š (Disconnected)";
            ctx.fillText(statusText, 10, 25);

            if (!isConnected) {
                ctx.font = '14px sans-serif';
                ctx.fillStyle = '#ef4444';
                ctx.fillText(`é€£é€šåˆ†é‡æ•¸: ${componentCount}`, 10, 45);
            }
        }

        // --- Log æ›´æ–° ---
        function updateLog(mode) {
            const componentCount = checkConnectivity();
            const isConnected = componentCount === 1;
            const threshold = N - 1;

            let html = `<div>ç›®å‰è¨­å®šï¼šN = ${N}, E = ${E}</div>`;
            html += `<div>æœ€å°‘é€£é€šéœ€æ±‚ (N-1) = ${threshold}</div>`;
            html += `<hr style="border-color:#334155; margin: 8px 0;">`;

            // åˆ¤æ–·é‚è¼¯è¼¸å‡º
            if (E < threshold) {
                html += `<div style="color: #ef4444;">âŒ E < N-1 (${E} < ${threshold})</div>`;
                html += `<div>çµè«–ï¼š<strong>å¿…ä¸é€£é€š (Impossible)</strong></div>`;
                html += `<div>ç¯€é»æ•¸ä¸å¤ é€£æˆä¸€ç·šï¼Œä¸€å®šæœƒæ–·é–‹ã€‚</div>`;
            } else if (E === threshold) {
                 if (isConnected) {
                    html += `<div style="color: #4ade80;">âœ… E = N-1 (å‰›å¥½)</div>`;
                    html += `<div>ç‹€æ…‹ï¼šé€£é€š (é€™æ˜¯ã€Œæ¨¹ã€)</div>`;
                    html += `<div>é€™æ˜¯é”æˆé€£é€šçš„æœ€å°‘é‚Šæ•¸ã€‚</div>`;
                 } else {
                    html += `<div style="color: #fbbf24;">âš ï¸ E = N-1 (ä½†æœªé€£é€š)</div>`;
                    html += `<div>æ³¨æ„ï¼šé‚Šæ•¸å¤ ä¸ä»£è¡¨ä¸€å®šé€£é€š(å¯èƒ½æˆåœˆ)ã€‚</div>`;
                    html += `<div>ä½†é¡Œç›®å•çš„æ˜¯ã€Œæ˜¯å¦å¯èƒ½ã€ï¼Œç­”æ¡ˆæ˜¯å¯èƒ½ã€‚</div>`;
                 }
            } else {
                // E > N-1
                if (isConnected) {
                    html += `<div style="color: #4ade80;">âœ… E > N-1 (å……è£•)</div>`;
                    html += `<div>ç‹€æ…‹ï¼šé€£é€š</div>`;
                    html += `<div>é‚Šæ•¸å¤šæ–¼ N-1ï¼Œé€šå¸¸æœƒå½¢æˆè¿´åœˆã€‚</div>`;
                } else {
                    html += `<div style="color: #fbbf24;">âš ï¸ E > N-1 (ä½†æœªé€£é€š)</div>`;
                    html += `<div>é‹æ°£ä¸å¥½ï¼é›–ç„¶é‚Šæ•¸å¤ å¤šï¼Œä½†æ²’é€£åˆ°å­¤ç«‹é»ã€‚</div>`;
                }
            }

            logPanel.innerHTML = html;
        }

        // --- äº’å‹• UI è¼”åŠ© ---
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }

        function checkAnswer(option, btnElement) {
            const feedback = document.getElementById('quiz-feedback');
            const allBtns = document.querySelectorAll('.quiz-option');
            
            // é‡ç½®æ¨£å¼
            allBtns.forEach(b => {
                b.classList.remove('correct', 'wrong');
            });

            if (option === 'A') {
                // ç­”å°
                btnElement.classList.add('correct');
                feedback.style.display = 'block';
                feedback.style.backgroundColor = '#ecfdf5';
                feedback.style.border = '1px solid #10b981';
                feedback.innerHTML = `
                    <h3 style="color: #059669;">ğŸ‰ ç­”å°äº†ï¼</h3>
                    <p>è‹¥ N å€‹é»è¦é€£é€šï¼Œæœ€å°‘ä¸€å®šè¦ N-1 æ¢é‚Šã€‚</p>
                    <p>æ‰€ä»¥ N-2 æ¢é‚Š<strong>çµ•å°ä¸å¯èƒ½</strong>è®“åœ–é€£é€šã€‚</p>
                `;
            } else {
                // ç­”éŒ¯
                btnElement.classList.add('wrong');
                feedback.style.display = 'block';
                feedback.style.backgroundColor = '#fef2f2';
                feedback.style.border = '1px solid #ef4444';
                feedback.innerHTML = `
                    <h3 style="color: #dc2626;">âŒ å†æƒ³ä¸€ä¸‹...</h3>
                    <p>é‚Šæ•¸æ˜¯ ${option === 'B' ? 'N-1' : (option === 'C' ? 'N' : 'N+1')} æ˜¯ã€Œå¯èƒ½ã€é€£é€šçš„ã€‚</p>
                    <p>é¡Œç›®å•çš„æ˜¯ã€Œ<strong>ä¸å¯èƒ½</strong>ã€ã€‚</p>
                    <a href="#simulation-section" class="goto-simulation-btn" onclick="setPreset('impossible')">
                        å¸¶æˆ‘å»çœ‹ E = N-2 çš„æ¨¡æ“¬
                    </a>
                `;
            }
        }

        // å°‡ HTML éœ€è¦å‘¼å«çš„å‡½å¼æ›è¼‰åˆ° window ä¸Š
        window.setPreset = setPreset;
        window.toggleAccordion = toggleAccordion;
        window.checkAnswer = checkAnswer;

    })(); // IIFE çµæŸ
    </script>
</body>
</html>