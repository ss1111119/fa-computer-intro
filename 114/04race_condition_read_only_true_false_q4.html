<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OS äº’å‹•æ•™å­¸ï¼šRace Condition èˆ‡å”¯è®€è®Šæ•¸</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --warning-color: #f39c12;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-radius: 8px;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .header-note {
            font-size: 0.8rem;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 20px;
            font-family: monospace;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
        }

        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }

        h1 {
            text-align: center;
            font-size: 1.8rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        /* æ•™å­¸å°å…¥å€ */
        .intro-box {
            background-color: #e8f4fc;
            border-left: 5px solid var(--primary-color);
        }

        .analogy {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }

        .analogy-item {
            flex: 1;
            min-width: 250px;
            background: rgba(255,255,255,0.7);
            padding: 15px;
            border-radius: var(--border-radius);
            border: 1px solid #dcdcdc;
        }

        .highlight {
            font-weight: bold;
            color: #c0392b;
        }

        /* æ¸¬é©—å€ */
        .quiz-question {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
        }

        .options label {
            display: block;
            margin: 10px 0;
            padding: 15px;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }

        .options input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .options label:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        .btn-submit { background-color: var(--primary-color); color: white; flex: 2; }
        .btn-hint { background-color: var(--warning-color); color: white; flex: 1; }
        .btn-reset { background-color: #95a5a6; color: white; flex: 1; }

        .hints-area {
            margin-top: 15px;
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: var(--border-radius);
            display: none;
        }

        /* è§£æå€ */
        .feedback-area {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border-radius: var(--border-radius);
        }

        .feedback-correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-wrong {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .explanation ul {
            padding-left: 20px;
        }

        /* ç¨‹å¼ç¢¼å°ç…§å€ */
        .code-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .code-block {
            flex: 1;
            min-width: 280px;
            background: #2d3436;
            color: #dfe6e9;
            padding: 15px;
            border-radius: var(--border-radius);
            position: relative;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
        }

        .code-label {
            position: absolute;
            top: -10px;
            right: 10px;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .label-safe { background: var(--success-color); color: white; }
        .label-risk { background: var(--error-color); color: white; }

        /* è¡¨æ ¼å€ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        th {
            background-color: var(--primary-color);
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Accordion & QA */
        .accordion-btn {
            background-color: #eee;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            transition: 0.4s;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: var(--border-radius);
            margin-bottom: 5px;
        }

        .active, .accordion-btn:hover {
            background-color: #ccc;
        }

        .accordion-panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            margin-bottom: 10px;
        }
        
        .qa-item {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .qa-question {
            color: var(--primary-color);
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
        }
        
        .qa-answer {
            display: none;
            margin-top: 5px;
            color: #555;
            padding-left: 10px;
            border-left: 3px solid var(--warning-color);
        }

    </style>
</head>
<body>

    <div class="header-note">æª”åå»ºè­°ï¼šrace_condition_read_only_true_false_q4.html</div>

    <div class="container">
        <h1>å¤šåŸ·è¡Œç·’æ¦‚å¿µï¼šRace Condition ç™¼ç”Ÿæ¢ä»¶</h1>

        <!-- äºŒã€æ•™å­¸å°å…¥ -->
        <div class="card intro-box">
            <h2>ğŸ’¡ è§€å¿µå…ˆä¿®ï¼šä»€éº¼æ™‚å€™æ‰æœƒã€Œå‡ºäº‹ã€ï¼Ÿ</h2>
            <p>æˆ‘å€‘å¯ä»¥æŠŠã€Œå…±äº«è®Šæ•¸ã€æƒ³åƒæˆå­¸æ ¡çš„<strong>å…¬ä½ˆæ¬„</strong>ï¼š</p>
            <div class="analogy">
                <div class="analogy-item">
                    <h3>ğŸ‘€ åªæœ‰è®€å– (Read Only)</h3>
                    <p>å¦‚æœå…¨æ ¡åŒå­¸éƒ½åªæ˜¯ç«™åœ¨å…¬ä½ˆæ¬„å‰<strong>çœ‹</strong>å…¬å‘Šï¼Œå¤§å®¶åŒæ™‚çœ‹ï¼Œå…§å®¹æœƒäº‚æ‰å—ï¼Ÿ</p>
                    <p><strong>ä¸æœƒï¼</strong> å¤§å®¶å„çœ‹å„çš„ï¼Œäº’ä¸å¹²æ“¾ã€‚</p>
                </div>
                <div class="analogy-item">
                    <h3>âœï¸ é€²è¡Œå¯«å…¥ (Write)</h3>
                    <p>å¦‚æœæœ‰äººæƒ³<strong>æ”¹</strong>å…¬å‘Šï¼ˆæ’•æ‰é‡è²¼ï¼‰ï¼ŒåŒæ™‚å¦ä¸€å€‹äººä¹Ÿåœ¨çœ‹æˆ–ä¹Ÿåœ¨æ”¹ï¼Œé€™æ™‚å€™æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</p>
                    <p><strong>æœƒå‡ºå•é¡Œï¼</strong> çœ‹åˆ°çš„å…§å®¹å¯èƒ½åªå‰©ä¸€åŠã€‚</p>
                </div>
            </div>
            <p style="text-align: center; margin-top: 15px; font-weight: bold; font-size: 1.1em;">
                çµè«–ï¼šRace Condition ä¸€å®šè¦æœ‰<span style="color:red;">ã€Œå¯«å…¥ï¼ˆwriteï¼‰ã€</span>è¡Œç‚ºæ‰å¯èƒ½ç™¼ç”Ÿã€‚<br>
                å¦‚æœåªæœ‰è®€å–ï¼ˆreadï¼‰ï¼Œçµ•å°å®‰å…¨ï¼
            </p>
        </div>

        <!-- ä¸‰ã€äº’å‹•ä½œç­”è¨­è¨ˆ -->
        <div class="card">
            <h2>ğŸ“ è§€å¿µæ¸¬é©—</h2>
            <div class="quiz-question">
                é¡Œç›® 4ï¼šåœ¨å¤šåŸ·è¡Œç·’ç¨‹å¼ä¸­ï¼Œå¦‚æœå…©å€‹åŸ·è¡Œç·’åªè®€å–åŒä¸€å€‹è®Šæ•¸ï¼ˆæ²’æœ‰å¯«å…¥ï¼‰ï¼Œé‚£éº¼é€™å€‹è®Šæ•¸å°±ä¸æœƒé€ æˆä»»ä½• race conditionã€‚
            </div>
            
            <form id="quizForm">
                <div class="options">
                    <label>
                        <input type="radio" name="answer" value="A">
                        (A) Oï¼ˆæ­£ç¢ºï¼‰
                    </label>
                    <label>
                        <input type="radio" name="answer" value="B">
                        (B) Xï¼ˆéŒ¯èª¤ï¼‰
                    </label>
                </div>

                <div class="hints-area" id="hintArea"></div>

                <div class="btn-group">
                    <button type="button" class="btn-submit" onclick="submitAnswer()">é€å‡ºç­”æ¡ˆ</button>
                    <button type="button" class="btn-hint" onclick="showNextHint()">çœ‹æç¤º</button>
                    <button type="button" class="btn-reset" onclick="resetQuiz()">é‡ä½œä¸€æ¬¡</button>
                </div>
            </form>

            <!-- å››ã€é€å‡ºå¾Œå³æ™‚è§£æ -->
            <div id="feedbackResult" class="feedback-area">
                <!-- JS å‹•æ…‹å¡«å…¥å…§å®¹ -->
            </div>
        </div>

        <!-- äº”ã€ç¨‹å¼ç¢¼å°ç…§å€ -->
        <div class="card">
            <h2>ğŸ’» ç¨‹å¼ç¢¼å°ç…§ï¼šæœ‰æ²’æœ‰å¯«å…¥æ˜¯é—œéµ</h2>
            <div class="code-container">
                <div class="code-block">
                    <span class="code-label label-safe">å®‰å…¨ (åªæœ‰è®€)</span>
<pre>
// Thread A
printf("%d", x); // è®€å– x

// Thread B
printf("%d", x); // è®€å– x
</pre>
                    <p style="color:#aaa; font-size:0.9em; margin-top:10px;">â” åªæœ‰è®€ â†’ <strong style="color:var(--success-color)">ç„¡é¢¨éšª</strong></p>
                </div>
                <div class="code-block">
                    <span class="code-label label-risk">å±éšª (æœ‰å¯«å…¥)</span>
<pre>
// Thread A
x = x + 1; // è®€å– + å¯«å…¥

// Thread B
x = x + 1; // è®€å– + å¯«å…¥
</pre>
                    <p style="color:#aaa; font-size:0.9em; margin-top:10px;">â” æœ‰å¯«å…¥ â†’ <strong style="color:var(--error-color)">æœ‰é¢¨éšª (Race Condition)</strong></p>
                </div>
            </div>
        </div>

        <!-- å…­ã€é‡é»æ•´ç†è¡¨ -->
        <div class="card">
            <h2>ğŸ“Š å­˜å–å‹æ…‹èˆ‡é¢¨éšªå°ç…§è¡¨</h2>
            <table>
                <thead>
                    <tr>
                        <th>Thread 1 è¡Œç‚º</th>
                        <th>Thread 2 è¡Œç‚º</th>
                        <th>å¯èƒ½ç™¼ç”Ÿ Race Conditionï¼Ÿ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>è®€ (Read)</td>
                        <td>è®€ (Read)</td>
                        <td style="color: var(--success-color); font-weight: bold;">å¦ (å®‰å…¨)</td>
                    </tr>
                    <tr>
                        <td>è®€ (Read)</td>
                        <td>å¯« (Write)</td>
                        <td style="color: var(--error-color); font-weight: bold;">æ˜¯ (å±éšª)</td>
                    </tr>
                    <tr>
                        <td>å¯« (Write)</td>
                        <td>å¯« (Write)</td>
                        <td style="color: var(--error-color); font-weight: bold;">æ˜¯ (å±éšª)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ä¸ƒã€è¨˜æ†¶æŠ€å·§ -->
        <div class="card">
            <h2>ğŸ§  è€ƒè©¦å¿«é€Ÿåˆ¤æ–·å£è¨£</h2>
            <button class="accordion-btn">é»æ“ŠæŸ¥çœ‹å£è¨£èˆ‡æŠ€å·§</button>
            <div class="accordion-panel">
                <div style="padding: 15px 0;">
                    <h3 style="color: var(--primary-color);">å£è¨£ï¼šã€Œæœ‰å¯«æ‰æœƒäº‚ï¼Œæ²’å¯«ä¸æœƒæˆ°ã€</h3>
                    <p>Race condition å°±åƒæ‰“ä»—æ¶åœ°ç›¤ï¼Œå¦‚æœå¤§å®¶éƒ½åªæ˜¯åƒè§€ï¼ˆè®€ï¼‰ï¼Œå°±ä¸æœƒæ‰“èµ·ä¾†ã€‚</p>
                    <hr>
                    <h4>ğŸ“ è€ƒè©¦æé†’ï¼š</h4>
                    <p>åªè¦é¡Œç›®ä¸­å¼·èª¿<strong>ã€Œåªè®€å– (Read Only)ã€</strong>ã€<strong>ã€Œæ²’æœ‰å¯«å…¥ã€</strong>ï¼Œä¸”å•æ˜¯å¦æœ‰ Race Conditionï¼š</p>
                    <p>ğŸ‘‰ ç­”æ¡ˆå¹¾ä¹ç™¾åˆ†ä¹‹ç™¾é¸ <strong>O (ä¸æœƒæœ‰ Race Condition)</strong>ã€‚</p>
                </div>
            </div>
        </div>

        <!-- å…«ã€å»¶ä¼¸å¿«å•å¿«ç­” -->
        <div class="card">
            <h2>ğŸš€ è§€å¿µå¿«å•å¿«ç­” (é»æ“Šå•é¡Œçœ‹ç­”æ¡ˆ)</h2>
            
            <div class="qa-item">
                <div class="qa-question" onclick="toggleQA(this)">Q1ï¼šç‚ºä»€éº¼ Mutex (äº’æ–¥é–) é€šå¸¸ç”¨åœ¨å¯«å…¥å€æ®µ (Critical Section)ï¼Ÿ</div>
                <div class="qa-answer">
                    å› ç‚ºå¯«å…¥æ“ä½œï¼ˆæˆ–æ˜¯è®€+å¯«ï¼‰æ‰æœƒç ´å£è³‡æ–™çš„ä¸€è‡´æ€§ã€‚å¦‚æœåªæ˜¯å–®ç´”è®€å–ï¼Œä¸ä¸Šé–ä¹Ÿä¸æœƒé€ æˆè³‡æ–™éŒ¯èª¤ã€‚
                </div>
            </div>

            <div class="qa-item">
                <div class="qa-question" onclick="toggleQA(this)">Q2ï¼šå¦‚æœç¢ºå®šè®Šæ•¸æ˜¯ã€Œå”¯è®€ (Read-Only)ã€çš„ï¼Œé‚„éœ€è¦ç”¨ Lock å—ï¼Ÿ</div>
                <div class="qa-answer">
                    ä¸éœ€è¦ï¼å°å”¯è®€è³‡æ–™åŠ é–æ˜¯å¤šæ­¤ä¸€èˆ‰ï¼Œåªæœƒé™ä½ç¨‹å¼çš„æ•ˆèƒ½ï¼Œå› ç‚ºæ²’æœ‰ä»»ä½•åŸ·è¡Œç·’æœƒå»ä¿®æ”¹å®ƒã€‚
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- è®Šæ•¸èˆ‡ç‹€æ…‹ ---
        let currentHintLevel = 0;
        const hints = [
            "æƒ³ä¸€æƒ³ï¼šè³‡æ–™ä»€éº¼æ™‚å€™æ‰æœƒè¢«ã€æ”¹æ‰ã€ï¼Ÿ",
            "å¦‚æœå¤§å®¶éƒ½åªæ˜¯è®€ï¼Œè³‡æ–™çš„å…§å®¹æœƒç™¼ç”Ÿè®ŠåŒ–å—ï¼Ÿ",
            "é—œéµå®šç¾©ï¼šRace condition = åŒæ™‚å­˜å– + è‡³å°‘ä¸€å€‹å¯«å…¥ (Write)ã€‚"
        ];

        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šé€å‡ºç­”æ¡ˆ ---
        function submitAnswer() {
            const form = document.getElementById('quizForm');
            const selected = form.querySelector('input[name="answer"]:checked');
            const feedbackDiv = document.getElementById('feedbackResult');

            if (!selected) {
                alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼");
                return;
            }

            const isCorrect = (selected.value === "A");
            
            feedbackDiv.style.display = "block";
            feedbackDiv.className = "feedback-area " + (isCorrect ? "feedback-correct" : "feedback-wrong");

            let htmlContent = "";

            if (isCorrect) {
                htmlContent = `
                    <h3>ğŸ‰ ç­”å°äº†ï¼</h3>
                    <p><strong>åˆ¤æ–·çµæœï¼šæ­£ç¢º (O)</strong></p>
                    <div class="explanation">
                        <h4>é‡é»è§£æï¼š</h4>
                        <ul>
                            <li>Race Condition ç™¼ç”Ÿçš„å¿…è¦æ¢ä»¶æ˜¯ï¼š
                                <ol>
                                    <li>å¤šå€‹åŸ·è¡Œç·’ (Multithreading)</li>
                                    <li>åŒæ™‚å­˜å–åŒä¸€ä»½å…±äº«è³‡æ–™</li>
                                    <li><strong>è‡³å°‘æœ‰ä¸€å€‹åŸ·è¡Œç·’æœƒã€Œå¯«å…¥ (Write)ã€è³‡æ–™</strong></li>
                                </ol>
                            </li>
                            <li>æœ¬é¡Œæƒ…å¢ƒåªæœ‰ã€Œè®€å–ã€ï¼Œå®Œå…¨ä¸ç¬¦åˆç¬¬ 3 é»ï¼Œæ‰€ä»¥çµ•å°å®‰å…¨ï¼</li>
                        </ul>
                    </div>
                `;
            } else {
                htmlContent = `
                    <h3>âŒ ç­”éŒ¯äº†ï¼Œåˆ¥æ°£é¤’ï¼</h3>
                    <p><strong>ä½ çš„é¸æ“‡ï¼š(B) X</strong></p>
                    <div class="explanation">
                        <h4>å¸¸è¦‹èª¤è§£æé†’ï¼š</h4>
                        <p>é¸ X çš„åŒå­¸é€šå¸¸èª¤ä»¥ç‚ºï¼šã€Œåªè¦æ˜¯å¤šåŸ·è¡Œç·’ï¼Œå°±ä¸€å®šæœƒæœ‰ race conditionã€ã€‚</p>
                        <p><strong>é€™æ˜¯éŒ¯çš„ï¼</strong> å¦‚æœå¤§å®¶éƒ½å¾ˆä¹–ï¼Œåªæ˜¯ã€Œçœ‹ã€è³‡æ–™è€Œä¸å»ã€Œæ”¹ã€å®ƒï¼Œä¸–ç•Œæ˜¯éå¸¸å’Œå¹³çš„ã€‚</p>
                        <p>è«‹è¨˜å¾—ï¼š<strong>æ²’æœ‰ Writeï¼Œå°±æ²’æœ‰å‚·å®³ã€‚</strong></p>
                    </div>
                `;
            }

            feedbackDiv.innerHTML = htmlContent;
        }

        // --- åŠŸèƒ½ï¼šé¡¯ç¤ºæç¤º ---
        function showNextHint() {
            const hintArea = document.getElementById('hintArea');
            if (currentHintLevel < hints.length) {
                hintArea.style.display = "block";
                
                // å»ºç«‹æ–°çš„æç¤ºå…ƒç´ 
                const p = document.createElement("p");
                p.innerHTML = `<strong>æç¤º ${currentHintLevel + 1}ï¼š</strong>${hints[currentHintLevel]}`;
                p.style.margin = "5px 0";
                
                hintArea.appendChild(p);
                currentHintLevel++;
            } else {
                alert("å·²ç¶“æ²’æœ‰æ›´å¤šæç¤ºå›‰ï¼è«‹å˜—è©¦ä½œç­”ã€‚");
            }
        }

        // --- åŠŸèƒ½ï¼šé‡ç½® ---
        function resetQuiz() {
            document.getElementById('quizForm').reset();
            document.getElementById('feedbackResult').style.display = 'none';
            document.getElementById('hintArea').style.display = 'none';
            document.getElementById('hintArea').innerHTML = '';
            currentHintLevel = 0;
            
            // æ²å‹•å›æ¸¬é©—å€
            document.querySelector('.quiz-question').scrollIntoView({ behavior: 'smooth' });
        }

        // --- åŠŸèƒ½ï¼šAccordion æŠ˜ç–Šæ•ˆæœ ---
        document.querySelector('.accordion-btn').addEventListener('click', function() {
            this.classList.toggle('active');
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
                panel.style.maxHeight = null;
            } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
            }
        });

        // --- åŠŸèƒ½ï¼šå¿«å•å¿«ç­” toggle ---
        function toggleQA(element) {
            const answer = element.nextElementSibling;
            if (answer.style.display === "block") {
                answer.style.display = "none";
            } else {
                answer.style.display = "block";
            }
        }
    </script>
</body>
</html>