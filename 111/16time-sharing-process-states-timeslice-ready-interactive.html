<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡Œç›® 16ï¼šåˆ†æ™‚ç³»çµ±èˆ‡ç¨‹åºç‹€æ…‹ - äº’å‹•æ•™å­¸è¬›ç¾©</title>
    <style>
        /* --- å…¨åŸŸè¨­å®š --- */
        :root {
            --primary-color: #3b82f6; /* è£œç¿’ç­è— */
            --accent-color: #f59e0b;  /* é‡é»é»ƒ */
            --success-color: #10b981; /* æ­£ç¢ºç¶  */
            --danger-color: #ef4444;  /* éŒ¯èª¤ç´… */
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        h1, h2, h3 {
            margin-top: 0;
            color: #111827;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- å¡ç‰‡å¼è¨­è¨ˆ --- */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }

        .card.interactive {
            border-left-color: var(--accent-color);
        }

        /* --- é¡Œç›®å€å¡Š --- */
        .question-header {
            background-color: #e0f2fe;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .question-tag {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 8px;
        }

        .highlight {
            color: var(--danger-color);
            font-weight: bold;
            background-color: #fee2e2;
            padding: 0 4px;
        }

        /* --- è©å½™è¡¨ --- */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        .vocab-item {
            background: #f9fafb;
            padding: 10px;
            border-radius: 6px;
            font-size: 0.95em;
        }
        .vocab-term {
            font-weight: bold;
            color: var(--primary-color);
        }

        /* --- äº’å‹•æŒ‰éˆ•é€šç”¨æ¨£å¼ --- */
        button {
            cursor: pointer;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 1em;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-reset { background: var(--text-light); color: white; margin-top: 20px;}
        
        .btn-option {
            display: block;
            width: 100%;
            text-align: left;
            background: white;
            border: 2px solid #e5e7eb;
            margin-bottom: 8px;
            color: var(--text-main);
        }
        .btn-option:hover { border-color: var(--primary-color); background: #eff6ff; }

        /* --- (A) ç‹€æ…‹åœ–äº’å‹•å€ --- */
        #state-diagram-container {
            position: relative;
            height: 350px;
            background: #fff;
            border: 1px dashed #ccc;
            border-radius: 8px;
            margin-top: 15px;
        }

        .state-circle {
            position: absolute;
            width: 100px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 30px;
            font-weight: bold;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 2;
        }

        #st-new { top: 20px; left: 20px; background: #9ca3af; } /* Create */
        #st-ready { top: 120px; left: 100px; background: var(--accent-color); }
        #st-running { top: 120px; right: 100px; background: var(--success-color); border: 3px solid #000;} /* Running é‡é» */
        #st-waiting { bottom: 20px; left: 50%; transform: translateX(-50%); background: #6366f1; }
        #st-terminated { top: 20px; right: 20px; background: #9ca3af; }

        .arrow-line {
            position: absolute;
            cursor: pointer;
            stroke: #9ca3af;
            stroke-width: 3;
            fill: none;
            transition: stroke 0.3s;
            z-index: 1;
        }
        .arrow-line:hover { stroke: var(--primary-color); stroke-width: 5; }
        
        .arrow-label {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            padding: 2px 6px;
            font-size: 0.8em;
            border-radius: 4px;
            pointer-events: none; /* è®“é»æ“Šç©¿é€åˆ° SVG */
        }

        #diagram-explainer {
            min-height: 40px;
            margin-top: 10px;
            padding: 10px;
            background: #ecfdf5;
            color: var(--success-color);
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
        }

        /* --- (C) æ’éšŠæ¨¡æ“¬å€ --- */
        .queue-viz {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .cpu-box {
            width: 80px;
            height: 80px;
            border: 4px solid var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #dbeafe;
            font-weight: bold;
        }
        .ready-queue {
            flex: 1;
            border-bottom: 3px solid #ccc;
            display: flex;
            gap: 10px;
            padding: 10px;
            min-height: 60px;
            position: relative;
        }
        .ready-queue::before {
            content: "Ready Queue (æ’éšŠå€)";
            position: absolute;
            bottom: -25px;
            left: 0;
            font-size: 0.8em;
            color: #666;
        }
        .process-node {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 2px 2px 0 #b45309;
        }
        .process-running {
            background: var(--success-color);
            box-shadow: 2px 2px 0 #047857;
            transform: scale(1.2);
        }

        /* --- (E) é‡é»å°å¡ --- */
        .cheat-sheet {
            background: #374151;
            color: white;
            border-radius: 8px;
            overflow: hidden;
        }
        .cheat-title {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            background: #1f2937;
        }
        .cheat-content {
            padding: 15px;
            display: none; /* é è¨­æ”¶åˆ */
        }
        .cheat-content.show { display: block; }

        /* --- (F) è‡ªæˆ‘æª¢æ¸¬ --- */
        .hint-box {
            display: none;
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #92400e;
        }

        /* --- éŸ¿æ‡‰å¼èª¿æ•´ --- */
        @media (max-width: 600px) {
            #state-diagram-container { height: 450px; }
            .state-circle { width: 80px; font-size: 0.9em; }
            #st-ready { left: 50%; transform: translateX(-50%); top: 80px; }
            #st-running { left: 50%; transform: translateX(-50%); top: 200px; right: auto; }
            #st-waiting { top: 320px; bottom: auto;}
            /* æ‰‹æ©Ÿç‰ˆç®­é ­é‡ç¹ªé‚è¼¯è¤‡é›œï¼Œæ­¤è™•ç‚ºä¿æŒHTMLå–®æª”ç°¡æ½”ï¼Œå»ºè­°åœ¨JSä¸­è™•ç†æˆ–é€éCSS Grid Stack */
        }
    </style>
</head>
<body>

<div class="container">

    <!-- æ¨™é¡Œå€ -->
    <header style="text-align: center; margin-bottom: 30px;">
        <h1 style="color: var(--primary-color);">ä½œæ¥­ç³»çµ±å°æ•™å®¤</h1>
        <p>å–®å…ƒï¼šåˆ†æ™‚ç³»çµ±èˆ‡ç¨‹åºç‹€æ…‹</p>
    </header>

    <!-- é¡Œç›®å€ -->
    <div class="card">
        <div class="question-header">
            <span class="question-tag">é¡Œç›® 16</span>
            <h3>åˆ†æ™‚ç³»çµ± (Time-Sharing) ç‹€æ…‹åˆ‡æ›</h3>
        </div>
        <p style="font-size: 1.1em;">
            åœ¨åˆ†æ™‚ï¼ˆtime-sharingï¼‰ä½œæ¥­ç³»çµ±ä¸­ï¼Œå¦‚æœç¨‹åº A çš„<span class="highlight">æ™‚é–“å€æ®µï¼ˆtime slotï¼‰è€—ç›¡</span>ï¼Œå› è€Œå°‡åŸ·è¡Œåˆ‡æ›è‡³å¦ä¸€ç¨‹åº B æ™‚ï¼Œç¨‹åº A å°‡æœƒé€²å…¥ä½•ç¨®ç‹€æ…‹ï¼ˆstateï¼‰ï¼Ÿ
        </p>
        <p style="color: var(--text-light); font-size: 0.9em;">(è«‹å…ˆæ€è€ƒä¸€ä¸‹ï¼Œå†å¾€ä¸‹çœ‹äº’å‹•æ•™å­¸)</p>
    </div>

    <!-- è§€å¿µè¬›è§£å€ -->
    <div class="card">
        <h2>ğŸ“š è£œæ•™åå¸«ï¼šç™½è©±æ–‡ç¿»è­¯æ©Ÿ</h2>
        <div class="vocab-grid">
            <div class="vocab-item"><span class="vocab-term">åˆ†æ™‚ (Time-Sharing)</span><br>å¤§å®¶è¼ªæµç”¨ CPUï¼Œæ¯äººåˆ†ä¸€å°æ®µæ™‚é–“ï¼Œæ„Ÿè¦ºåƒåŒæ™‚åœ¨è·‘ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">æ™‚é–“ç‰‡ (Time Slot)</span><br>CPU å€Ÿä½ ç”¨çš„é‚£ä¸€å°æ®µæ™‚é–“ï¼ˆä¾‹å¦‚ 0.1 ç§’ï¼‰ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">ç¨‹åº (Process)</span><br>æ­£åœ¨åŸ·è¡Œä¸­çš„ç¨‹å¼ï¼Œåƒã€Œæ’éšŠç­‰ä¸Šå°è¡¨æ¼”çš„äººã€ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">æ’ç¨‹ (Scheduling)</span><br>è£åˆ¤æ±ºå®šä¸‹ä¸€å€‹æ›èª°ç”¨ CPUã€‚</div>
            <div class="vocab-item"><span class="vocab-term">Ready State</span><br>è¬äº‹ä¿±å‚™ï¼Œåªæ¬  CPUï¼ˆåœ¨æ’éšŠç­‰å«è™Ÿï¼‰ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">Running State</span><br>æ­£åœ¨ä½¿ç”¨ CPUï¼ˆæ­£åœ¨å°ä¸Šè¡¨æ¼”ï¼‰ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">Waiting State</span><br>å¡ä½äº†ï¼ˆç­‰éµç›¤è¼¸å…¥ã€è®€ç£ç¢Ÿï¼‰ï¼Œçµ¦ CPU ä¹Ÿæ²’ç”¨ï¼Œè¦å»æ—é‚Šç­‰ã€‚</div>
            <div class="vocab-item"><span class="vocab-term">Terminated State</span><br>è¡¨æ¼”çµæŸï¼Œä¸‹å°é èº¬ã€‚</div>
        </div>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ A: ç‹€æ…‹åœ– -->
    <div class="card interactive">
        <h2>ğŸ® äº’å‹• Aï¼šé»æ“Šç®­é ­çœ‹ç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</h2>
        <p>è«‹é»æ“Šä¸‹åœ–ä¸­çš„ã€Œç°è‰²ç®­é ­ã€ï¼Œçœ‹çœ‹ç¨‹åºç‚ºä»€éº¼æœƒè®Šæ›ç‹€æ…‹ã€‚</p>
        
        <div id="state-diagram-container">
            <!-- ç‹€æ…‹åœ“åœˆ -->
            <div class="state-circle" id="st-new">New</div>
            <div class="state-circle" id="st-ready">Ready<br>(å°±ç·’)</div>
            <div class="state-circle" id="st-running">Running<br>(åŸ·è¡Œ)</div>
            <div class="state-circle" id="st-waiting">Waiting<br>(ç­‰å¾…)</div>
            <div class="state-circle" id="st-terminated">Terminated</div>

            <!-- SVG ç®­é ­ç¹ªè£½å€ (å¯¬é«˜è¨­ç‚º 100% è¦†è“‹çˆ¶å±¤) -->
            <svg width="100%" height="100%" style="position:absolute; top:0; left:0; z-index:1;">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#9ca3af" />
                    </marker>
                    <marker id="arrowhead-hover" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6" />
                    </marker>
                </defs>

                <!-- 1. Ready -> Running -->
                <path d="M 210,150 L 590,150" class="arrow-line" onclick="explainState('dispatch')" id="line-dispatch"></path>
                
                <!-- 2. Running -> Ready (æœ¬é¡Œé‡é») -->
                <path d="M 600,140 Q 400,80 200,140" class="arrow-line" onclick="explainState('timeout')" id="line-timeout" style="stroke: var(--danger-color); stroke-dasharray: 5,5;"></path>

                <!-- 3. Running -> Waiting -->
                <path d="M 640,180 Q 640,300 450,330" class="arrow-line" onclick="explainState('io-request')"></path>

                <!-- 4. Waiting -> Ready -->
                <path d="M 350,330 Q 160,300 160,180" class="arrow-line" onclick="explainState('io-complete')"></path>

                <!-- 5. Running -> Terminated -->
                <path d="M 690,130 L 730,70" class="arrow-line" onclick="explainState('exit')"></path>
            </svg>
            
            <!-- æ¨™ç±¤ (è¼”åŠ©é–±è®€) -->
            <div class="arrow-label" style="top: 155px; left: 400px;">è¢«é¸åˆ° (Dispatch)</div>
            <div class="arrow-label" style="top: 90px; left: 400px; color:red;">æ™‚é–“åˆ° (Timeout)</div>
            <div class="arrow-label" style="top: 250px; right: 100px;">I/O è«‹æ±‚</div>
            <div class="arrow-label" style="top: 250px; left: 100px;">I/O å®Œæˆ</div>
        </div>

        <div id="diagram-explainer">ğŸ’¡ é»æ“Šä¸Šæ–¹ç®­é ­æˆ–ç·šæ¢ï¼Œé€™è£¡æœƒå‡ºç¾åå¸«è§£æï¼</div>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ C: åˆ†æ™‚æ’éšŠæ¨¡æ“¬ -->
    <div class="card interactive">
        <h2>â³ äº’å‹• Cï¼šåˆ†æ™‚ç³»çµ±æ’éšŠæ¨¡æ“¬ (Time Slicing)</h2>
        <p>çœ‹çœ‹ CPU æ€éº¼æŠŠæ™‚é–“åˆ‡çµ¦ Aã€Bã€C ä¸‰å€‹äººã€‚</p>
        
        <div class="queue-viz">
            <div class="cpu-box">
                <div>CPU</div>
                <div id="cpu-content" style="margin-top:5px;">(ç©º)</div>
            </div>
            <div class="ready-queue" id="queue-content">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <div style="background: #f0fdf4; padding: 10px; border-radius: 6px; margin-bottom: 10px;" id="sim-status">
            æº–å‚™é–‹å§‹æ¨¡æ“¬...
        </div>

        <button class="btn-primary" onclick="nextTimeSlice()">â±ï¸ ä¸‹ä¸€å€‹æ™‚é–“ç‰‡ (Next Time Slice)</button>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ B: æƒ…å¢ƒé¸æ“‡å™¨ -->
    <div class="card interactive">
        <h2>ğŸ¤” äº’å‹• Bï¼šæƒ…å¢ƒåæ‡‰è¨“ç·´</h2>
        <p>æŠŠè§€å¿µè®Šæˆç›´è¦ºåæ‡‰ï¼è«‹æ ¹æ“šæƒ…å¢ƒé¸æ“‡æ­£ç¢ºçš„ã€Œä¸‹ä¸€å€‹ç‹€æ…‹ã€ã€‚</p>

        <div style="margin-bottom: 15px;">
            <label><strong>ç•¶å‰æƒ…å¢ƒï¼š</strong></label>
            <select id="scenario-select" style="padding: 8px; font-size: 1em;">
                <option value="timeout">æ™‚é–“ç‰‡ (Time Slot) ç”¨å®Œ</option>
                <option value="io_req">ç¨‹å¼éœ€è¦è®€å–æª”æ¡ˆ (I/O è«‹æ±‚)</option>
                <option value="io_done">ç¡¬ç¢Ÿè³‡æ–™è®€å–å®Œæˆ (I/O å®Œæˆ)</option>
                <option value="exit">ç¨‹å¼åŸ·è¡Œå®Œç•¢ (Exit)</option>
            </select>
        </div>

        <div>
            <label><strong>ç¨‹åºå°‡é€²å…¥å“ªå€‹ Stateï¼Ÿ</strong></label><br>
            <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="checkScenarioAns('Ready')" style="background:var(--accent-color); color:white;">Ready</button>
                <button onclick="checkScenarioAns('Running')" style="background:var(--success-color); color:white;">Running</button>
                <button onclick="checkScenarioAns('Waiting')" style="background:#6366f1; color:white;">Waiting</button>
                <button onclick="checkScenarioAns('Terminated')" style="background:#9ca3af; color:white;">Terminated</button>
            </div>
        </div>

        <div id="scenario-feedback" style="margin-top: 15px; font-weight: bold; min-height: 24px;"></div>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ D: é¡Œç›® 16 è§£æ -->
    <div class="card">
        <h2>ğŸ“ é¡Œç›® 16 é¸é …è§£æ</h2>
        <p>å›åˆ°æ­£é¡Œï¼Œé€™é¡Œç­”æ¡ˆé¸ä»€éº¼ï¼Ÿé»æ“Šé¸é …çœ‹è§£æã€‚</p>
        
        <button class="btn-option" onclick="checkOption('A')">(A) waiting state</button>
        <button class="btn-option" onclick="checkOption('B')">(B) ready state</button>
        <button class="btn-option" onclick="checkOption('C')">(C) terminated state</button>
        <button class="btn-option" onclick="checkOption('D')">(D) running state</button>

        <div id="option-feedback" style="margin-top: 15px; padding: 10px; border-radius: 6px; display: none;"></div>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ E: é‡é»å°å¡ -->
    <div class="cheat-sheet">
        <div class="cheat-title" onclick="toggleCheatSheet()">
            <span>ğŸ”‘ é‡é»é€Ÿè¨˜å°å¡ (é»æ“Šå±•é–‹/æ”¶åˆ)</span>
            <span>â–¼</span>
        </div>
        <div class="cheat-content" id="cheat-content">
            <h4 style="margin-top:0;">å››å¤§ç‹€æ…‹ä¸€å¥è©±å°ç…§ï¼š</h4>
            <ul>
                <li><strong>Readyï¼š</strong>èƒ½è·‘ä½†æ²’ CPUï¼ˆåœ¨æ’éšŠï¼‰ã€‚</li>
                <li><strong>Runningï¼š</strong>æ­£åœ¨ç”¨ CPUï¼ˆçˆ½ç”¨ä¸­ï¼‰ã€‚</li>
                <li><strong>Waitingï¼š</strong>åœ¨ç­‰ I/Oï¼ˆä¸èƒ½ç”¨ CPUï¼‰ã€‚</li>
                <li><strong>Terminatedï¼š</strong>å†è¦‹æ°æ°ã€‚</li>
            </ul>
            <h4>ğŸ”¥ è¶…å¸¸è€ƒè½‰æ›è¡¨ï¼š</h4>
            <ul>
                <li>Running â†’ Readyï¼š<span style="color:#fcd34d">æ™‚é–“ç‰‡ç”¨å®Œ</span>ã€è¢«é«˜å„ªå…ˆæ¬Šæ’éšŠã€‚</li>
                <li>Running â†’ Waitingï¼šè‡ªå·±è¦ I/O (è®€æª”/ç¶²è·¯)ã€‚</li>
                <li>Waiting â†’ Readyï¼šI/O åšå®Œäº†ã€‚</li>
            </ul>
        </div>
    </div>

    <!-- äº’å‹•åŠŸèƒ½ F: è‡ªæˆ‘æª¢æ¸¬ -->
    <div class="card">
        <h2>ğŸ§  è‡ªæˆ‘æª¢æ¸¬ (ä¸çµ¦ç­”æ¡ˆï¼Œè‡ªå·±æƒ³ï¼)</h2>
        
        <div style="margin-bottom: 20px;">
            <p><strong>Q1. å¦‚æœ A æ˜¯å› ç‚ºã€Œè®€å–ç£ç¢Ÿã€è¢«æ›ä¸‹ä¾†ï¼Œæœƒé€²å…¥å“ªå€‹ç‹€æ…‹ï¼Ÿ</strong></p>
            <button onclick="toggleHint('h1')" style="font-size: 0.8em; padding: 5px 10px;">é¡¯ç¤ºæç¤º</button>
            <div id="h1" class="hint-box">æç¤ºï¼šè®€ç£ç¢Ÿæ˜¯ I/O è¡Œç‚ºã€‚CPU ä¸èƒ½å¹«ä½ è®€ç£ç¢Ÿï¼Œä½ è¦å»æ—é‚Šç­‰ç£ç¢Ÿè½‰å¥½ã€‚é—œéµå­—ï¼šWaitingã€‚</div>
        </div>

        <div style="margin-bottom: 20px;">
            <p><strong>Q2. Ready èˆ‡ Waiting æœ€å¤§çš„å·®åˆ¥æ˜¯ä»€éº¼ï¼Ÿ(ä¸€å¥è©±)</strong></p>
            <button onclick="toggleHint('h2')" style="font-size: 0.8em; padding: 5px 10px;">é¡¯ç¤ºæç¤º</button>
            <div id="h2" class="hint-box">æç¤ºï¼šçµ¦ä»– CPU ä»–èƒ½è·‘å—ï¼ŸReady çµ¦ CPU å°±èƒ½è·‘ï¼›Waiting çµ¦ CPU ä¹Ÿä¸èƒ½è·‘ï¼ˆå› ç‚ºé‚„åœ¨ç­‰è³‡æ–™ï¼‰ã€‚</div>
        </div>

        <div>
            <p><strong>Q3. ç¨‹åºçµæŸ (Terminated) å¾Œé‚„æœƒå›åˆ° Ready å—ï¼Ÿ</strong></p>
            <button onclick="toggleHint('h3')" style="font-size: 0.8em; padding: 5px 10px;">é¡¯ç¤ºæç¤º</button>
            <div id="h3" class="hint-box">æç¤ºï¼šäººæ­»ä¸èƒ½å¾©ç”Ÿï¼Œç¨‹å¼çµæŸå°±å¾è¨˜æ†¶é«”æ¸…é™¤äº†ã€‚ä¸æœƒå›å»äº†ã€‚</div>
        </div>
    </div>

    <button class="btn-reset" onclick="resetAll()">ğŸ”„ å…¨éƒ¨é‡ç½® / æ¸…é™¤ç·´ç¿’ç´€éŒ„</button>
    
    <footer style="text-align: center; margin-top: 40px; color: #9ca3af; font-size: 0.8em;">
        &copy; 2024 ä½œæ¥­ç³»çµ±äº’å‹•è¬›ç¾© | Designed for High School Learners
    </footer>

</div>

<!-- JavaScript é‚è¼¯ -->
<script>
    // --- (A) ç‹€æ…‹åœ–è§£é‡‹ ---
    const explanations = {
        'dispatch': 'Ready â†’ Running (Dispatch)ï¼š<br>æ’ç¨‹å™¨ (Scheduler) è¦ºå¾—è¼ªåˆ°ä½ äº†ï¼ŒæŠŠä½ å«ä¸Šå°ä½¿ç”¨ CPUã€‚',
        'timeout': 'Running â†’ Ready (Timeout)ï¼š<br>ã€æœ¬é¡Œé‡é»ã€‘ä½ çš„æ™‚é–“ç‰‡ (Time Slot) ç”¨å®Œäº†ï¼é›–ç„¶ä½ é‚„æ²’åšå®Œï¼Œä½†è¦æŠŠ CPU è®“çµ¦åˆ¥äººï¼Œä¹–ä¹–å›å» Ready æ’éšŠã€‚',
        'io-request': 'Running â†’ Waiting (I/O Request)ï¼š<br>ç¨‹å¼éœ€è¦è®€æª”æ¡ˆæˆ–ç­‰éµç›¤è¼¸å…¥ï¼Œä¸»å‹•æ”¾æ£„ CPUï¼Œå»æ—é‚Šæ…¢æ…¢ç­‰ã€‚',
        'io-complete': 'Waiting â†’ Ready (I/O Complete)ï¼š<br>æª”æ¡ˆè®€åˆ°äº†ï¼ä½†ä¸èƒ½ç›´æ¥æ’éšŠç”¨ CPUï¼Œè¦å…ˆå» Ready æ’éšŠç­‰å«è™Ÿã€‚',
        'exit': 'Running â†’ Terminated (Exit)ï¼š<br>ç¨‹å¼åŸ·è¡Œå®Œç•¢ï¼Œé‡‹æ”¾æ‰€æœ‰è³‡æºã€‚'
    };

    function explainState(key) {
        const box = document.getElementById('diagram-explainer');
        box.innerHTML = explanations[key];
        box.style.backgroundColor = '#fff7ed'; // æ·¡æ·¡çš„æ©˜è‰²æé†’
        setTimeout(() => { box.style.backgroundColor = '#ecfdf5'; }, 300);
    }

    // --- (B) æƒ…å¢ƒé¸æ“‡å™¨ ---
    const scenarioAnswers = {
        'timeout': 'Ready',
        'io_req': 'Waiting',
        'io_done': 'Ready',
        'exit': 'Terminated'
    };

    const scenarioReasons = {
        'timeout': 'æ­£ç¢ºï¼æ™‚é–“ç”¨å®Œåªæ˜¯ã€Œæš«åœã€ï¼Œéš¨æ™‚æº–å‚™å†è·‘ï¼Œæ‰€ä»¥å› Ready æ’éšŠã€‚',
        'io_req': 'æ­£ç¢ºï¼è¦ç­‰å‘¨é‚Šè£ç½® (I/O)ï¼ŒCPU å¹«ä¸ä¸Šå¿™ï¼Œæ‰€ä»¥å» Waitingã€‚',
        'io_done': 'æ­£ç¢ºï¼I/O åšå®Œäº†è®Šå›ã€Œå¯åŸ·è¡Œç‹€æ…‹ã€ï¼Œä½†è¦å…ˆæ’éšŠï¼Œæ‰€ä»¥æ˜¯ Readyã€‚',
        'exit': 'æ­£ç¢ºï¼ä»»å‹™çµæŸã€‚'
    };

    function checkScenarioAns(userChoice) {
        const scenario = document.getElementById('scenario-select').value;
        const correctAns = scenarioAnswers[scenario];
        const feedback = document.getElementById('scenario-feedback');

        if (userChoice === correctAns) {
            feedback.innerHTML = `<span style="color:var(--success-color)">âœ… ${scenarioReasons[scenario]}</span>`;
        } else {
            feedback.innerHTML = `<span style="color:var(--danger-color)">âŒ ç­”éŒ¯å›‰ã€‚æƒ³ä¸€ä¸‹ï¼š${getWrongHint(scenario, userChoice)}</span>`;
        }
    }

    function getWrongHint(scenario, choice) {
        if (scenario === 'timeout') return 'æ™‚é–“ç”¨å®Œä»£è¡¨ä½ é‚„ã€Œèƒ½è·‘ã€ï¼Œåªæ˜¯è¢«æ›ä¸‹ä¾†ã€‚ä¸æ˜¯åœ¨ç­‰ I/O (Waiting)ï¼Œä¹Ÿä¸æ˜¯çµæŸ (Terminated)ã€‚';
        if (scenario === 'io_req') return 'ä»–åœ¨ç­‰ç¡¬ç¢Ÿè³‡æ–™ï¼Œçµ¦ä»– CPU ä»–ä¹Ÿä¸èƒ½è·‘ï¼Œæ‰€ä»¥ä¸æ˜¯ Readyï¼Œæ˜¯ Waitingã€‚';
        if (scenario === 'io_done') return 'I/O åšå®Œå°±å¯ä»¥è·‘äº†ï¼Œä½†ä¸èƒ½ç›´æ¥è®Šæˆ Running (è¦æ’éšŠ)ï¼Œä¹Ÿä¸æ˜¯ Waiting äº†ã€‚';
        return 'ç¨‹å¼éƒ½è·‘å®Œäº†ï¼Œç•¶ç„¶æ˜¯ Terminatedã€‚';
    }

    // --- (C) æ’éšŠæ¨¡æ“¬ ---
    let queueState = {
        running: null,
        queue: ['A', 'B', 'C'], // åˆå§‹ A, B, C éƒ½åœ¨æ’éšŠ
        step: 0
    };

    function renderQueue() {
        const cpuDiv = document.getElementById('cpu-content');
        const queueDiv = document.getElementById('queue-content');
        const statusDiv = document.getElementById('sim-status');
        
        // æ¸²æŸ“ CPU
        if (queueState.running) {
            cpuDiv.innerHTML = `<div class="process-node process-running">${queueState.running}</div>`;
        } else {
            cpuDiv.innerHTML = '(ç©ºé—²)';
        }

        // æ¸²æŸ“ Queue
        queueDiv.innerHTML = '';
        queueState.queue.forEach(p => {
            const node = document.createElement('div');
            node.className = 'process-node';
            node.innerText = p;
            queueDiv.appendChild(node);
        });

        // ç‹€æ…‹æ–‡å­—
        if (queueState.step === 0) statusDiv.innerHTML = "Step 0: å¤§å®¶éƒ½åœ¨ Ready Queue æ’éšŠï¼ŒCPU æ˜¯ç©ºçš„ã€‚";
        else if (queueState.step === 1) statusDiv.innerHTML = `Step 1: <strong>${queueState.running}</strong> æ¶åˆ° CPU (Running)ã€‚B, C ç¹¼çºŒç­‰ã€‚`;
        else {
             statusDiv.innerHTML = `Step ${queueState.step}: 
             <span style="color:var(--danger-color)">æ™‚é–“ç‰‡åˆ°ï¼</span> 
             å‰›è·‘å®Œçš„å›åˆ° Queue å°¾ç«¯æ’éšŠ (Ready)ï¼Œ
             æ› <strong>${queueState.running}</strong> ä¸Šå° (Running)ã€‚`;
        }
    }

    function nextTimeSlice() {
        // é‚è¼¯ï¼š
        // 1. å¦‚æœæœ‰äººåœ¨ Runningï¼ŒæŠŠä»–ä¸Ÿå› Queue å°¾ç«¯
        // 2. å¾ Queue é ­éƒ¨æ‹¿å‡ºä¸€å€‹æ”¾é€² Running
        
        if (queueState.running) {
            queueState.queue.push(queueState.running); // èˆŠçš„å›å»æ’éšŠ
        }
        
        if (queueState.queue.length > 0) {
            queueState.running = queueState.queue.shift(); // æ–°çš„å‡ºä¾†
        }

        queueState.step++;
        renderQueue();
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderQueue();

    // --- (D) é¸é …è§£æ ---
    function checkOption(opt) {
        const feedback = document.getElementById('option-feedback');
        feedback.style.display = 'block';
        
        if (opt === 'B') {
            feedback.style.background = '#d1fae5';
            feedback.style.color = '#065f46';
            feedback.innerHTML = `
                <strong>âœ… (B) Ready state æ­£ç¢ºï¼</strong><br>
                è§£æï¼šæ™‚é–“ç‰‡ç”¨å®Œ (Time-out) ä»£è¡¨ç¨‹å¼é‚„æ²’åŸ·è¡Œå®Œï¼Œä½†è¢«è¿«äº¤å‡º CPUã€‚<br>
                æ—¢ç„¶é‚„æ²’åšå®Œä¸”æ²’æœ‰è¦ç­‰ I/Oï¼Œå®ƒå°±æ˜¯ã€Œæº–å‚™å¥½éš¨æ™‚å¯åŸ·è¡Œã€ï¼Œæ‰€ä»¥å›åˆ° Ready Queue æ’éšŠã€‚
            `;
        } else {
            feedback.style.background = '#fee2e2';
            feedback.style.color = '#991b1b';
            let reason = "";
            if (opt === 'A') reason = "Waiting æ˜¯åœ¨ç­‰ I/O (å¦‚è®€æª”ã€è¼¸å…¥)ï¼Œé¡Œç›®åªæ˜¯æ™‚é–“åˆ°ï¼Œä¸æ˜¯è¦ I/Oã€‚";
            if (opt === 'C') reason = "Terminated æ˜¯ç¨‹å¼åŸ·è¡ŒçµæŸï¼Œé¡Œç›®èªªåªæ˜¯æ™‚é–“ç”¨å®Œåˆ‡æ›è€Œå·²ã€‚";
            if (opt === 'D') reason = "CPU å·²ç¶“åˆ‡çµ¦ç¨‹åº B äº†ï¼Œæ‰€ä»¥ A ä¸æœƒç¹¼çºŒåœ¨ Runningã€‚";
            feedback.innerHTML = `<strong>âŒ (${opt}) éŒ¯èª¤ã€‚</strong><br>${reason}`;
        }
    }

    // --- (E) é‡é»å°å¡é–‹é—œ ---
    function toggleCheatSheet() {
        const content = document.getElementById('cheat-content');
        content.classList.toggle('show');
    }

    // --- (F) è‡ªæˆ‘æª¢æ¸¬æç¤º ---
    function toggleHint(id) {
        const el = document.getElementById(id);
        el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    // --- å…¨åŸŸé‡ç½® ---
    function resetAll() {
        // é‡ç½®åœ–è§£æ–‡å­—
        document.getElementById('diagram-explainer').innerHTML = 'ğŸ’¡ é»æ“Šä¸Šæ–¹ç®­é ­æˆ–ç·šæ¢ï¼Œé€™è£¡æœƒå‡ºç¾åå¸«è§£æï¼';
        
        // é‡ç½®æ¨¡æ“¬
        queueState = { running: null, queue: ['A', 'B', 'C'], step: 0 };
        renderQueue();
        
        // é‡ç½®æƒ…å¢ƒå›é¥‹
        document.getElementById('scenario-select').value = 'timeout';
        document.getElementById('scenario-feedback').innerHTML = '';
        
        // é‡ç½®é¸é …è§£æ
        document.getElementById('option-feedback').style.display = 'none';
        
        // æ”¶åˆæç¤ºèˆ‡å°å¡
        document.querySelectorAll('.hint-box').forEach(el => el.style.display = 'none');
        document.getElementById('cheat-content').classList.remove('show');
        
        alert('å·²é‡ç½®æ‰€æœ‰ç·´ç¿’ç‹€æ…‹ï¼');
    }
</script>

</body>
</html>