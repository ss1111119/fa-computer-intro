<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSI ç¶²è·¯å±¤æ•™å­¸ - äº’å‹•å¼å­¸ç¿’</title>
    <style>
        :root {
            --primary-color: #3b82f6; /* Blue 500 */
            --primary-dark: #1d4ed8;
            --secondary-color: #10b981; /* Emerald 500 - for Layer 3 focus */
            --accent-color: #f59e0b; /* Amber 500 */
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft JhengHei', system-ui, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        /* Utility Classes */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            border: 1px solid #e5e7eb;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        h1, h2, h3 { color: var(--text-main); }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: #e5e7eb;
            color: #374151;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        header h1 { color: white; margin-bottom: 10px; font-size: 2rem; }
        header p { opacity: 0.9; font-size: 1.1rem; }

        /* Question Section */
        .question-box {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
        }
        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .options-list {
            list-style: none;
        }
        .options-list li {
            padding: 8px 12px;
            margin-bottom: 6px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        /* Concept Quick Read */
        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        .concept-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #cbd5e1;
        }
        .concept-item.highlight {
            border-left-color: var(--secondary-color);
            background: #ecfdf5;
        }

        /* Interactive OSI Stack */
        .osi-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .osi-container {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        .osi-stack {
            flex: 1;
            display: flex;
            flex-direction: column-reverse; /* Layer 1 at bottom */
            gap: 4px;
        }

        .osi-layer {
            padding: 12px 16px;
            background: #f3f4f6;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .osi-layer:hover {
            transform: translateX(5px);
            background: #e2e8f0;
        }

        .osi-layer.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-dark);
            transform: scale(1.02);
        }

        /* Layer 3 Specific Style */
        .osi-layer[data-layer="3"].active {
            background: var(--secondary-color);
            border-color: #059669;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }

        .osi-info-panel {
            flex: 1;
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .info-title { font-size: 1.5rem; color: var(--primary-color); margin-bottom: 10px; }
        .info-detail strong { color: #374151; }
        .info-detail { margin-bottom: 8px; font-size: 1.05rem; }

        /* Simulation Area */
        .sim-stage {
            background: #1e293b;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }

        .sim-device {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }
        .sim-icon { font-size: 2.5rem; margin-bottom: 5px; }
        .sim-label { font-size: 0.85rem; color: #cbd5e1; }

        .packet {
            position: absolute;
            left: 10%;
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent-color);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            transition: left 0.5s ease-in-out, background-color 0.3s;
            z-index: 1;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .packet-layer-tag {
            background: rgba(0,0,0,0.2);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.7em;
        }

        .sim-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-reset { background: #9ca3af; color: white; }
        .btn-reset:hover { background: #6b7280; }

        .sim-log {
            background: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            color: #333;
            min-height: 50px;
        }
        
        .highlight-text { color: var(--secondary-color); font-weight: bold; }

        /* Options Breakdown */
        .option-card {
            border: 1px solid #eee;
            border-left: 4px solid #ddd;
            padding: 12px;
            margin-bottom: 10px;
            background: #fff;
        }
        .option-card.correct { border-left-color: var(--secondary-color); background: #f0fdf4; }
        .option-card.wrong { border-left-color: #ef4444; }
        .option-header { font-weight: bold; margin-bottom: 4px; display: block; }

        /* Quiz Section */
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .quiz-btn {
            padding: 15px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            text-align: left;
            transition: all 0.2s;
        }
        
        .quiz-btn:hover { border-color: var(--primary-color); background: #f0f9ff; }
        
        .quiz-btn.correct { background: var(--secondary-color); color: white; border-color: var(--secondary-color); }
        .quiz-btn.incorrect { background: #ef4444; color: white; border-color: #ef4444; }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .quiz-feedback.show { display: block; animation: fadeIn 0.3s; }
        .feedback-success { background: #d1fae5; color: #065f46; border: 1px solid #34d399; }
        .feedback-error { background: #fee2e2; color: #991b1b; border: 1px solid #f87171; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Accordion */
        .accordion-item { border-bottom: 1px solid #e5e7eb; }
        .accordion-btn {
            width: 100%;
            text-align: left;
            padding: 15px 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 10px;
        }
        .accordion-content.open { max-height: 200px; padding-bottom: 15px; }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <h1>Network Layer = Layer 3</h1>
        <p>è² è²¬ IP ä½å€èˆ‡è·¯ç”±é¸æ“‡ (Routing) çš„é—œéµå±¤ç´š</p>
    </div>
</header>

<main class="container">

    <!-- 1. é¡Œç›®å€å¡Š -->
    <section class="card question-box">
        <div class="section-title">æœ¬é¡Œ</div>
        <p class="question-text">OSI ç¶²è·¯æ¨¡å¼ä¸­ï¼Œç¶²è·¯å±¤ï¼ˆNetwork Layerï¼‰å±¬æ–¼ç¬¬å¹¾å±¤çš„é€šè¨Šå”å®šï¼Ÿ</p>
        <ul class="options-list">
            <li>(A) 2</li>
            <li>(B) 3</li>
            <li>(C) 4</li>
            <li>(D) 5</li>
        </ul>
    </section>

    <!-- 2. æ¦‚å¿µé€Ÿè®€ -->
    <section class="card" id="concept-section">
        <div class="section-title">æ¦‚å¿µé€Ÿè®€ï¼šé‡é»åˆ†å±¤æ¯”è¼ƒ</div>
        <div class="concept-grid">
            <div class="concept-item">
                <h3>Layer 2: è³‡æ–™é€£çµå±¤</h3>
                <p>Data Link Layer</p>
                <hr style="margin:8px 0; border:0; border-top:1px solid #ddd;">
                <p>ğŸ“ <strong>å–®ä½ï¼š</strong>Frame (è¨Šæ¡†)</p>
                <p>ğŸ“ <strong>è¨­å‚™ï¼š</strong>Switch (äº¤æ›å™¨)</p>
                <p>ğŸ“ <strong>ä½å€ï¼š</strong>MAC Address</p>
            </div>
            <div class="concept-item highlight">
                <h3>Layer 3: ç¶²è·¯å±¤</h3>
                <p>Network Layer</p>
                <hr style="margin:8px 0; border:0; border-top:1px solid #a7f3d0;">
                <p>ğŸ“ <strong>å–®ä½ï¼š</strong>Packet (å°åŒ…)</p>
                <p>ğŸ“ <strong>è¨­å‚™ï¼š</strong>Router (è·¯ç”±å™¨)</p>
                <p>ğŸ“ <strong>é—œéµï¼š</strong>IP, Routing (è·¯ç”±)</p>
            </div>
            <div class="concept-item">
                <h3>Layer 4: å‚³è¼¸å±¤</h3>
                <p>Transport Layer</p>
                <hr style="margin:8px 0; border:0; border-top:1px solid #ddd;">
                <p>ğŸ“ <strong>å–®ä½ï¼š</strong>Segment (å€æ®µ)</p>
                <p>ğŸ“ <strong>å”å®šï¼š</strong>TCP, UDP</p>
                <p>ğŸ“ <strong>åŠŸèƒ½ï¼š</strong>ç«¯å°ç«¯å‚³è¼¸ã€Port</p>
            </div>
        </div>
    </section>

    <!-- 3. äº’å‹•å­¸ç¿’å€ (æ ¸å¿ƒ) -->
    <section class="card" id="osi-interactive">
        <div class="section-title">
            äº’å‹•åœ–è§£ï¼šé»é¸æ¯ä¸€å±¤æŸ¥çœ‹ç´°ç¯€
            <span class="badge">å¿…å­¸é‡é»</span>
        </div>
        
        <div class="osi-container">
            <!-- OSI Stack Visual -->
            <div class="osi-stack" id="stack-container">
                <!-- Javascript will populate this -->
            </div>

            <!-- Info Panel -->
            <div class="osi-info-panel" id="info-panel">
                <h3 class="info-title">è«‹é»é¸å·¦å´å±¤ç´š</h3>
                <p class="text-muted">é»æ“Š OSI æ¨¡å‹çš„æ¯ä¸€å±¤ï¼Œäº†è§£å…¶åŠŸèƒ½ã€è³‡æ–™å–®ä½èˆ‡å¸¸è¦‹è¨­å‚™ã€‚</p>
            </div>
        </div>
    </section>

    <!-- æƒ…å¢ƒæ¨¡æ“¬ -->
    <section class="card">
        <div class="section-title">è¿·ä½ æƒ…å¢ƒæ¨¡æ“¬ï¼šè³‡æ–™å‚³è¼¸ä¹‹æ—…</div>
        <p style="margin-bottom: 15px;">è§€å¯Ÿè³‡æ–™å¦‚ä½•å¾ A é›»è…¦å‚³é€åˆ° B é›»è…¦ï¼ˆè·¨ç¶²æ®µï¼‰ï¼š</p>
        
        <div class="sim-stage">
            <div class="sim-device">
                <div class="sim-icon">ğŸ’»</div>
                <div class="sim-label">PC A<br>(192.168.1.10)</div>
            </div>
            
            <!-- Router in the middle -->
            <div class="sim-device">
                <div class="sim-icon">ğŸ“¡</div>
                <div class="sim-label" style="color: #6ee7b7; font-weight:bold;">Router<br>(Layer 3)</div>
            </div>

            <div class="sim-device">
                <div class="sim-icon">ğŸ–¥ï¸</div>
                <div class="sim-label">PC B<br>(10.0.0.5)</div>
            </div>

            <!-- Moving Packet -->
            <div id="sim-packet" class="packet" style="display: none;">
                <span id="packet-icon">ğŸ“¦</span> 
                <span id="packet-text">Data</span>
            </div>
        </div>

        <div class="sim-controls">
            <button class="btn btn-primary" onclick="nextStep()" id="btn-next">é–‹å§‹å‚³è¼¸</button>
            <button class="btn btn-reset" onclick="resetSim()">é‡ç½®</button>
        </div>
        <div class="sim-log" id="sim-log">
            æº–å‚™å°±ç·’... è«‹æŒ‰ã€Œé–‹å§‹å‚³è¼¸ã€
        </div>
    </section>

    <!-- 4. é¸é …é€ä¸€ç ´è§£ -->
    <section class="card" id="breakdown-section">
        <div class="section-title">é¸é …é€ä¸€ç ´è§£</div>
        
        <div class="option-card wrong">
            <span class="option-header">(A) 2 - è³‡æ–™é€£çµå±¤ (Data Link Layer)</span>
            <p>é€™æ˜¯äº¤æ›å™¨ (Switch) é‹ä½œçš„å±¤ç´šï¼Œä½¿ç”¨ MAC ä½å€å‚³è¼¸ <strong>Frame (è¨Šæ¡†)</strong>ï¼Œé€šå¸¸åªåœ¨åŒä¸€å€‹å€åŸŸç¶²è·¯å…§æºé€šã€‚</p>
        </div>

        <div class="option-card correct">
            <span class="option-header">(B) 3 - ç¶²è·¯å±¤ (Network Layer) âœ… æ­£è§£</span>
            <p>è² è²¬é‚è¼¯å®šå€ (IP Address) èˆ‡ <strong>è·¯ç”±é¸æ“‡ (Routing)</strong>ã€‚è³‡æ–™å–®ä½ç¨±ç‚º <strong>Packet (å°åŒ…)</strong>ã€‚è·¯ç”±å™¨ (Router) æ˜¯æœ¬å±¤æœ€é‡è¦çš„è¨­å‚™ã€‚</p>
        </div>

        <div class="option-card wrong">
            <span class="option-header">(C) 4 - å‚³è¼¸å±¤ (Transport Layer)</span>
            <p>è² è²¬ç«¯å°ç«¯ (End-to-End) çš„å¯é åº¦èˆ‡æµé‡æ§åˆ¶ï¼Œå¸¸è¦‹å”å®šç‚º <strong>TCP/UDP</strong>ï¼Œè³‡æ–™å–®ä½ç‚º Segmentã€‚</p>
        </div>

        <div class="option-card wrong">
            <span class="option-header">(D) 5 - æœƒè«‡å±¤ (Session Layer)</span>
            <p>è² è²¬å»ºç«‹ã€ç®¡ç†å’Œçµ‚æ­¢æ‡‰ç”¨ç¨‹å¼ä¹‹é–“çš„æœƒè«‡ (Session)ï¼Œèˆ‡æœ¬é¡Œçš„ç¶²è·¯è·¯ç”±ç„¡é—œã€‚</p>
        </div>
    </section>

    <!-- 5. å°æ¸¬é©—å€ -->
    <section class="card" id="quiz-section">
        <div class="section-title">
            éš¨å ‚å°æ¸¬é©—
            <span class="badge" style="background:var(--accent-color); color:white;">Challenge</span>
        </div>
        <p class="question-text" style="margin-bottom: 20px;">OSI ç¶²è·¯æ¨¡å¼ä¸­ï¼Œç¶²è·¯å±¤ï¼ˆNetwork Layerï¼‰å±¬æ–¼ç¬¬å¹¾å±¤ï¼Ÿ</p>
        
        <div class="quiz-options">
            <button class="quiz-btn" onclick="checkAnswer('A')">(A) 2</button>
            <button class="quiz-btn" onclick="checkAnswer('B')">(B) 3</button>
            <button class="quiz-btn" onclick="checkAnswer('C')">(C) 4</button>
            <button class="quiz-btn" onclick="checkAnswer('D')">(D) 5</button>
        </div>

        <div id="quiz-feedback" class="quiz-feedback">
            <h3 id="feedback-title"></h3>
            <p id="feedback-msg"></p>
            <button id="retry-btn" class="btn btn-reset" style="margin-top:10px; display:none;" onclick="scrollToStack()">å¸¶æˆ‘å›ä¸ƒå±¤åœ–è¤‡ç¿’</button>
        </div>
    </section>

    <!-- 6. å»¶ä¼¸çŸ¥è­˜ (Accordion) -->
    <section class="card">
        <div class="section-title">å»¶ä¼¸çŸ¥è­˜è£œçµ¦ç«™</div>
        
        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                <span>å°åŒ…åœ¨æ¯ä¸€å±¤çš„åå­—å«ä»€éº¼ï¼Ÿ (PDU)</span>
                <span>+</span>
            </button>
            <div class="accordion-content">
                <ul style="padding-left: 20px; line-height: 2;">
                    <li>L4 å‚³è¼¸å±¤ï¼š<strong>Segment (å€æ®µ)</strong> / Datagram</li>
                    <li>L3 ç¶²è·¯å±¤ï¼š<strong>Packet (å°åŒ…)</strong> <span style="color:var(--secondary-color); font-weight:bold;">â† é‡é»ï¼</span></li>
                    <li>L2 è³‡æ–™é€£çµå±¤ï¼š<strong>Frame (è¨Šæ¡†)</strong></li>
                    <li>L1 å¯¦é«”å±¤ï¼š<strong>Bit (ä½å…ƒ)</strong></li>
                </ul>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-btn" onclick="toggleAccordion(this)">
                <span>å¸¸è¦‹è¨­å‚™å°æ‡‰å±¤ç´š</span>
                <span>+</span>
            </button>
            <div class="accordion-content">
                <ul style="padding-left: 20px; line-height: 2;">
                    <li>L3 Router (è·¯ç”±å™¨)ã€Layer 3 Switch</li>
                    <li>L2 Switch (äº¤æ›å™¨)ã€Bridge (æ©‹æ¥å™¨)</li>
                    <li>L1 Hub (é›†ç·šå™¨)ã€Repeater (ä¸­ç¹¼å™¨)</li>
                </ul>
            </div>
        </div>
    </section>

</main>

<footer>
    <p>Computer Science Networking Education &copy; 2025</p>
    <p>Designed for learning: OSI Model Network Layer</p>
</footer>

<script>
    // --- Data: OSI 7 Layers ---
    const osiData = [
        { 
            id: 7, name_en: "Application", name_zh: "æ‡‰ç”¨å±¤", 
            desc: "æä¾›ä½¿ç”¨è€…ä»‹é¢èˆ‡ç¶²è·¯æœå‹™ (HTTP, FTP, DNS)", unit: "Data", device: "PC / Server" 
        },
        { 
            id: 6, name_en: "Presentation", name_zh: "è¡¨ç¾å±¤", 
            desc: "è³‡æ–™æ ¼å¼è½‰æ›ã€åŠ å¯†èˆ‡è§£å¯† (JPEG, ASCII)", unit: "Data", device: "PC / Gateway" 
        },
        { 
            id: 5, name_en: "Session", name_zh: "æœƒè«‡å±¤", 
            desc: "å»ºç«‹ã€ç®¡ç†èˆ‡çµ‚æ­¢é€£ç·šæœƒè«‡ (RPC, SQL)", unit: "Data", device: "PC / Gateway" 
        },
        { 
            id: 4, name_en: "Transport", name_zh: "å‚³è¼¸å±¤", 
            desc: "ç«¯å°ç«¯å¯é å‚³è¼¸èˆ‡æµé‡æ§åˆ¶ (TCP, UDP, Port)", unit: "Segment", device: "Firewall" 
        },
        { 
            id: 3, name_en: "Network", name_zh: "ç¶²è·¯å±¤", 
            desc: "IP å®šå€èˆ‡æœ€ä½³è·¯å¾‘é¸æ“‡ (Routing)", unit: "Packet", device: "Router", 
            highlight: true // Special flag for Layer 3
        },
        { 
            id: 2, name_en: "Data Link", name_zh: "è³‡æ–™é€£çµå±¤", 
            desc: "å¯¦é«”ä½å€ (MAC) èˆ‡éŒ¯èª¤åµæ¸¬ (Ethernet, WiFi)", unit: "Frame", device: "Switch / Bridge" 
        },
        { 
            id: 1, name_en: "Physical", name_zh: "å¯¦é«”å±¤", 
            desc: "å‚³è¼¸åŸå§‹ä½å…ƒè¨Šè™Ÿ (é›»å£“, å…‰è¨Šè™Ÿ, ç·šæ)", unit: "Bit", device: "Hub / Cable" 
        }
    ];

    // --- Interactive Stack Logic ---
    const stackContainer = document.getElementById('stack-container');
    const infoPanel = document.getElementById('info-panel');

    function renderStack() {
        stackContainer.innerHTML = '';
        osiData.forEach(layer => {
            const div = document.createElement('div');
            div.className = 'osi-layer';
            div.dataset.layer = layer.id;
            div.innerHTML = `<span>Layer ${layer.id}</span> <span>${layer.name_zh} <small class="text-muted">(${layer.name_en})</small></span>`;
            
            div.onclick = () => showLayerInfo(layer, div);
            stackContainer.appendChild(div);
        });
    }

    function showLayerInfo(layer, element) {
        // Remove active class from all
        document.querySelectorAll('.osi-layer').forEach(el => el.classList.remove('active'));
        // Add active to clicked
        element.classList.add('active');

        // Special visual effect for Layer 3
        const isL3 = layer.id === 3;
        const titleColor = isL3 ? 'var(--secondary-color)' : 'var(--primary-color)';

        infoPanel.innerHTML = `
            <h3 class="info-title" style="color:${titleColor}">Layer ${layer.id}: ${layer.name_zh}</h3>
            <h4 style="color:#666; margin-bottom:15px;">${layer.name_en} Layer</h4>
            
            <div class="info-detail">
                <strong>ğŸ’¡ ä¸»è¦åŠŸèƒ½ï¼š</strong> ${layer.desc}
            </div>
            <div class="info-detail">
                <strong>ğŸ“¦ è³‡æ–™å–®ä½ (PDU)ï¼š</strong> <span class="badge">${layer.unit}</span>
            </div>
            <div class="info-detail">
                <strong>âš™ï¸ å¸¸è¦‹å”å®š/è¨­å‚™ï¼š</strong> ${layer.device}
            </div>
            ${isL3 ? '<div style="margin-top:15px; padding:10px; background:#ecfdf5; border-left:4px solid #10b981; color:#065f46;">â­ <strong>æœ¬é¡Œé‡é»ï¼š</strong> ç¶²è·¯å±¤è² è²¬è™•ç† <strong>IP ä½å€</strong>ï¼Œä¸¦é€éè·¯ç”±å™¨ (Router) æ±ºå®šè³‡æ–™å‚³è¼¸çš„è·¯å¾‘ (Routing)ã€‚</div>' : ''}
        `;
    }

    // Initialize Stack
    renderStack();

    // --- Simulation Logic ---
    let simStep = 0;
    const packet = document.getElementById('sim-packet');
    const simLog = document.getElementById('sim-log');
    const btnNext = document.getElementById('btn-next');
    const packetText = document.getElementById('packet-text');

    function nextStep() {
        simStep++;
        packet.style.display = 'flex';
        
        switch(simStep) {
            case 1:
                // Step 1: PC A
                packet.style.left = '10%';
                packet.style.backgroundColor = '#9ca3af'; // Neutral
                packetText.innerHTML = "Data";
                simLog.innerHTML = `[Step 1] PC A ç”¢ç”Ÿè³‡æ–™ (L4-L7)ã€‚`;
                btnNext.innerText = "ä¸‹ä¸€æ­¥ï¼šå°è£ IP";
                break;
            case 2:
                // Step 2: Encapsulation L3
                packet.style.backgroundColor = 'var(--secondary-color)'; // Green for L3
                packetText.innerHTML = "<span class='packet-layer-tag'>IP</span> Packet";
                simLog.innerHTML = `[Step 2] <span class="highlight-text">Layer 3 (Network)</span> åŠ å…¥ä¾†æºèˆ‡ç›®çš„ IP ä½å€ï¼Œè®Šæˆã€ŒPacket (å°åŒ…)ã€ã€‚`;
                btnNext.innerText = "ä¸‹ä¸€æ­¥ï¼šå‚³é€è‡³ Router";
                break;
            case 3:
                // Step 3: Move to Router
                packet.style.left = '50%';
                simLog.innerHTML = `[Step 3] å°åŒ…å‚³é€åˆ°è·¯ç”±å™¨ (Router)ã€‚`;
                btnNext.innerText = "ä¸‹ä¸€æ­¥ï¼šè·¯ç”±åˆ¤æ–·";
                break;
            case 4:
                // Step 4: Routing Decision
                packet.style.transform = 'translate(-50%, -50%) scale(1.2)'; // Pulse effect
                setTimeout(() => packet.style.transform = 'translate(-50%, -50%) scale(1)', 300);
                simLog.innerHTML = `[Step 4] <span class="highlight-text">Router (Layer 3)</span> è®€å– IP æ¨™é ­ï¼ŒæŸ¥è¡¨æ±ºå®šè·¯å¾‘ (Routing)ã€‚`;
                btnNext.innerText = "ä¸‹ä¸€æ­¥ï¼šé€é” PC B";
                break;
            case 5:
                // Step 5: Move to PC B
                packet.style.left = '85%';
                simLog.innerHTML = `[Step 5] æ ¹æ“šè·¯ç”±çµæœï¼Œå°åŒ…æˆåŠŸé€é” PC Bã€‚`;
                btnNext.innerText = "å®Œæˆ (é‡ç½®)";
                break;
            default:
                resetSim();
        }
    }

    function resetSim() {
        simStep = 0;
        packet.style.display = 'none';
        packet.style.left = '10%';
        packet.style.transform = 'translateY(-50%)';
        simLog.innerHTML = "æº–å‚™å°±ç·’... è«‹æŒ‰ã€Œé–‹å§‹å‚³è¼¸ã€";
        btnNext.innerText = "é–‹å§‹å‚³è¼¸";
    }

    // --- Quiz Logic ---
    function checkAnswer(answer) {
        const feedbackBox = document.getElementById('quiz-feedback');
        const title = document.getElementById('feedback-title');
        const msg = document.getElementById('feedback-msg');
        const retryBtn = document.getElementById('retry-btn');
        const buttons = document.querySelectorAll('.quiz-btn');

        // Reset Styles
        feedbackBox.className = 'quiz-feedback show';
        buttons.forEach(btn => btn.className = 'quiz-btn');

        if (answer === 'B') {
            // Correct
            feedbackBox.classList.add('feedback-success');
            feedbackBox.classList.remove('feedback-error');
            title.innerText = "ğŸ‰ ç­”å°äº†ï¼";
            msg.innerText = "æ²’éŒ¯ï¼Network Layer å°±æ˜¯ç¬¬ 3 å±¤ï¼Œè² è²¬è™•ç† IP èˆ‡è·¯ç”± (Routing)ã€‚";
            retryBtn.style.display = 'none';
            
            // Highlight correct button
            buttons[1].classList.add('correct');
        } else {
            // Incorrect
            feedbackBox.classList.add('feedback-error');
            feedbackBox.classList.remove('feedback-success');
            title.innerText = "âŒ ç­”éŒ¯å›‰";
            msg.innerText = "æç¤ºï¼šç¬¬ 2 å±¤æ˜¯è³‡æ–™é€£çµå±¤ï¼Œç¬¬ 4 å±¤æ˜¯å‚³è¼¸å±¤ã€‚Network Layer å¤¾åœ¨ä¸­é–“ã€‚";
            retryBtn.style.display = 'inline-block';

            // Highlight wrong button
            const index = answer.charCodeAt(0) - 65;
            buttons[index].classList.add('incorrect');
        }
    }

    function scrollToStack() {
        const el = document.getElementById('osi-interactive');
        el.scrollIntoView({ behavior: 'smooth' });
        
        // Auto click Layer 3 after scroll
        setTimeout(() => {
            const layer3 = document.querySelector('.osi-layer[data-layer="3"]');
            if(layer3) layer3.click();
        }, 800);
    }

    // --- Accordion Logic ---
    function toggleAccordion(btn) {
        const content = btn.nextElementSibling;
        const isOpen = content.classList.contains('open');
        
        // Close all first (optional, for accordion style)
        // document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('open'));

        if (!isOpen) {
            content.classList.add('open');
            btn.querySelector('span:last-child').innerText = '-';
        } else {
            content.classList.remove('open');
            btn.querySelector('span:last-child').innerText = '+';
        }
    }

</script>

</body>
</html>