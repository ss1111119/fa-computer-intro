<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬é–‹é‡‘é‘°åŠ å¯†äº’å‹•æ•™å­¸ï¼šåˆ°åº•éœ€è¦å¹¾æŠŠé‘°åŒ™ï¼Ÿ</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-radius: 8px;
            --transition-speed: 0.3s;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        /* ç‰ˆé¢çµæ§‹ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            margin-bottom: 15px;
            color: #111827;
        }

        h1 {
            font-size: 1.8rem;
            text-align: center;
        }

        h2 {
            font-size: 1.4rem;
            border-left: 5px solid var(--primary-color);
            padding-left: 10px;
            margin-top: 10px;
        }

        p {
            margin-bottom: 10px;
        }

        .highlight {
            color: var(--primary-color);
            font-weight: bold;
        }

        .term {
            background-color: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #374151;
        }

        /* é é¦– */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .summary-box {
            background-color: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #1e40af;
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 10px;
            font-weight: bold;
        }

        /* äº’å‹•æ¨¡æ“¬å€æ¨£å¼ */
        .sim-container {
            position: relative;
            background-color: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius);
            padding: 20px;
            min-height: 350px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            overflow: hidden; /* ç¢ºä¿å‹•ç•«ä¸å‡ºç•Œ */
        }

        .computer-node {
            flex: 1;
            min-width: 250px;
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .computer-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .key-ring {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .key {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }

        .key-icon {
            font-size: 1.2rem;
            margin-right: 5px;
        }

        .key.public {
            background-color: #fffbeb;
            border-color: #fcd34d;
            color: #b45309;
        }

        .key.private {
            background-color: #fef2f2;
            border-color: #fca5a5;
            color: #b91c1c;
        }

        .key.active {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
            border-width: 2px;
        }

        /* å‚³è¼¸å‹•ç•«ç‰©ä»¶ */
        .packet {
            position: absolute;
            top: 40%;
            left: 20%; /* åˆå§‹ä½ç½® A */
            width: 60px;
            height: 60px;
            background: #fff;
            border: 2px solid var(--text-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            z-index: 10;
            opacity: 0; /* åˆå§‹éš±è— */
            transition: left 1.5s ease-in-out, opacity 0.3s;
        }

        .packet.encrypted {
            background: #1f2937;
            color: #fff;
            border-color: #000;
        }

        /* æ§åˆ¶æŒ‰éˆ•èˆ‡Logå€ */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: background 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover { background-color: #1d4ed8; }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        .btn-secondary:hover { background-color: #059669; }

        .btn-reset {
            background-color: #9ca3af;
            color: white;
        }
        .btn-reset:hover { background-color: #6b7280; }

        .log-panel {
            margin-top: 15px;
            background: #1f2937;
            color: #10b981; /* Terminal green */
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            min-height: 100px;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #374151;
            padding-bottom: 2px;
        }
        .log-entry:last-child { border-bottom: none; }

        .instruction-banner {
            text-align: center;
            color: var(--primary-color);
            font-weight: bold;
            margin: 10px 0;
            min-height: 1.6em;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f3f4f6;
            color: #374151;
        }
        .exam-tip {
            margin-top: 15px;
            background-color: #fff7ed;
            border-left: 4px solid #f97316;
            padding: 10px;
            color: #9a3412;
            font-weight: bold;
        }

        /* å°æ¸¬é©—æ¨£å¼ */
        .quiz-option {
            display: block;
            width: 100%;
            text-align: left;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .quiz-option:hover {
            border-color: var(--primary-color);
            background-color: #eff6ff;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .quiz-feedback.correct {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #34d399;
        }

        .quiz-feedback.wrong {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #f87171;
        }

        /* Accordion (å»¶ä¼¸çŸ¥è­˜) */
        .accordion {
            background-color: #f9fafb;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1rem;
            font-weight: bold;
            transition: 0.4s;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
        }

        .active, .accordion:hover {
            background-color: #e5e7eb;
        }

        .accordion:after {
            content: '\002B';
            color: #777;
            font-weight: bold;
            float: right;
            margin-left: 5px;
        }

        .active:after {
            content: "\2212";
        }

        .panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
        }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 600px) {
            .sim-container {
                flex-direction: column;
            }
            .packet {
                display: none; /* æ‰‹æ©Ÿç‰ˆç°¡åŒ–å‹•ç•«ï¼Œé¿å…ä½ç½®è¨ˆç®—è¤‡é›œ */
            }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>å…¬é–‹é‡‘é‘°åŠ å¯† (Public Key Encryption)</h1>
        <div class="summary-box">é‡é»æ‘˜è¦ï¼šå…©å°é›»è…¦é€šè¨Šï¼Œå„æœ‰ä¸€å°é‘°åŒ™ï¼Œç¸½å…± 4 æŠŠï¼</div>
    </header>

    <!-- 1. æ¦‚å¿µé€Ÿè®€ -->
    <section id="concepts">
        <h2>ğŸ”‘ æ¦‚å¿µé€Ÿè®€</h2>
        <ul>
            <li><strong>ä¸€äººä¸€å°é‘°åŒ™ï¼š</strong> æ¯å€‹ä½¿ç”¨è€…ï¼ˆæˆ–é›»è…¦ï¼‰éƒ½æ“æœ‰è‡ªå·±çš„ä¸€å°é‘°åŒ™ï¼šä¸€æŠŠ<span class="highlight">å…¬é–‹é‡‘é‘° (Public Key)</span> å’Œ ä¸€æŠŠ<span class="highlight">ç§å¯†é‡‘é‘° (Private Key)</span>ã€‚</li>
            <li><strong>éå°ç¨±å¼ (Asymmetric)ï¼š</strong> å› ç‚ºåŠ å¯†å’Œè§£å¯†ä½¿ç”¨çš„æ˜¯ã€Œä¸åŒã€çš„é‘°åŒ™ï¼Œæ‰€ä»¥ç¨±ç‚ºéå°ç¨±å¼åŠ å¯†ã€‚</li>
            <li><strong>è¦å‰‡ï¼š</strong> å…¬é–‹é‡‘é‘°å¯ä»¥çµ¦ä»»ä½•äººï¼Œç§å¯†é‡‘é‘°å¿…é ˆè‡ªå·±ä¿ç®¡å¥½ã€‚</li>
        </ul>
    </section>

    <!-- 2. äº’å‹•æ¨¡æ“¬å€ -->
    <section id="simulation">
        <h2>ğŸ® äº’å‹•æ¨¡æ“¬ï¼šA å‚³é€ç§˜å¯†è¨Šæ¯çµ¦ B</h2>
        <p>è«‹è§€å¯Ÿä¸‹æ–¹çš„å…©å°é›»è…¦ã€‚æ¯å°é›»è…¦éƒ½å›ºå®šæŒæœ‰å…©æŠŠé‘°åŒ™ã€‚</p>
        
        <div class="instruction-banner" id="sim-instruction">æº–å‚™å°±ç·’ï¼Œè«‹é»æ“Šã€Œé–‹å§‹ç¤ºç¯„ã€æˆ–ã€Œä¸‹ä¸€æ­¥ã€</div>

        <div class="sim-container">
            <!-- é›»è…¦ A -->
            <div class="computer-node" id="node-a">
                <div class="computer-icon">ğŸ’» A</div>
                <div class="key-ring">
                    <div class="key public" id="key-a-pub"><span class="key-icon">ğŸ”‘</span>A-Public (A çš„å…¬é‘°)</div>
                    <div class="key private" id="key-a-priv"><span class="key-icon">ğŸ—ï¸</span>A-Private (A çš„ç§é‘°)</div>
                </div>
            </div>

            <!-- å‹•ç•«å‚³è¼¸å°åŒ… -->
            <div class="packet" id="packet">ğŸ“„</div>

            <!-- é›»è…¦ B -->
            <div class="computer-node" id="node-b">
                <div class="computer-icon">ğŸ’» B</div>
                <div class="key-ring">
                    <div class="key public" id="key-b-pub"><span class="key-icon">ğŸ”‘</span>B-Public (B çš„å…¬é‘°)</div>
                    <div class="key private" id="key-b-priv"><span class="key-icon">ğŸ—ï¸</span>B-Private (B çš„ç§é‘°)</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="autoPlay()">â–¶ é–‹å§‹ç¤ºç¯„</button>
            <button class="btn-secondary" onclick="nextStep()">â­ ä¸‹ä¸€æ­¥</button>
            <button class="btn-reset" onclick="resetSim()">â†º é‡ç½®</button>
        </div>

        <div class="log-panel" id="log-panel">
            <div class="log-entry">> ç³»çµ±å°±ç·’...ç­‰å¾…æŒ‡ä»¤ã€‚</div>
        </div>
    </section>

    <!-- 3. å°ç…§æ¯”è¼ƒå€ -->
    <section id="comparison">
        <h2>âš–ï¸ å°ç…§æ¯”è¼ƒï¼šå°ç¨± vs éå°ç¨±</h2>
        <table>
            <thead>
                <tr>
                    <th>ç‰¹æ€§</th>
                    <th>å°ç¨±å¼åŠ å¯† (Symmetric)</th>
                    <th>éå°ç¨±å¼åŠ å¯† (Asymmetric)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>é‘°åŒ™æ•¸é‡</strong></td>
                    <td>é›™æ–¹å…±ç”¨ <strong>1</strong> æŠŠ</td>
                    <td>é›™æ–¹å„ 2 æŠŠï¼Œå…± <strong>4</strong> æŠŠ</td>
                </tr>
                <tr>
                    <td><strong>é‘°åŒ™åŠŸèƒ½</strong></td>
                    <td>åŠ å¯†è§£å¯†ç”¨åŒä¸€æŠŠ</td>
                    <td>åŠ å¯†ç”¨å…¬é‘°ï¼Œè§£å¯†ç”¨ç§é‘°</td>
                </tr>
                <tr>
                    <td><strong>å®‰å…¨æ€§</strong></td>
                    <td>å‚³è¼¸é‘°åŒ™æœ‰é¢¨éšª</td>
                    <td>ç„¡éœ€å‚³è¼¸ç§é‘°ï¼Œè¼ƒå®‰å…¨</td>
                </tr>
            </tbody>
        </table>
        <div class="exam-tip">
            ğŸ’¡ è€ƒè©¦å¿…è€ƒé¡Œå‹ï¼š<br>
            å•ï¼šã€Œå…©éƒ¨é›»è…¦ä½¿ç”¨å…¬é–‹é‡‘é‘°åŠ å¯†é€²è¡Œé›™å‘å‚³è¼¸ï¼Œå…±éœ€ç”¢ç”Ÿå¹¾æŠŠé‘°åŒ™ï¼Ÿã€<br>
            ç­”ï¼šA æœ‰ (å…¬+ç§)ï¼ŒB æœ‰ (å…¬+ç§) â†’ <strong>å…± 4 æŠŠ</strong>ã€‚
        </div>
    </section>

    <!-- 4. å°æ¸¬é©—å€ -->
    <section id="quiz">
        <h2>ğŸ“ å°æ¸¬é©—</h2>
        <p><strong>é¡Œç›®ï¼š</strong> å…©éƒ¨é›»è…¦ï¼ˆA èˆ‡ Bï¼‰ä½¿ç”¨å…¬é–‹é‡‘é‘°åŠ å¯†å‚³è¼¸æ™‚ï¼Œç‚ºäº†ç¢ºä¿é›™æ–¹éƒ½èƒ½æ¥æ”¶åŠ å¯†è¨Šæ¯ï¼Œç³»çµ±ä¸­ç¸½å…±éœ€è¦ç”¢ç”Ÿå¹¾æŠŠé‘°åŒ™ï¼Ÿ</p>
        
        <div id="quiz-options">
            <button class="quiz-option" onclick="checkAnswer(2)">(A) 2 æŠŠ</button>
            <button class="quiz-option" onclick="checkAnswer(3)">(B) 3 æŠŠ</button>
            <button class="quiz-option" onclick="checkAnswer(4)">(C) 4 æŠŠ</button>
            <button class="quiz-option" onclick="checkAnswer(5)">(D) 5 æŠŠ</button>
        </div>

        <div id="feedback" class="quiz-feedback"></div>
    </section>

    <!-- 5. å¸¸è¦‹éŒ¯èª¤èˆ‡æé†’ -->
    <section id="mistakes">
        <h2>âš ï¸ å¸¸è¦‹æ··æ·†é»</h2>
        <ul>
            <li><strong>èª¤è§£ 1ï¼š</strong> ä»¥ç‚ºåŠ å¯†å’Œè§£å¯†ç”¨åŒä¸€æŠŠé‘°åŒ™ï¼ˆé‚£æ˜¯å°ç¨±å¼åŠ å¯†ï¼‰ã€‚</li>
            <li><strong>èª¤è§£ 2ï¼š</strong> ä»¥ç‚ºç§å¯†é‡‘é‘°ä¹Ÿéœ€è¦å‚³é€çµ¦å°æ–¹ï¼ˆçµ•å°ä¸è¡Œï¼ç§é‘°æ°¸é ä¸é›¢é–‹è‡ªå·±çš„é›»è…¦ï¼‰ã€‚</li>
            <li><strong>èª¤è§£ 3ï¼š</strong> æ··æ·†ã€Œå…¬é‘°åŠ å¯†ã€èˆ‡ã€Œæ•¸ä½ç°½ç« ã€ã€‚åŠ å¯†æ˜¯ç”¨å°æ–¹çš„å…¬é‘°ï¼Œç°½ç« æ˜¯ç”¨è‡ªå·±çš„ç§é‘°ã€‚</li>
        </ul>
    </section>

    <!-- 6. å»¶ä¼¸çŸ¥è­˜ -->
    <section id="extended">
        <h2>ğŸ“š å»¶ä¼¸çŸ¥è­˜</h2>
        
        <button class="accordion">HTTPS / TLS æ˜¯ä»€éº¼ï¼Ÿ</button>
        <div class="panel">
            <p style="padding-top:10px;">æˆ‘å€‘æ¯å¤©ä¸Šçš„ç¶²ç«™ï¼ˆHTTPSï¼‰å…¶å¯¦æ˜¯æ··åˆä½¿ç”¨ã€‚å‰›é€£ç·šæ¡æ‰‹ï¼ˆHandshakeï¼‰æ™‚ä½¿ç”¨<strong>éå°ç¨±åŠ å¯†</strong>ä¾†å®‰å…¨åœ°äº¤æ›é‘°åŒ™ï¼Œä¹‹å¾Œç‚ºäº†é€Ÿåº¦ï¼Œæ”¹ç”¨<strong>å°ç¨±å¼åŠ å¯†</strong>å‚³è¼¸å¤§é‡è³‡æ–™ã€‚</p>
        </div>

        <button class="accordion">ä»€éº¼æ˜¯æ•¸ä½ç°½ç«  (Digital Signature)ï¼Ÿ</button>
        <div class="panel">
            <p style="padding-top:10px;">æ•¸ä½ç°½ç« çš„åŸç†å‰›å¥½è·ŸåŠ å¯†ç›¸åï¼š<br>
            <strong>åŠ å¯†ï¼š</strong>ç”¨å°æ–¹çš„å…¬é‘°é–ä¸Šï¼Œå°æ–¹ç”¨ç§é‘°é–‹ï¼ˆä¿å¯†æ€§ï¼‰ã€‚<br>
            <strong>ç°½ç« ï¼š</strong>ç”¨è‡ªå·±çš„ç§é‘°ç°½ç½²ï¼Œå°æ–¹ç”¨å…¬é‘°é©—è­‰ï¼ˆç¢ºèªç™¼é€è€…èº«åˆ†ï¼‰ã€‚</p>
        </div>
    </section>
</div>

<script>
    // --- æ¨¡æ“¬å€é‚è¼¯ ---
    let currentStep = 0;
    const maxSteps = 4;
    let autoPlayTimer = null;

    // å–å¾— DOM å…ƒç´ 
    const elPacket = document.getElementById('packet');
    const elInstruction = document.getElementById('sim-instruction');
    const elLogPanel = document.getElementById('log-panel');
    const elKeyBPub = document.getElementById('key-b-pub');
    const elKeyBPriv = document.getElementById('key-b-priv');
    const elKeyAPub = document.getElementById('key-a-pub'); // é›–ç„¶æ­¤æ¬¡æµç¨‹æ²’ç”¨åˆ°ï¼Œä½†ç‚ºäº†å®Œæ•´æ€§
    
    // å®šç¾©æ­¥é©Ÿè³‡æ–™
    const steps = [
        {
            text: "æº–å‚™å°±ç·’ã€‚A æƒ³è¦å‚³è¨Šæ¯çµ¦ Bã€‚",
            action: () => {
                resetVisuals();
                log("åˆå§‹åŒ–å®Œæˆã€‚A æœ‰ä¸€å°é‘°åŒ™ï¼ŒB æœ‰ä¸€å°é‘°åŒ™ã€‚");
            }
        },
        {
            text: "æ­¥é©Ÿ 1ï¼šA å–å¾— B çš„å…¬é–‹é‡‘é‘° (B-Public)",
            action: () => {
                // è¦–è¦ºæ•ˆæœï¼šé«˜äº® B çš„å…¬é‘°
                elKeyBPub.classList.add('active');
                // å°‡å°åŒ…é¡¯ç¤ºåœ¨ A è™•
                elPacket.style.opacity = '1';
                elPacket.style.left = '10%'; // é è¿‘ A
                elPacket.innerHTML = 'ğŸ“„'; // æ˜æ–‡
                elPacket.classList.remove('encrypted');
                log("A å¾å…¬é–‹ç›®éŒ„å–å¾— B-Publicã€‚");
            }
        },
        {
            text: "æ­¥é©Ÿ 2ï¼šA ä½¿ç”¨ B-Public é€²è¡Œã€ŒåŠ å¯†ã€",
            action: () => {
                // è¦–è¦ºæ•ˆæœï¼šå°åŒ…è®Šé–é ­
                elPacket.innerHTML = 'ğŸ”’';
                elPacket.classList.add('encrypted');
                log("A ä½¿ç”¨ B-Public å°‡æ˜æ–‡åŠ å¯†æˆå¯†æ–‡ã€‚");
                log("æ³¨æ„ï¼šç¾åœ¨åªæœ‰æ“æœ‰ B-Private çš„äººèƒ½è§£é–‹å®ƒã€‚");
            }
        },
        {
            text: "æ­¥é©Ÿ 3ï¼šå¯†æ–‡é€éç¶²è·¯å‚³è¼¸åˆ° B",
            action: () => {
                // è¦–è¦ºæ•ˆæœï¼šç§»å‹•å°åŒ…
                // æª¢æŸ¥æ˜¯å¦ç‚ºå¯¬è¢å¹• (ç°¡å–®åˆ¤æ–·)
                if(window.innerWidth > 600) {
                    elPacket.style.left = '70%'; // ç§»å‹•åˆ° B é™„è¿‘
                } else {
                    log("ï¼ˆæ‰‹æ©Ÿç‰ˆè¦–åœ–ï¼‰å¯†æ–‡å·²å‚³é€è‡³ Bã€‚");
                }
                elKeyBPub.classList.remove('active'); // å–æ¶ˆå…¬é‘°é«˜äº®
                log("å¯†æ–‡æ­£åœ¨ç¶²è·¯ä¸Šå‚³è¼¸... é§­å®¢æ””æˆªä¹Ÿæ‰“ä¸é–‹ã€‚");
            }
        },
        {
            text: "æ­¥é©Ÿ 4ï¼šB ä½¿ç”¨è‡ªå·±çš„ B-Private é€²è¡Œã€Œè§£å¯†ã€",
            action: () => {
                // è¦–è¦ºæ•ˆæœï¼šé«˜äº® B çš„ç§é‘°ï¼Œå°åŒ…è®Šå›æ–‡ä»¶
                elKeyBPriv.classList.add('active');
                setTimeout(() => {
                    elPacket.innerHTML = 'ğŸ“„';
                    elPacket.classList.remove('encrypted');
                }, 500);
                log("B ä½¿ç”¨ B-Private æˆåŠŸè§£å¯†ï¼");
                log("æµç¨‹çµæŸã€‚");
            }
        }
    ];

    function log(msg) {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.textContent = `> ${msg}`;
        elLogPanel.appendChild(entry);
        elLogPanel.scrollTop = elLogPanel.scrollHeight;
    }

    function resetVisuals() {
        elPacket.style.opacity = '0';
        elPacket.style.left = '20%';
        elPacket.innerHTML = 'ğŸ“„';
        elPacket.classList.remove('encrypted');
        
        document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
    }

    function resetSim() {
        if(autoPlayTimer) clearInterval(autoPlayTimer);
        currentStep = 0;
        elLogPanel.innerHTML = '';
        log("é‡ç½®ç³»çµ±...");
        steps[0].action();
        elInstruction.textContent = steps[0].text;
    }

    function nextStep() {
        if (currentStep < maxSteps) {
            currentStep++;
            updateSimState();
        } else {
            // å·²ç¶“çµæŸï¼Œè©¢å•æ˜¯å¦é‡ç½®
            if(confirm("æ¼”ç¤ºå·²çµæŸï¼Œè¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
                resetSim();
            }
        }
    }

    function updateSimState() {
        const stepData = steps[currentStep];
        elInstruction.textContent = stepData.text;
        stepData.action();
    }

    function autoPlay() {
        resetSim();
        // ç«‹å³åŸ·è¡Œç¬¬1æ­¥
        setTimeout(() => nextStep(), 500);
        
        autoPlayTimer = setInterval(() => {
            if (currentStep < maxSteps) {
                nextStep();
            } else {
                clearInterval(autoPlayTimer);
            }
        }, 2000); // æ¯2ç§’ä¸€æ­¥
    }

    // åˆå§‹åŒ–
    resetSim();

    // --- æ¸¬é©—å€é‚è¼¯ ---
    function checkAnswer(ans) {
        const feedback = document.getElementById('feedback');
        feedback.style.display = 'block';
        
        if (ans === 4) {
            feedback.className = 'quiz-feedback correct';
            feedback.innerHTML = `
                <h3>âœ… ç­”å°äº†ï¼</h3>
                <p>ç†ç”±ï¼šæ¯ä¸€å°é›»è…¦éƒ½éœ€è¦ç”¢ç”Ÿä¸€å°é‘°åŒ™ï¼ˆ1 å…¬é‘° + 1 ç§é‘°ï¼‰ã€‚<br>
                æ—¢ç„¶æœ‰ A èˆ‡ B å…©å°é›»è…¦ï¼Œå°±æ˜¯ 2 å°ï¼Œç¸½å…± <strong>4 æŠŠé‘°åŒ™</strong>ã€‚</p>
            `;
        } else {
            feedback.className = 'quiz-feedback wrong';
            feedback.innerHTML = `
                <h3>âŒ ç­”éŒ¯äº†</h3>
                <p>æç¤ºï¼šéå°ç¨±åŠ å¯†ä¸æ˜¯å…±ç”¨é‘°åŒ™å–”ï¼<br>
                é›»è…¦ A æœ‰ä¸€å°ï¼ˆå…¬+ç§ï¼‰ï¼Œé›»è…¦ B ä¹Ÿæœ‰ä¸€å°ï¼ˆå…¬+ç§ï¼‰ã€‚<br>
                å†ç®—ç®—çœ‹ç¸½å…±å¹¾æŠŠï¼Ÿ</p>
                <button style="margin-top:10px; font-size:0.9rem;" onclick="scrollToSim()">å¸¶æˆ‘å›å»çœ‹æ¨¡æ“¬åœ–</button>
            `;
        }
    }

    function scrollToSim() {
        document.getElementById('simulation').scrollIntoView({ behavior: 'smooth' });
        // é«˜äº®æç¤º
        document.getElementById('simulation').style.borderColor = "#f59e0b";
        setTimeout(() => {
            document.getElementById('simulation').style.borderColor = "#e2e8f0";
        }, 2000);
    }

    // --- Accordion é‚è¼¯ ---
    var acc = document.getElementsByClassName("accordion");
    for (var i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.maxHeight) {
                panel.style.maxHeight = null;
            } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
            } 
        });
    }
</script>

</body>
</html>