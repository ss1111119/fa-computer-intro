<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è…¦çµ„ç¹”æ•™å­¸ï¼šDMA èˆ‡ I/O è™•ç† (ç¬¬10é¡Œ)</title>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        :root {
            --primary-color: #2c3e50; /* æ·±è—ï¼šå°ˆæ¥­æ„Ÿ */
            --accent-color: #3498db; /* äº®è—ï¼šé‡é» */
            --success-color: #27ae60; /* ç¶ è‰²ï¼šæ­£ç¢º/DMA */
            --error-color: #c0392b; /* ç´…è‰²ï¼šéŒ¯èª¤/CPUå¿™ç¢Œ */
            --warning-color: #f39c12; /* æ©˜è‰²ï¼šé™·é˜± */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-color: #333333;
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- æ¨™é¡Œå€ --- */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .subtitle {
            color: #666;
            font-size: 1rem;
        }

        /* --- å¡ç‰‡é€šç”¨æ¨£å¼ --- */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent-color);
        }

        h2 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
            font-size: 1.4rem;
        }

        /* --- é¡Œç›®å€æ¨£å¼ --- */
        .question-box {
            background-color: #eef7fb;
            border-left-color: var(--primary-color);
        }

        .q-number {
            font-weight: bold;
            color: var(--accent-color);
            display: block;
            margin-bottom: 10px;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn-option {
            font-size: 2rem;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }

        .btn-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-o { color: var(--success-color); }
        .btn-x { color: var(--error-color); }

        .btn-o:hover, .btn-o.selected { background: #e8f8f5; border-color: var(--success-color); }
        .btn-x:hover, .btn-x.selected { background: #fdedec; border-color: var(--error-color); }

        /* --- åé¥‹å€ --- */
        #feedback-area {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            animation: fadeIn 0.5s;
        }

        .feedback-correct {
            background-color: #d4efdf;
            border: 1px solid var(--success-color);
            color: #145a32;
        }

        .feedback-wrong {
            background-color: #fadbd8;
            border: 1px solid var(--error-color);
            color: #7b241c;
        }

        /* --- åè©è§£é‡‹ --- */
        .term-list dt {
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 10px;
        }
        .term-list dd {
            margin-left: 20px;
            margin-bottom: 5px;
            color: #555;
        }

        /* --- æ ¸å¿ƒè§€å¿µè¦–è¦ºåŒ– (å‹•ç•«å€) --- */
        .viz-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-ctrl {
            padding: 8px 16px;
            background: #eee;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-ctrl.active {
            background: var(--accent-color);
            color: white;
            font-weight: bold;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            position: relative;
            height: 150px;
            border: 1px solid #ddd;
        }

        .component-box {
            width: 80px;
            height: 80px;
            background: white;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
            text-align: center;
            padding: 5px;
        }

        .box-cpu { border-color: var(--error-color); }
        .box-mem { border-color: var(--success-color); }
        .box-io { border-color: var(--primary-color); }

        /* è³‡æ–™å°åŒ…å‹•ç•« */
        .data-packet {
            width: 15px;
            height: 15px;
            background-color: orange;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50px; /* èµ·é»åœ¨ IO */
            transform: translateY(-50%);
            display: none;
            z-index: 3;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        /* è·¯å¾‘ç·šæ¢ */
        .path-line {
            position: absolute;
            height: 4px;
            background: #ddd;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
        }

        /* ç‹€æ…‹æŒ‡ç¤ºç‡ˆ */
        .cpu-status-indicator {
            font-size: 0.8rem;
            margin-top: 5px;
            padding: 2px 5px;
            border-radius: 4px;
        }

        /* --- é™·é˜±å¡ --- */
        .trap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .trap-card {
            background: #fff8e1;
            border: 1px solid var(--warning-color);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: opacity 0.5s;
            position: relative;
        }

        .trap-card h3 {
            margin: 0 0 10px 0;
            color: #d35400;
            font-size: 1rem;
        }

        .trap-card .dismiss-btn {
            display: block;
            margin-top: 10px;
            text-align: center;
            background: var(--warning-color);
            color: white;
            padding: 5px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        /* --- è‡ªæˆ‘æª¢æ¸¬ --- */
        .quiz-item {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .hint-text {
            display: none;
            margin-top: 5px;
            color: var(--accent-color);
            font-style: italic;
        }

        .btn-hint {
            background: transparent;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* --- å‹•ç•«é—œéµå½±æ ¼ --- */
        @keyframes movePIO {
            0% { left: 15%; opacity: 1; } /* I/O */
            50% { left: 50%; opacity: 1; } /* CPU */
            100% { left: 85%; opacity: 1; } /* Memory */
        }

        @keyframes moveDMA {
            0% { left: 15%; opacity: 1; } /* I/O */
            40% { left: 50%; opacity: 0; } /* éš±å½¢ç¶“é CPU ä¸‹æ–¹ */
            100% { left: 85%; opacity: 1; } /* Memory */
        }
        
        /* å°ˆé–€çµ¦DMAçš„å‹•ç•«ï¼Œç¹éä¸­é–“ */
        @keyframes moveDMA_Direct {
            0% { left: 15%; top: 50%; }
            20% { top: 75%; } /* å‘ä¸‹ç¹ */
            80% { top: 75%; }
            100% { left: 85%; top: 50%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.9rem;
            color: #888;
        }

        .reset-btn {
            background: #7f8c8d;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* æ¨™è¨»é‡é» */
        .highlight {
            color: #d35400;
            font-weight: bold;
            background: #fef9e7;
            padding: 0 4px;
        }

    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>é›»è…¦çµ„ç¹”äº’å‹•è¬›ç¾©ï¼šI/O èˆ‡ DMA</h1>
        <div class="subtitle">é«˜ä¸­é›»è…¦æ¦‚è«– / é©åˆåˆå­¸è€… / ç¬¬ 10 é¡Œè©³è§£</div>
    </header>

    <!-- 1. é¡Œç›®å€ -->
    <section class="card question-box">
        <span class="q-number">ç¬¬ 10 é¡Œ</span>
        <div class="q-text">
            ç›´æ¥è¨˜æ†¶é«”å­˜å–ï¼ˆDMAï¼‰è™•ç† I/O çš„å‹•ä½œå¯ä»¥ä¸å¿…ç¶“é CPU åŸ·è¡Œã€‚
        </div>

        <div class="options-grid">
            <button class="btn-option btn-o" onclick="checkAnswer('O')">(A) O</button>
            <button class="btn-option btn-x" onclick="checkAnswer('X')">(B) X</button>
        </div>

        <div id="feedback-area">
            <!-- é€™è£¡æœƒå‹•æ…‹é¡¯ç¤ºçµæœ -->
        </div>
        <button class="reset-btn" onclick="resetQuiz()">é‡ç½®æœ¬é¡Œ</button>
    </section>

    <!-- 2. åè©èˆ‡è§€å¿µå€ -->
    <section class="card">
        <h2>ğŸ“š å°ˆæœ‰åè©ç™½è©±ç¿»è­¯</h2>
        <dl class="term-list">
            <dt>I/O (Input/Output)</dt>
            <dd>è¼¸å…¥ï¼è¼¸å‡ºè£ç½®ã€‚åƒæ˜¯éµç›¤ã€ç¡¬ç¢Ÿã€ç¶²å¡ï¼Œè² è²¬è·Ÿé›»è…¦å¤–é¢æºé€šã€‚</dd>
            
            <dt>CPU (Central Processing Unit)</dt>
            <dd>ä¸­å¤®è™•ç†å™¨ã€‚é›»è…¦çš„å¤§è…¦ï¼Œè² è²¬è¨ˆç®—è·ŸæŒ‡æ®ï¼Œæ™‚é–“éå¸¸å¯¶è²´ã€‚</dd>
            
            <dt>Memory (RAM)</dt>
            <dd>ä¸»è¨˜æ†¶é«”ã€‚CPU å·¥ä½œçš„æš«å­˜å€ï¼Œè³‡æ–™è¦æ”¾åœ¨é€™è£¡ CPU æ‰èƒ½è™•ç†ã€‚</dd>
            
            <dt>DMA (Direct Memory Access)</dt>
            <dd>ç›´æ¥è¨˜æ†¶é«”å­˜å–ã€‚ä¸€å€‹ç‰¹æ®Šçš„æ©Ÿåˆ¶ï¼ˆæˆ–æ™¶ç‰‡ï¼‰ï¼Œå…è¨± I/O è£ç½®<span class="highlight">ç›´æ¥è·Ÿè¨˜æ†¶é«”äº¤æ›è³‡æ–™</span>ï¼Œä¸ç”¨å‹ç…© CPU æ¬é‹ã€‚</dd>
        </dl>
    </section>

    <!-- 3. æ ¸å¿ƒäº’å‹•åœ–è§£å€ -->
    <section class="card">
        <h2>âš™ï¸ é‹ä½œæµç¨‹å¤§å°æ±ºï¼šæœ‰ç„¡ DMA çš„å·®åˆ¥</h2>
        <p>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œè§€å¯Ÿè³‡æ–™ï¼ˆæ©˜è‰²é»ï¼‰æ€éº¼ç§»å‹•ï¼Œä»¥åŠ CPU çš„ç‹€æ…‹ï¼</p>
        
        <div class="viz-controls">
            <button class="btn-ctrl active" id="btn-trad" onclick="setMode('traditional')">å‚³çµ± I/O (ç„¡ DMA)</button>
            <button class="btn-ctrl" id="btn-dma" onclick="setMode('dma')">ä½¿ç”¨ DMA</button>
        </div>

        <div class="flow-diagram">
            <!-- çµ„ä»¶ç›’å­ -->
            <div class="component-box box-io" style="margin-left: 20px;">
                I/O è£ç½®<br>
                <small>(ç¡¬ç¢Ÿ)</small>
            </div>

            <div class="component-box box-cpu" id="cpu-box">
                CPU<br>
                <div class="cpu-status-indicator" id="cpu-status" style="background: #e74c3c; color: white;">å¿™ç¢Œæ¬é‹ä¸­</div>
            </div>

            <div class="component-box box-mem" style="margin-right: 20px;">
                ä¸»è¨˜æ†¶é«”<br>
                <small>(RAM)</small>
            </div>

            <!-- å‹•ç•«å…ƒç´  -->
            <div class="data-packet" id="data-dot"></div>
            
            <!-- è¦–è¦ºé€£ç·š (èƒŒæ™¯è£é£¾) -->
            <div style="position:absolute; width: 80%; left: 10%; height: 2px; background:#ddd; z-index:0; top: 50%;"></div>
        </div>

        <div id="explanation-text" style="margin-top: 15px; padding: 10px; background: #eee; border-radius: 5px;">
            <strong>ç›®å‰æ¨¡å¼ï¼šå‚³çµ± I/O</strong><br>
            è³‡æ–™å¿…é ˆå…ˆé€²å…¥ CPUï¼Œå†ç”± CPU å¯«å…¥è¨˜æ†¶é«”ã€‚CPU åƒæ¬é‹å·¥ä¸€æ¨£ï¼Œå…¨ç¨‹ç„¡æ³•åˆ†å¿ƒåšåˆ¥çš„äº‹ã€‚
        </div>
    </section>

    <!-- 4. ç‚ºä»€éº¼æ˜¯ O -->
    <section class="card" style="border-left-color: var(--success-color);">
        <h2>ğŸ’¡ ç‚ºä»€éº¼é€™é¡Œé¸ (A) Oï¼Ÿ</h2>
        <p>é€™é¡Œçš„é—œéµåœ¨æ–¼ç†è§£<strong>ã€ŒåŸ·è¡Œ I/O å‹•ä½œã€</strong>çš„å®šç¾©ã€‚</p>
        <ul>
            <li><strong>é¡Œç›®èªªï¼š</strong>ã€Œå¯ä»¥ä¸å¿…ç¶“é CPU åŸ·è¡Œã€âœ…</li>
            <li><strong>æ„æ€æ˜¯ï¼š</strong>è³‡æ–™çš„<strong>æ¬é‹éç¨‹</strong>ï¼ˆå¾ç¡¬ç¢Ÿ copy åˆ°è¨˜æ†¶é«”é€™æ®µè·¯ï¼‰ï¼Œä¸éœ€è¦ CPU ä¸€å€‹å­—ä¸€å€‹å­—å»æ¬ã€‚</li>
        </ul>
        <div style="background: #e8f8f5; padding: 10px; border-radius: 5px; border-left: 4px solid var(--success-color);">
            <strong>ä¸€å¥è©±çµè«–ï¼š</strong><br>
            æœ‰äº† DMAï¼ŒCPU åªè¦è² è²¬ã€Œé–‹é ­èªªé–‹å§‹ã€è·Ÿã€Œçµå°¾æ”¶å ±å‘Šã€ï¼Œä¸­é–“è¾›è‹¦çš„æ¬é‹å·¥ä½œå…¨äº¤çµ¦ DMAï¼Œ<span class="highlight">CPU çœŸçš„ä¸å¿…è¦ªè‡ªåŸ·è¡Œè³‡æ–™æ¬é‹ï¼</span>
        </div>
    </section>

    <!-- 5. è€ƒè©¦é™·é˜±å¡ -->
    <section class="card">
        <h2>âš ï¸ å¸¸è¦‹è€ƒè©¦é™·é˜± (é»æ“Šå¡ç‰‡å³å¯æ¶ˆé™¤)</h2>
        <div class="trap-grid">
            <div class="trap-card" onclick="dismissTrap(this)">
                <h3>é™·é˜± 1ï¼šDMA ä¸éœ€è¦ CPUï¼Ÿ</h3>
                <p>éŒ¯ï¼CPU é‚„æ˜¯è¦è² è²¬ã€Œå•Ÿå‹•ã€å’Œã€Œè™•ç†ä¸­æ–·ã€ã€‚ä¸æ˜¯å®Œå…¨æ²’äº‹åšï¼Œæ˜¯ä¸ç”¨åšè‹¦åŠ›ã€‚</p>
                <div class="dismiss-btn">æˆ‘æ‡‚äº†ï¼Œéš±è—</div>
            </div>
            <div class="trap-card" onclick="dismissTrap(this)">
                <h3>é™·é˜± 2ï¼šçœ‹åˆ°ã€Œä¸ç¶“éã€å°±é¸ Xï¼Ÿ</h3>
                <p>è¦çœ‹æ¸…æ¥šï¼è³‡æ–™æµã€Œä¸ç¶“éã€CPU æ˜¯å°çš„ï¼›æ§åˆ¶è¨Šè™Ÿé‚„æ˜¯è·Ÿ CPU æœ‰é—œã€‚</p>
                <div class="dismiss-btn">æˆ‘æ‡‚äº†ï¼Œéš±è—</div>
            </div>
            <div class="trap-card" onclick="dismissTrap(this)">
                <h3>é™·é˜± 3ï¼šDMA æ¯”è¼ƒæ…¢ï¼Ÿ</h3>
                <p>éŒ¯ï¼DMA é€šå¸¸ç”¨æ–¼å¤§é‡è³‡æ–™å‚³è¼¸ï¼ˆå¦‚ç¡¬ç¢Ÿï¼‰ï¼Œæ¯” CPU æ…¢æ…¢æ¬å¿«å¤šäº†ï¼Œä¸”æ•´é«”ç³»çµ±æ•ˆç‡è®Šé«˜ã€‚</p>
                <div class="dismiss-btn">æˆ‘æ‡‚äº†ï¼Œéš±è—</div>
            </div>
        </div>
    </section>

    <!-- 6. è‡ªæˆ‘æª¢æ¸¬ -->
    <section class="card">
        <h2>ğŸ” è‡ªæˆ‘æª¢æ¸¬ (é»æŒ‰éˆ•çœ‹æç¤º)</h2>
        
        <div class="quiz-item">
            <p><strong>Q1ï¼š</strong>åœ¨ä½¿ç”¨ DMA æœŸé–“ï¼ŒCPU åœ¨åšä»€éº¼ï¼Ÿ</p>
            <button class="btn-hint" onclick="toggleHint('h1')">é¡¯ç¤ºæç¤º</button>
            <div id="h1" class="hint-text">æç¤ºï¼šCPU æŠŠåŒ¯æµæ’æ§åˆ¶æ¬Šäº¤å‡ºå»å¾Œï¼Œå®ƒå¯ä»¥å»åŸ·è¡Œå…¶ä»–ä¸ä½¿ç”¨åŒ¯æµæ’çš„ç¨‹å¼ï¼ˆMultitaskingï¼‰ã€‚</div>
        </div>

        <div class="quiz-item">
            <p><strong>Q2ï¼š</strong>ä»€éº¼æ¨£çš„è£ç½®æœ€éœ€è¦ DMAï¼Ÿ</p>
            <button class="btn-hint" onclick="toggleHint('h2')">é¡¯ç¤ºæç¤º</button>
            <div id="h2" class="hint-text">æç¤ºï¼šå‚³è¼¸è³‡æ–™é‡å¾ˆå¤§ã€é€Ÿåº¦å¾ˆå¿«çš„è£ç½®ï¼Œä¾‹å¦‚ï¼šç¡¬ç¢Ÿã€é¡¯ç¤ºå¡ã€ç¶²å¡ã€‚</div>
        </div>

        <div class="quiz-item">
            <p><strong>Q3ï¼š</strong>è€ƒè©¦çœ‹åˆ°ã€Œå–ä»£ CPU æ¬é‹è³‡æ–™ã€é€™å¥è©±æ˜¯å°é‚„æ˜¯éŒ¯ï¼Ÿ</p>
            <button class="btn-hint" onclick="toggleHint('h3')">é¡¯ç¤ºæç¤º</button>
            <div id="h3" class="hint-text">æç¤ºï¼šæ­£ç¢ºï¼é€™å°±æ˜¯ DMA å­˜åœ¨çš„ä¸»è¦ç›®çš„ã€‚</div>
        </div>
    </section>

    <footer>
        <p>äº’å‹•å¼æ•™å­¸è¬›ç¾© v1.0 | å°ˆç‚ºé«˜ä¸­é›»è…¦æ¦‚è«–è¨­è¨ˆ</p>
    </footer>
</div>

<script>
    /* --- 1. ç­”é¡Œé‚è¼¯ --- */
    function checkAnswer(userChoice) {
        const feedback = document.getElementById('feedback-area');
        const btns = document.querySelectorAll('.btn-option');
        
        // é‡ç½®æ¨£å¼
        btns.forEach(b => b.classList.remove('selected'));
        feedback.style.display = 'block';

        if (userChoice === 'O') {
            // ç­”å°
            document.querySelector('.btn-o').classList.add('selected');
            feedback.className = 'feedback-correct';
            feedback.innerHTML = `
                <strong>ğŸ‰ ç­”å°äº†ï¼(A) æ˜¯æ­£ç¢ºç­”æ¡ˆã€‚</strong><br>
                å› ç‚º DMA çš„è¨­è¨ˆç›®çš„ï¼Œå°±æ˜¯è®“è³‡æ–™åœ¨ I/O è£ç½®èˆ‡è¨˜æ†¶é«”ä¹‹é–“ç›´æ¥å‚³è¼¸ï¼Œ<br>
                éç¨‹ä¸­å®Œå…¨ä¸éœ€è¦ CPU ä»‹å…¥è™•ç†è³‡æ–™æ¬é‹ï¼ŒCPU åªè¦è² è²¬ç™¼è™Ÿæ–½ä»¤å°±å¥½ã€‚
            `;
        } else {
            // ç­”éŒ¯
            document.querySelector('.btn-x').classList.add('selected');
            feedback.className = 'feedback-wrong';
            feedback.innerHTML = `
                <strong>âŒ ç­”éŒ¯å›‰ï¼ç­”æ¡ˆæ˜¯ (A)ã€‚</strong><br>
                é¡Œç›®å•çš„æ˜¯ã€Œè™•ç† I/O çš„å‹•ä½œã€ï¼ˆæŒ‡è³‡æ–™å‚³è¼¸ï¼‰ã€‚<br>
                æœ‰äº† DMAï¼Œè³‡æ–™çœŸçš„å°±æ˜¯ã€Œç›´æ¥ã€é€²è¨˜æ†¶é«”ï¼Œä¸éœ€è¦ CPU ç¶“æ‰‹å–”ï¼<br>
                <small>å¿«å¾€ä¸‹çœ‹åœ–è§£èªªæ˜ â†“</small>
            `;
        }
    }

    function resetQuiz() {
        const feedback = document.getElementById('feedback-area');
        const btns = document.querySelectorAll('.btn-option');
        btns.forEach(b => b.classList.remove('selected'));
        feedback.style.display = 'none';
    }

    /* --- 2. æ ¸å¿ƒè§€å¿µè¦–è¦ºåŒ–é‚è¼¯ --- */
    let animationInterval;
    let currentMode = 'traditional';

    function setMode(mode) {
        currentMode = mode;
        const btnTrad = document.getElementById('btn-trad');
        const btnDma = document.getElementById('btn-dma');
        const explanation = document.getElementById('explanation-text');
        const cpuStatus = document.getElementById('cpu-status');
        const cpuBox = document.getElementById('cpu-box');
        
        // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
        if (mode === 'traditional') {
            btnTrad.classList.add('active');
            btnDma.classList.remove('active');
            
            explanation.innerHTML = `
                <strong>æ¨¡å¼ï¼šå‚³çµ± I/O (Programmed I/O)</strong><br>
                è³‡æ–™è·¯å¾‘ï¼šè£ç½® â” <span style="color:red">CPU</span> â” è¨˜æ†¶é«”ã€‚<br>
                CPU å¿…é ˆå…¨ç¨‹åƒèˆ‡ï¼Œç„¡æ³•åˆ†å¿ƒï¼Œæ•ˆç‡ä½ã€‚
            `;
            
            cpuStatus.textContent = "å¿™ç¢Œæ¬é‹ä¸­";
            cpuStatus.style.background = "#e74c3c"; // ç´…è‰²
            cpuStatus.style.color = "white";
            cpuBox.style.borderColor = "#c0392b";
            
        } else {
            btnDma.classList.add('active');
            btnTrad.classList.remove('active');
            
            explanation.innerHTML = `
                <strong>æ¨¡å¼ï¼šDMA (Direct Memory Access)</strong><br>
                è³‡æ–™è·¯å¾‘ï¼šè£ç½® â” è¨˜æ†¶é«” (ç¹é CPU)ã€‚<br>
                CPU ç‹€æ…‹ï¼š<span style="color:green">é–’ç½®/åšå…¶ä»–äº‹</span>ã€‚<br>
                CPU åƒ…åœ¨é–‹å§‹æ™‚æˆæ¬Šï¼ŒçµæŸæ™‚æ”¶é€šçŸ¥ã€‚
            `;

            cpuStatus.textContent = "é–’ç½®/å¯åšå…¶ä»–äº‹";
            cpuStatus.style.background = "#27ae60"; // ç¶ è‰²
            cpuStatus.style.color = "white";
            cpuBox.style.borderColor = "#ddd"; // è®Šæ·¡
        }

        // é‡å•Ÿå‹•ç•«
        startAnimation();
    }

    function startAnimation() {
        const dot = document.getElementById('data-dot');
        
        // æ¸…é™¤èˆŠå‹•ç•«
        dot.style.display = 'none';
        dot.style.animation = 'none';
        
        // å¼·åˆ¶é‡ç¹ª (Trigger reflow)
        void dot.offsetWidth;

        dot.style.display = 'block';

        if (currentMode === 'traditional') {
            // å‚³çµ±æ¨¡å¼ï¼šç›´ç·šç¶“é CPU
            dot.style.top = '50%';
            dot.style.animation = 'movePIO 2s infinite linear';
        } else {
            // DMAæ¨¡å¼ï¼šç¹é CPU (é€é top è®ŠåŒ–æ¨¡æ“¬)
            dot.style.animation = 'moveDMA_Direct 2s infinite ease-in-out';
        }
    }

    /* --- 3. é™·é˜±å¡é‚è¼¯ --- */
    function dismissTrap(cardElement) {
        cardElement.style.opacity = '0';
        setTimeout(() => {
            cardElement.style.display = 'none';
        }, 500);
    }

    /* --- 4. è‡ªæˆ‘æª¢æ¸¬æç¤º --- */
    function toggleHint(id) {
        const hint = document.getElementById(id);
        if (hint.style.display === 'block') {
            hint.style.display = 'none';
        } else {
            hint.style.display = 'block';
        }
    }

    // åˆå§‹åŒ–å‹•ç•«
    window.onload = function() {
        startAnimation();
    };

</script>

</body>
</html>