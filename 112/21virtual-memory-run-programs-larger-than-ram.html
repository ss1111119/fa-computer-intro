<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº’å‹•æ•™å­¸ï¼šè™›æ“¬è¨˜æ†¶é«”èˆ‡å¤§ç¨‹å¼åŸ·è¡Œ</title>
    <style>
        :root {
            --primary-color: #3b82f6; /* Blue */
            --success-color: #10b981; /* Green */
            --warning-color: #f59e0b; /* Amber */
            --danger-color: #ef4444; /* Red */
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-light: #6b7280;
            --border-radius: 8px;
            --ram-color: #d1fae5;
            --disk-color: #e5e7eb;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            padding-bottom: 50px;
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* Section Styles */
        section {
            background: var(--card-bg);
            padding: 25px;
            margin-bottom: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
        }

        h2 {
            border-left: 5px solid var(--primary-color);
            padding-left: 15px;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        h3 {
            margin: 15px 0 10px;
            color: #374151;
        }

        /* Question Block */
        .question-block {
            background-color: #eff6ff;
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #bfdbfe;
        }
        .options-list {
            list-style: none;
            margin-top: 15px;
        }
        .options-list li {
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: default; /* Not interactive here */
        }

        /* Core Concept */
        .concept-highlight {
            background-color: #fffbeb;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            margin: 15px 0;
        }
        .concept-term {
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Simulation Area */
        .sim-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            background: #f8fafc;
            padding: 15px;
            border-radius: var(--border-radius);
        }
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .control-group input[type="range"] {
            width: 100%;
        }
        .val-display {
            font-size: 0.85rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .sim-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 1rem;
        }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #2563eb; }
        .btn-secondary { background-color: var(--text-light); color: white; }
        .btn-secondary:hover { background-color: #4b5563; }
        .btn-action { background-color: var(--success-color); color: white; }
        .btn-action:hover { background-color: #059669; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .viz-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .viz-container {
                flex-direction: row;
            }
        }

        .memory-zone {
            flex: 1;
            padding: 15px;
            border-radius: var(--border-radius);
            border: 2px dashed #ccc;
            min-height: 200px;
            position: relative;
        }
        
        .zone-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.8);
            padding: 5px;
            border-radius: 4px;
            display: inline-block;
        }

        #ram-zone {
            background-color: var(--ram-color);
            border-color: var(--success-color);
        }
        
        #disk-zone {
            background-color: var(--disk-color);
            border-color: #9ca3af;
        }

        .page-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 8px;
        }

        .page-block {
            width: 100%;
            aspect-ratio: 1;
            background-color: white;
            border: 2px solid #93c5fd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            color: #1e40af;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        /* Page States */
        .page-block.active {
            background-color: var(--success-color);
            color: white;
            border-color: #047857;
            transform: scale(1.1);
            z-index: 10;
        }
        .page-block.fault {
            background-color: var(--danger-color);
            color: white;
            border-color: #b91c1c;
            animation: shake 0.5s;
        }
        .page-block.victim {
            opacity: 0.5;
            background-color: #9ca3af;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .sim-log-panel {
            margin-top: 20px;
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: var(--border-radius);
            font-family: monospace;
            height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .log-highlight { color: yellow; font-weight: bold; }
        .log-error { color: #ff6b6b; font-weight: bold; }

        .sim-footer-note {
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
            color: var(--primary-color);
            padding: 10px;
            background: #e0f2fe;
            border-radius: 6px;
        }

        /* Analysis Area */
        .card-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        @media (min-width: 600px) {
            .card-container { grid-template-columns: 1fr 1fr; }
        }
        .analysis-card {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            transition: transform 0.2s;
        }
        .analysis-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        .analysis-card.correct {
            border: 2px solid var(--success-color);
            background-color: #ecfdf5;
        }
        .analysis-card h4 {
            color: var(--text-main);
            margin-bottom: 8px;
        }
        .badge-correct {
            background: var(--success-color);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: middle;
        }
        .badge-wrong {
            background: var(--text-light);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: middle;
        }

        /* Quiz Area */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .quiz-btn {
            text-align: left;
            padding: 15px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        .quiz-btn:hover {
            background-color: #f3f4f6;
            border-color: var(--primary-color);
        }
        .quiz-btn.correct-choice {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        .quiz-btn.wrong-choice {
            background-color: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        .quiz-feedback.show { display: block; }
        .feedback-correct { background: #d1fae5; color: #065f46; border: 1px solid #34d399; }
        .feedback-wrong { background: #fee2e2; color: #991b1b; border: 1px solid #f87171; }
        
        .scroll-btn {
            background: none;
            border: none;
            color: #2563eb;
            text-decoration: underline;
            cursor: pointer;
            font-weight: bold;
            padding: 0;
            font-size: inherit;
        }

        /* Accordion */
        .accordion-item {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .accordion-header {
            background: #f9fafb;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .accordion-header:hover { background: #f3f4f6; }
        .accordion-content {
            padding: 15px;
            display: none;
            background: white;
            border-top: 1px solid #e5e7eb;
        }
        .accordion-content.active { display: block; }
        .arrow { transition: transform 0.3s; }
        .arrow.rotate { transform: rotate(180deg); }

        footer {
            text-align: center;
            color: var(--text-light);
            margin-top: 40px;
            font-size: 0.9rem;
        }

        /* Utility */
        .highlight-anim {
            animation: pulse-border 2s infinite;
        }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>è™›æ“¬è¨˜æ†¶é«” (Virtual Memory)</h1>
        <p>å¦‚ä½•ç”¨ç£ç¢Ÿç•¶å‚™æ´ï¼ŒæŠŠç¨‹å¼ã€Œåˆ‡å¡Šã€æ¬é€² RAMï¼ŒåŸ·è¡Œæ¯”è¨˜æ†¶é«”æ›´å¤§çš„ç¨‹å¼ã€‚</p>
    </header>

    <!-- 1. é¡Œç›®å€ -->
    <section id="question-area">
        <h2><span style="color:var(--primary-color)">Q.</span> æœ¬é¡Œ</h2>
        <div class="question-block">
            <p style="font-size: 1.1rem; font-weight: bold;">ä¸‹åˆ—ä½•ç¨®æŠ€è¡“è®“é›»è…¦èƒ½åŸ·è¡Œæ¯” RAM æ›´å¤§ç©ºé–“çš„ç¨‹åºï¼ˆProcessï¼‰ï¼Ÿ</p>
            <ul class="options-list">
                <li>(A) Virtual Memoryï¼ˆè™›æ“¬è¨˜æ†¶é«”ï¼‰</li>
                <li>(B) Multiprogrammingï¼ˆå¤šé“ç¨‹å¼ï¼‰</li>
                <li>(C) Time Sharingï¼ˆåˆ†æ™‚ç³»çµ±ï¼‰</li>
                <li>(D) Multitaskingï¼ˆå¤šå·¥ï¼‰</li>
            </ul>
        </div>
        <p style="margin-top:10px; color:var(--text-light); font-size:0.9rem;">
            *è«‹å…ˆè©¦è‘—åœ¨å¿ƒä¸­å›ç­”ï¼Œæ¥è‘—é€éä¸‹æ–¹äº’å‹•æ¨¡æ“¬ä¾†é©—è­‰è§€å¿µã€‚
        </p>
    </section>

    <!-- 2. æ ¸å¿ƒè§€å¿µå€ -->
    <section id="concept-area">
        <h2>æ ¸å¿ƒè§€å¿µï¼šä»¥å°åšå¤§</h2>
        <p>å‚³çµ±ä¸Šï¼Œç¨‹å¼å¿…é ˆå®Œæ•´è¼‰å…¥ <span class="concept-term">ä¸»è¨˜æ†¶é«” (RAM)</span> æ‰èƒ½åŸ·è¡Œã€‚ä½†å¦‚æœç¨‹å¼å¤ªå¤§ï¼ˆä¾‹å¦‚ 10GB éŠæˆ²ï¼‰è€Œ RAM åªæœ‰ 8GB æ€éº¼è¾¦ï¼Ÿ</p>
        
        <div class="concept-highlight">
            <p><strong>è§£æ±ºæ–¹æ¡ˆï¼šè™›æ“¬è¨˜æ†¶é«” (Virtual Memory)</strong></p>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li><strong>æ¦‚å¿µï¼š</strong>å°‡ç¡¬ç¢Ÿ/SSD çš„ä¸€éƒ¨åˆ†ç©ºé–“ï¼ˆç¨±ç‚º <span class="concept-term">äº¤æ›ç©ºé–“ Swap</span> æˆ– <span class="concept-term">åˆ†é æª” Pagefile</span>ï¼‰ç•¶ä½œ RAM çš„å»¶ä¼¸ã€‚</li>
                <li><strong>åˆ†é  (Paging)ï¼š</strong>å°‡ç¨‹å¼åˆ‡æˆå›ºå®šå¤§å°çš„å°å¡Šï¼Œç¨±ç‚º <span class="concept-term">é é¢ (Page)</span>ã€‚</li>
                <li><strong>åªè¼‰å…¥éœ€è¦çš„ï¼š</strong>åªæŠŠç›®å‰ã€Œæ­£åœ¨åŸ·è¡Œã€çš„ Page æ”¾é€² RAMï¼Œå…¶ä»–ç•™åœ¨ç£ç¢Ÿã€‚</li>
            </ul>
        </div>
    </section>

    <!-- 3. äº’å‹•æ¨¡æ“¬å€ -->
    <section id="simulation-area">
        <h2>äº’å‹•å¯¦é©—å®¤ï¼šåˆ†é æ¬ç§»æ¨¡æ“¬</h2>
        <p style="margin-bottom: 15px;">èª¿æ•´è¨­å®šï¼Œè§€å¯Ÿç•¶ã€Œç¨‹å¼å¤§å°ã€å¤§æ–¼ã€ŒRAMã€æ™‚ç™¼ç”Ÿäº†ä»€éº¼äº‹ã€‚</p>

        <!-- (A) å¯èª¿åƒæ•¸ -->
        <div class="sim-controls">
            <div class="control-group">
                <label>RAM å®¹é‡ (é æ•¸): <span id="val-ram" class="val-display">4</span></label>
                <input type="range" id="input-ram" min="2" max="8" value="4" oninput="updateSimConfig()">
            </div>
            <div class="control-group">
                <label>ç¨‹å¼å¤§å° Process Size (é æ•¸): <span id="val-prog" class="val-display">8</span></label>
                <input type="range" id="input-prog" min="4" max="16" value="8" oninput="updateSimConfig()">
            </div>
            <div class="control-group" style="display:flex; align-items:flex-end;">
                <span id="config-msg" style="font-size:0.9rem; color:var(--danger-color); font-weight:bold;">
                    âš ï¸ ç¨‹å¼å¤§æ–¼ RAMï¼Œå•Ÿç”¨è™›æ“¬è¨˜æ†¶é«”ï¼
                </span>
            </div>
        </div>

        <!-- (C) æ“ä½œæµç¨‹æŒ‰éˆ• -->
        <div class="sim-actions">
            <button class="btn btn-primary" id="btn-start" onclick="startSimulation()">é–‹å§‹åŸ·è¡Œç¨‹åº</button>
            <button class="btn btn-action" id="btn-next" onclick="nextStep()" disabled>ä¸‹ä¸€æ­¥ (å­˜å–é é¢)</button>
            <button class="btn btn-secondary" onclick="resetSimulation()">é‡ç½®</button>
        </div>

        <!-- (B) è¦–è¦ºåŒ–è¨˜æ†¶é«”åœ– -->
        <div class="viz-container">
            <!-- RAM å€ -->
            <div class="memory-zone" id="ram-zone">
                <div class="zone-title">RAM (ä¸»è¨˜æ†¶é«”) <span id="ram-usage">0/4</span></div>
                <div id="ram-grid" class="page-grid">
                    <!-- JS ç”Ÿæˆæ ¼å­ -->
                </div>
            </div>

            <!-- Disk å€ -->
            <div class="memory-zone" id="disk-zone">
                <div class="zone-title">Disk / Swap (ç¡¬ç¢Ÿå»¶ä¼¸å€)</div>
                <div id="disk-grid" class="page-grid">
                    <!-- JS ç”Ÿæˆæ ¼å­ -->
                </div>
            </div>
        </div>

        <!-- (D) å³æ™‚ç‹€æ…‹ Log -->
        <div class="sim-log-panel" id="sim-log">
            <div class="log-entry">ç­‰å¾…é–‹å§‹... è«‹æŒ‰ä¸‹ã€Œé–‹å§‹åŸ·è¡Œç¨‹åºã€</div>
        </div>

        <!-- (E) æ•™å­¸çµè«– -->
        <div class="sim-footer-note">
            ğŸ’¡ Virtual Memory è®“ç¨‹å¼å¤§å°å¯ä»¥å¤§æ–¼ RAMï¼Œå› ç‚ºåªæŠŠã€Œæ­£åœ¨ç”¨çš„é é¢ã€æ”¾é€² RAMï¼Œå…¶é¤˜æ”¾åœ¨ç£ç¢Ÿã€‚
        </div>
    </section>

    <!-- 4. é¸é …é€ä¸€ç ´è§£ -->
    <section id="analysis-area">
        <h2>é¸é …è§£æ</h2>
        <div class="card-container">
            <div class="analysis-card correct">
                <h4>(A) Virtual Memory <span class="badge-correct">æ­£è§£</span></h4>
                <p>åˆ©ç”¨ <span class="concept-term">Paging (åˆ†é )</span> æŠ€è¡“ï¼Œçµåˆå¯¦é«”è¨˜æ†¶é«”èˆ‡ç£ç¢Ÿç©ºé–“ï¼Œå‰µé€ å‡ºæ¯”å¯¦éš› RAM æ›´å¤§çš„è¨˜æ†¶é«”å¹»è¦ºã€‚é€™å°±æ˜¯é¡Œç›®æ‰€å•çš„æŠ€è¡“ã€‚</p>
            </div>
            <div class="analysis-card">
                <h4>(B) Multiprogramming <span class="badge-wrong">éŒ¯èª¤</span></h4>
                <p><strong>å¤šé“ç¨‹å¼ï¼š</strong>æ˜¯æŒ‡è¨˜æ†¶é«”ä¸­åŒæ™‚æ”¾å¤šå€‹ç¨‹å¼ï¼Œç•¶ä¸€å€‹ç¨‹å¼åœ¨ç­‰ I/O æ™‚ï¼ŒCPU åˆ‡æ›å»åŸ·è¡Œå¦ä¸€å€‹ã€‚é‡é»æ˜¯æé«˜ CPU åˆ©ç”¨ç‡ï¼Œè€Œéæ“´å……å®¹é‡ã€‚</p>
            </div>
            <div class="analysis-card">
                <h4>(C) Time Sharing <span class="badge-wrong">éŒ¯èª¤</span></h4>
                <p><strong>åˆ†æ™‚ç³»çµ±ï¼š</strong>å°‡ CPU æ™‚é–“åˆ‡æˆå°ç‰‡ï¼ˆTime Sliceï¼‰è¼ªæµåˆ†çµ¦ä½¿ç”¨è€…ï¼Œè®“å¤§å®¶è¦ºå¾—é›»è…¦æ˜¯è‡ªå·±å°ˆç”¨çš„ã€‚é‡é»æ˜¯äº’å‹•æ€§èˆ‡æ’ç¨‹ã€‚</p>
            </div>
            <div class="analysis-card">
                <h4>(D) Multitasking <span class="badge-wrong">éŒ¯èª¤</span></h4>
                <p><strong>å¤šå·¥ï¼š</strong>æ˜¯ç¾ä»£ä½œæ¥­ç³»çµ±çš„é€šç¨±ï¼ŒæŒ‡åŒæ™‚åŸ·è¡Œå¤šé …å·¥ä½œã€‚å®ƒä¾è³´ä¸Šè¿°æŠ€è¡“ï¼Œä½†ã€Œå¤šå·¥ã€ä¸€è©æœ¬èº«ä¸¦ä¸è§£é‡‹è¨˜æ†¶é«”å¦‚ä½•æ“´å……ã€‚</p>
            </div>
        </div>
    </section>

    <!-- 5. å°æ¸¬é©—å€ -->
    <section id="quiz-area">
        <h2><span style="color:var(--primary-color)">Q.</span> è§€å¿µæª¢æ¸¬</h2>
        <p style="margin-bottom: 15px;">ä¸‹åˆ—ä½•ç¨®æŠ€è¡“è®“é›»è…¦èƒ½åŸ·è¡Œæ¯” RAM æ›´å¤§ç©ºé–“çš„ç¨‹åºï¼Ÿ</p>
        
        <div class="quiz-options">
            <button class="quiz-btn" onclick="checkAnswer('A', this)">(A) Virtual Memoryï¼ˆè™›æ“¬è¨˜æ†¶é«”ï¼‰</button>
            <button class="quiz-btn" onclick="checkAnswer('B', this)">(B) Multiprogrammingï¼ˆå¤šé“ç¨‹å¼ï¼‰</button>
            <button class="quiz-btn" onclick="checkAnswer('C', this)">(C) Time Sharingï¼ˆåˆ†æ™‚ç³»çµ±ï¼‰</button>
            <button class="quiz-btn" onclick="checkAnswer('D', this)">(D) Multitaskingï¼ˆå¤šå·¥ï¼‰</button>
        </div>

        <div id="quiz-feedback-correct" class="quiz-feedback feedback-correct">
            <h3>ğŸ‰ ç­”å°äº†ï¼</h3>
            <p>æ­£æ˜¯ Virtual Memoryï¼å®ƒåˆ©ç”¨ Swap/Pagefile è¼”åŠ©ï¼Œè®“æˆ‘å€‘èƒ½åœ¨æœ‰é™çš„ RAM ä¸Šè·‘å¤§ç¨‹å¼ã€‚</p>
        </div>

        <div id="quiz-feedback-wrong" class="quiz-feedback feedback-wrong">
            <h3>âŒ ç­”éŒ¯äº†</h3>
            <p>é€™ä¸æ˜¯ä¸»è¦åŸå› å–”ã€‚é€™å€‹é¸é …é€šå¸¸è·Ÿ CPU æ’ç¨‹æˆ–å¤šå·¥è™•ç†æœ‰é—œï¼Œè€Œä¸æ˜¯ã€Œè¨˜æ†¶é«”å®¹é‡æ“´å……ã€ã€‚</p>
            <p style="margin-top:10px;">
                <button class="scroll-btn" onclick="scrollToSim()">å¸¶æˆ‘å›äº’å‹•æ¨¡æ“¬å†çœ‹ä¸€æ¬¡</button>
            </p>
        </div>
    </section>

    <!-- å»¶ä¼¸çŸ¥è­˜ -->
    <section id="extra-area">
        <h2>å»¶ä¼¸çŸ¥è­˜ (é»æ“Šå±•é–‹)</h2>
        
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span>ğŸ¤” æ—¢ç„¶ç¡¬ç¢Ÿå¯ä»¥ç•¶ RAMï¼Œç‚ºä½•ä¸å…¨ç”¨ç¡¬ç¢Ÿå°±å¥½ï¼Ÿ</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="accordion-content">
                <p><strong>é€Ÿåº¦å·®ç•°å·¨å¤§ï¼</strong> RAM çš„é€Ÿåº¦æ¯” SSD å¿«æ•¸åå€ï¼Œæ¯”å‚³çµ±ç¡¬ç¢Ÿå¿«ä¸Šåƒå€ã€‚Virtual Memory é›–ç„¶å¢åŠ äº†ç©ºé–“ï¼Œä½†å¦‚æœé »ç¹ç™¼ç”Ÿ <span class="concept-term">ç¼ºé  (Page Fault)</span> å°è‡´ä¸æ–·è®€å¯«ç¡¬ç¢Ÿï¼Œé›»è…¦æœƒè®Šå¾—æ¥µæ…¢ã€‚</p>
            </div>
        </div>

        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span>ğŸ“‰ ä»€éº¼æ˜¯ Thrashing (æŠ–å‹•)ï¼Ÿ</span>
                <span class="arrow">â–¼</span>
            </div>
            <div class="accordion-content">
                <p>ç•¶ç¨‹å¼çœŸçš„å¤ªå¤§ï¼Œæˆ–è€…åŒæ™‚é–‹å¤ªå¤šç¨‹å¼ï¼Œå°è‡´ RAM å¹¾ä¹è¢«å¡æ»¿ï¼Œç³»çµ±å¿…é ˆä¸æ–·åœ°é€²è¡Œ <span class="concept-term">é é¢ç½®æ› (Page Replacement)</span>ã€‚CPU å¿™è‘—æ¬é‹é é¢è€ŒéåŸ·è¡Œç¨‹å¼ï¼Œå°è‡´ç³»çµ±å‘ˆç¾ã€Œå‡æ­»ã€ç‹€æ…‹ï¼Œç¡¬ç¢Ÿç‡ˆç‹‚é–ƒï¼Œé€™å°±æ˜¯ Thrashingã€‚</p>
            </div>
        </div>
    </section>

    <footer>
        <p>Â© 2024 ä½œæ¥­ç³»çµ±äº’å‹•æ•™å­¸ | Designed for Learning</p>
    </footer>
</div>

<script>
    /* =========================================
       äº’å‹•æ¨¡æ“¬é‚è¼¯
       ========================================= */
    
    // ç‹€æ…‹è®Šæ•¸
    let ramCapacity = 4;
    let programSize = 8;
    let ramPages = []; // å­˜ç›®å‰åœ¨ RAM ä¸­çš„ Page ID
    let isRunning = false;
    let pageFaultCount = 0;
    
    // åˆå§‹åŒ–
    window.onload = function() {
        updateSimConfig();
    };

    function updateSimConfig() {
        if (isRunning) return; // åŸ·è¡Œä¸­ä¸å¯æ”¹

        ramCapacity = parseInt(document.getElementById('input-ram').value);
        programSize = parseInt(document.getElementById('input-prog').value);

        // æ›´æ–°é¡¯ç¤ºæ•¸å€¼
        document.getElementById('val-ram').textContent = ramCapacity;
        document.getElementById('val-prog').textContent = programSize;

        // æ›´æ–°æç¤ºè¨Šæ¯
        const msgEl = document.getElementById('config-msg');
        if (programSize > ramCapacity) {
            msgEl.textContent = "âš ï¸ ç¨‹å¼å¤§æ–¼ RAMï¼Œéœ€ä¾è³´ Virtual Memoryï¼";
            msgEl.style.color = "#ef4444"; // Red
        } else {
            msgEl.textContent = "âœ… RAM è¶³å¤ ï¼Œæ‰€æœ‰åˆ†é çš†å¯è¼‰å…¥ã€‚";
            msgEl.style.color = "#10b981"; // Green
        }

        renderGrids();
    }

    function renderGrids() {
        const ramGrid = document.getElementById('ram-grid');
        const diskGrid = document.getElementById('disk-grid');

        // æ¸…ç©º
        ramGrid.innerHTML = '';
        diskGrid.innerHTML = '';
        document.getElementById('ram-usage').textContent = `0/${ramCapacity}`;

        // å»ºç«‹ RAM ç©ºæ ¼ (Placeholder)
        for (let i = 0; i < ramCapacity; i++) {
            let div = document.createElement('div');
            div.className = 'page-block';
            div.style.borderStyle = 'dashed';
            div.style.backgroundColor = 'transparent';
            div.textContent = 'Free';
            div.style.opacity = '0.5';
            ramGrid.appendChild(div);
        }

        // å»ºç«‹ Disk ä¸Šçš„ Pages (ä»£è¡¨ç¨‹å¼çš„æ‰€æœ‰éƒ¨åˆ†)
        for (let i = 1; i <= programSize; i++) {
            let div = document.createElement('div');
            div.className = 'page-block';
            div.id = `disk-page-${i}`;
            div.textContent = `P${i}`;
            diskGrid.appendChild(div);
        }
    }

    function log(msg, type = 'normal') {
        const logPanel = document.getElementById('sim-log');
        const div = document.createElement('div');
        div.className = 'log-entry';
        if (type === 'highlight') div.className += ' log-highlight';
        if (type === 'error') div.className += ' log-error';
        
        // åŠ å…¥æ™‚é–“æˆ³è¨˜ç°¡åŒ–ç‰ˆ
        div.innerHTML = `> ${msg}`;
        logPanel.prepend(div); // æœ€æ–°åœ¨æœ€ä¸Š
    }

    function startSimulation() {
        isRunning = true;
        ramPages = [];
        pageFaultCount = 0;
        
        // UI ç‹€æ…‹
        document.getElementById('input-ram').disabled = true;
        document.getElementById('input-prog').disabled = true;
        document.getElementById('btn-start').disabled = true;
        document.getElementById('btn-next').disabled = false;
        
        // æ¸²æŸ“åˆå§‹ç‹€æ…‹ (RAM ç‚ºç©º)
        renderRamState();
        log("ç¨‹å¼å•Ÿå‹•ã€‚åˆ†é è¡¨å»ºç«‹å®Œæˆã€‚", 'highlight');
        log(`RAM å®¹é‡: ${ramCapacity}, ç¨‹å¼å¤§å°: ${programSize}`);
    }

    function resetSimulation() {
        isRunning = false;
        ramPages = [];
        
        document.getElementById('input-ram').disabled = false;
        document.getElementById('input-prog').disabled = false;
        document.getElementById('btn-start').disabled = false;
        document.getElementById('btn-next').disabled = true;
        
        document.getElementById('sim-log').innerHTML = '<div class="log-entry">ç­‰å¾…é–‹å§‹... è«‹æŒ‰ä¸‹ã€Œé–‹å§‹åŸ·è¡Œç¨‹åºã€</div>';
        
        updateSimConfig(); // é‡ç¹ª
    }

    function nextStep() {
        // 1. éš¨æ©Ÿæ±ºå®šè¦å­˜å–å“ªå€‹ Page (æ¨¡æ“¬ç¨‹å¼åŸ·è¡Œ)
        const targetPage = Math.floor(Math.random() * programSize) + 1;
        
        // æ¸…é™¤æ‰€æœ‰è¦–è¦ºæ•ˆæœ
        document.querySelectorAll('.page-block').forEach(el => {
            el.classList.remove('active', 'fault', 'victim');
        });

        log(`CPU è«‹æ±‚å­˜å– Page ${targetPage}...`);

        // 2. æª¢æŸ¥ Page æ˜¯å¦åœ¨ RAM
        const pageIndexInRam = ramPages.indexOf(targetPage);

        if (pageIndexInRam !== -1) {
            // --- HIT (å‘½ä¸­) ---
            log(`âœ… Page ${targetPage} åœ¨ RAM ä¸­ (Hit)ï¼`, 'highlight');
            animateHit(targetPage);
        } else {
            // --- PAGE FAULT (ç¼ºé ) ---
            pageFaultCount++;
            log(`âŒ Page ${targetPage} ä¸åœ¨ RAM (Page Fault)`, 'error');
            
            // æª¢æŸ¥ RAM æ˜¯å¦æ»¿äº†
            if (ramPages.length >= ramCapacity) {
                // éœ€è¦ç½®æ› (ç°¡å–®ä½¿ç”¨ FIFO: ç§»é™¤é™£åˆ—ç¬¬ä¸€å€‹)
                const victimPage = ramPages.shift();
                log(`âš ï¸ RAM å·²æ»¿ï¼ŒåŸ·è¡Œç½®æ› (Page Replacement)ã€‚ç§»å‡º Page ${victimPage}ã€‚`);
                animateSwap(victimPage, targetPage);
                ramPages.push(targetPage);
            } else {
                // é‚„æœ‰ç©ºé–“ï¼Œç›´æ¥è¼‰å…¥
                log(`ğŸ“¥ å¾ç£ç¢Ÿè¼‰å…¥ Page ${targetPage} åˆ° RAMã€‚`);
                ramPages.push(targetPage);
                renderRamState(); // ç°¡å–®é‡ç¹ª
                // åŠ å€‹ highlight
                setTimeout(() => {
                    const el = document.getElementById(`ram-p-${targetPage}`);
                    if(el) el.classList.add('active');
                }, 50);
            }
        }
        
        // æ›´æ–°çµ±è¨ˆ
        document.getElementById('ram-usage').textContent = `${ramPages.length}/${ramCapacity}`;
    }

    function renderRamState() {
        const ramGrid = document.getElementById('ram-grid');
        ramGrid.innerHTML = '';

        // å¡«å…¥ç›®å‰çš„ RAM Pages
        for (let i = 0; i < ramCapacity; i++) {
            let div = document.createElement('div');
            div.className = 'page-block';
            
            if (i < ramPages.length) {
                const pId = ramPages[i];
                div.textContent = `P${pId}`;
                div.id = `ram-p-${pId}`;
                div.style.backgroundColor = '#dbeafe'; // æ·ºè—
                div.style.borderColor = '#2563eb';
            } else {
                // ç©ºæ ¼
                div.style.borderStyle = 'dashed';
                div.style.backgroundColor = 'transparent';
                div.textContent = 'Free';
                div.style.opacity = '0.5';
            }
            ramGrid.appendChild(div);
        }
    }

    function animateHit(pageId) {
        // é€™è£¡çš„ render å…¶å¯¦å·²ç¶“æœ‰äº†ï¼Œä¸»è¦æ˜¯åŠ ä¸Š class è§¸ç™¼ CSS å‹•ç•«
        renderRamState();
        setTimeout(() => {
            const el = document.getElementById(`ram-p-${pageId}`);
            if (el) el.classList.add('active');
        }, 50);
    }

    function animateSwap(victimId, newPageId) {
        // ç‚ºäº†æ¼”ç¤ºï¼Œæˆ‘å€‘å…ˆé‡ç¹ªç›®å‰çš„ RAM (åŒ…å« victim)
        // å¯¦éš›ä¸Šå› ç‚ºé‚è¼¯ç°¡å–®ï¼Œç›´æ¥é‡ç¹ªæ–°çš„ç‹€æ…‹ï¼Œä¸¦åœ¨ Log èªªæ˜æ¯”è¼ƒæ¸…æ¥š
        // è‹¥è¦åšè¤‡é›œå‹•ç•«ï¼šå…ˆæ¨™è¨˜ victim -> delay -> æ›æˆ new
        
        renderRamState(); // é€™è£¡å·²ç¶“æ˜¯æ›å®Œä¹‹å¾Œçš„ç‹€æ…‹ (victim æ²’äº†ï¼Œnew åœ¨æœ€å¾Œ)
        
        // ç¨å¾® highlight æ–°åŠ å…¥çš„
        setTimeout(() => {
            const el = document.getElementById(`ram-p-${newPageId}`);
            if (el) el.classList.add('fault'); // ç”¨ç´…è‰²é–ƒä¸€ä¸‹è¡¨ç¤ºå‰›ç¶“é fault è™•ç†
            setTimeout(() => el.classList.remove('fault'), 500);
        }, 50);
    }

    /* =========================================
       æ¸¬é©—é‚è¼¯
       ========================================= */
    function checkAnswer(choice, btnElement) {
        // é‡ç½®æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
        const buttons = document.querySelectorAll('.quiz-btn');
        buttons.forEach(btn => {
            btn.classList.remove('correct-choice', 'wrong-choice');
            btn.disabled = true; // é–å®š
        });

        // éš±è—æ‰€æœ‰å›é¥‹
        document.getElementById('quiz-feedback-correct').classList.remove('show');
        document.getElementById('quiz-feedback-wrong').classList.remove('show');

        if (choice === 'A') {
            btnElement.classList.add('correct-choice');
            document.getElementById('quiz-feedback-correct').classList.add('show');
        } else {
            btnElement.classList.add('wrong-choice');
            document.getElementById('quiz-feedback-wrong').classList.add('show');
            
            // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
            buttons[0].classList.add('correct-choice'); // A æ˜¯ç¬¬ä¸€å€‹
        }
    }

    function scrollToSim() {
        const simSection = document.getElementById('simulation-area');
        simSection.scrollIntoView({ behavior: 'smooth' });
        simSection.classList.add('highlight-anim');
        setTimeout(() => {
            simSection.classList.remove('highlight-anim');
        }, 3000);
    }

    /* =========================================
       Accordion é‚è¼¯
       ========================================= */
    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        const arrow = header.querySelector('.arrow');
        
        if (content.classList.contains('active')) {
            content.classList.remove('active');
            arrow.classList.remove('rotate');
        } else {
            content.classList.add('active');
            arrow.classList.add('rotate');
        }
    }
</script>

</body>
</html>